var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||'function'==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return'undefined'!=typeof window&&window===a?a:'undefined'!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX='jscomp_symbol_';
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||'')+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('iterator'));'function'!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.objectCreate=$jscomp.ASSUME_ES5||'function'==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf='function'==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+' is not extensible');return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if('prototype'!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError('Iterator result '+a+' is not an object');};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError('Generator is already running');this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_('return'in b?b['return']:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_['throw'],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){$jscomp.generator.Generator_.prototype=a.prototype;return new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b))};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+='');var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split('.');for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill('Array.prototype.keys',function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},'es6','es3');
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&'q'==d&&e==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill('WeakMap',function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(m){return!1}}function c(a){$jscomp.owns(a,e)||$jscomp.defineProperty(a,e,{value:{}})}function d(a){var b=Object[a];b&&(Object[a]=function(a){c(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;
var e='$jscomp_hidden_'+Math.random();d('freeze');d('preventExtensions');d('seal');var f=0,g=function(a){this.id_=(f+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};g.prototype.set=function(a,b){c(a);if(!$jscomp.owns(a,e))throw Error('WeakMap key fail: '+a);a[e][this.id_]=b;return this};g.prototype.get=function(a){return $jscomp.owns(a,e)?a[e][this.id_]:void 0};g.prototype.has=
function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)};g.prototype.delete=function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)?delete a[e][this.id_]:!1};return g},'es6','es3');$jscomp.MapEntry=function(){};
$jscomp.polyfill('Map',function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||'function'!=typeof a||!a.prototype.entries||'function'!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,'s']]));if('s'!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},'t')!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||'s'!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||'t'!=e.value[1]||!d.next().done?!1:!0}catch(n){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=new WeakMap,d=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,b){var c=e(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};d.prototype.delete=function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(a){return!!e(this,a).entry};
d.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};d.prototype.entries=function(){return f(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return f(this,function(a){return a.key})};d.prototype.values=function(){return f(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(a,b){var d=b&&typeof b;'object'==
d||'function'==d?c.has(b)?d=c.get(b):(d=''+ ++h,c.set(b,d)):d='p_'+b;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var f=e[a];if(b!==b&&f.key!==f.key||b===f.key)return{id:d,list:e,index:a,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},f=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=
a.next=a.head=a},h=0;return d},'es6','es3');
$jscomp.polyfill('Set',function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||'function'!=typeof a||!a.prototype.entries||'function'!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([b]));if(!c.has(b)||1!=c.size||c.add(b)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var f=c.entries(),g=f.next();if(g.done||g.value[0]!=b||g.value[1]!=b)return!1;g=f.next();return g.done||g.value[0]==b||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(h){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};c.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};c.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};c.prototype.clear=function(){this.map_.clear();
this.size=0};c.prototype.has=function(a){return this.map_.has(a)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return c},'es6','es3');
$jscomp.polyfill('Object.is',function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},'es6','es3');$jscomp.polyfill('Array.prototype.includes',function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},'es7','es3');
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+' must not be null or undefined');if(b instanceof RegExp)throw new TypeError('First argument to String.prototype.'+c+' must not be a regular expression');return a+''};$jscomp.polyfill('String.prototype.includes',function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,'includes').indexOf(a,c||0)}},'es6','es3');
$jscomp.polyfill('String.prototype.repeat',function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,'repeat');if(0>a||1342177279<a)throw new RangeError('Invalid count value');a|=0;for(var d='';a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},'es6','es3');$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):' ';return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):''};
$jscomp.polyfill('String.prototype.padEnd',function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,'padStart');return b+$jscomp.stringPadding(c,a-b.length)}},'es8','es3');$jscomp.polyfill('Array.prototype.fill',function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},'es6','es3');
$jscomp.polyfill('Number.isNaN',function(a){return a?a:function(a){return'number'===typeof a&&isNaN(a)}},'es6','es3');$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},'es6','es3');
$jscomp.assign='function'==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill('Object.assign',function(a){return a||$jscomp.assign},'es6','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9007199254740991},'es6','es3');
$jscomp.polyfill('Array.from',function(a){return a?a:function(a,c,d){$jscomp.initSymbolIterator();c=null!=c?c:function(a){return a};var b=[],f=a[Symbol.iterator];if('function'==typeof f)for(a=f.call(a);!(f=a.next()).done;)b.push(c.call(d,f.value));else{f=a.length;for(var g=0;g<f;g++)b.push(c.call(d,a[g]))}return b}},'es6','es3');$jscomp.polyfill('Array.prototype.values',function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},'es8','es3');
function Potree(){}Potree.version={major:1,minor:6,suffix:'-nogui'};Potree.pointBudget=1E6;Potree.framenumber=0;Potree.numNodesLoading=0;Potree.maxNodesLoading=4;Potree.Shaders={};Potree.webgl={shaders:{},vaos:{},vbos:{}};Potree.debug={};Potree.scriptPath=null;document.currentScript.src?(Potree.scriptPath=(new URL(document.currentScript.src+'/..')).href,'/'===Potree.scriptPath.slice(-1)&&(Potree.scriptPath=Potree.scriptPath.slice(0,-1))):console.error('Potree was unable to find its script path using document.currentScript. Is Potree included with a script tag? Does your browser support this function?');
Potree.resourcePath=Potree.scriptPath+'/resources';var EnumItem=function(a){for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this[c]=a[c]};EnumItem.prototype.inspect=function(){return'Enum('+this.name+': '+this.value+')'};var Enum=function(a){this.object=a;for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next()){c=c.value;var d=a[c];'object'===typeof d?d.name=c:d={name:c,value:d};this[c]=new EnumItem(d)}};
Enum.prototype.fromValue=function(a){for(var b=$jscomp.makeIterator(Object.keys(this.object)),c=b.next();!c.done;c=b.next())if(c=c.value,this[c].value===a)return this[c];throw Error('No enum for value: '+a);};Potree.ClipTask={NONE:0,HIGHLIGHT:1,SHOW_INSIDE:2,SHOW_OUTSIDE:3};Potree.ClipMethod={INSIDE_ANY:0,INSIDE_ALL:1};Potree.measureTimings=!1;var lib$potree$potree_clean$classdecl$var0=function(){this.boundingBox=new THREE.Box3;this.numPoints=0;this.data={}};
lib$potree$potree_clean$classdecl$var0.prototype.add=function(a){var b=this.numPoints,c=b+a.numPoints,d=Object.keys(this.data),e=Object.keys(a.data),f=new Set([].concat($jscomp.arrayFromIterable(d),$jscomp.arrayFromIterable(e)));f=$jscomp.makeIterator(f);for(var g=f.next();!g.done;g=f.next())if(g=g.value,d.includes(g)&&e.includes(g)){var h=new this.data[g].constructor(this.data[g].length+a.data[g].length);h.set(this.data[g],0);h.set(a.data[g],this.data[g].length);this.data[g]=h}else if(d.includes(g)&&
!e.includes(g))h=new this.data[g].constructor(this.data[g].length/this.numPoints*c),h.set(this.data[g],0),this.data[g]=h;else if(!d.includes(g)&&e.includes(g)){h=a.data[g].length/a.numPoints;var l=new a.data[g].constructor(h*c);l.set(a.data[g],h*b);this.data[g]=l}this.numPoints=c;this.boundingBox.union(a.boundingBox)};Potree.Points=lib$potree$potree_clean$classdecl$var0;
Potree.loadPointCloud=function(a,b,c){var d=function(a){a.name=b;c({type:'pointcloud_loaded',pointcloud:a})};a&&(0===a.indexOf('greyhound://')?Potree.GreyhoundLoader.load(a,function(b){b?(b=new Potree.PointCloudOctree(b),d(b)):console.error(Error('failed to load point cloud from URL: '+a))}):0<a.indexOf('cloud.js')?Potree.POCLoader.load(a,function(b){b?(b=new Potree.PointCloudOctree(b),d(b)):console.error(Error('failed to load point cloud from URL: '+a))}):0<a.indexOf('.vpc')?Potree.PointCloudArena4DGeometry.load(a,
function(b){b?(b=new Potree.PointCloudArena4D(b),d(b)):console.error(Error('failed to load point cloud from URL: '+a))}):console.error(Error('failed to load point cloud from URL: '+a)))};
Potree.updatePointClouds=function(a,b,c){Potree.lru||(Potree.lru=new LRU);for(var d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next()){var f=e.value;e=performance.now();f=$jscomp.makeIterator(f.profileRequests);for(var g=f.next();!g.done&&!(g.value.update(),5<performance.now()-e);g=f.next());performance.now()}d=Potree.updateVisibility(a,b,c);a=$jscomp.makeIterator(a);for(e=a.next();!e.done;e=a.next())e=e.value,e.updateMaterial(e.material,e.visibleNodes,b,c),e.updateVisibleBounds();Potree.getLRU().freeMemory();
return d};Potree.getLRU=function(){Potree.lru||(Potree.lru=new LRU);return Potree.lru};
Potree.updateVisibilityStructures=function(a,b,c){c=[];for(var d=[],e=new BinaryHeap(function(a){return 1/a.weight}),f=0;f<a.length;f++){var g=a[f];if(g.initialized()){g.numVisibleNodes=0;g.numVisiblePoints=0;g.deepestVisibleLevel=0;g.visibleNodes=[];g.visibleGeometry=[];b.updateMatrixWorld();var h=new THREE.Frustum,l=b.matrixWorldInverse,k=g.matrixWorld,m=b.clone();m.near=Math.min(b.near,.1);m.updateProjectionMatrix();m=b.projectionMatrix;l=(new THREE.Matrix4).multiply(m).multiply(l).multiply(k);
h.setFromMatrix(l);c.push(h);h=b.matrixWorld;k=(new THREE.Matrix4).getInverse(k);k=(new THREE.Matrix4).multiply(k).multiply(h);k=(new THREE.Vector3).setFromMatrixPosition(k);d.push(k);g.visible&&null!==g.root&&e.push({pointcloud:f,node:g.root,weight:Number.MAX_VALUE});g.root.isTreeNode()&&g.hideDescendants(g.root.sceneNode);for(k=0;k<g.boundingBoxNodes.length;k++)g.boundingBoxNodes[k].visible=!1}}return{frustums:c,camObjPositions:d,priorityQueue:e}};
Potree.getDEMWorkerInstance=function(){Potree.DEMWorkerInstance||(Potree.DEMWorkerInstance=Potree.workerPool.getWorker(Potree.scriptPath+'/workers/DEMWorker.js'));return Potree.DEMWorkerInstance};
Potree.updateVisibility=function(a,b,c){var d=0,e=new Map(a.map(function(a){return[a,0]})),f=[],g=[],h=[],l=Infinity,k=Potree.updateVisibilityStructures(a,b,c),m=k.frustums,p=k.camObjPositions;k=k.priorityQueue;var n=0;c=c.domElement.clientHeight;Potree._pointcloudTransformVersion||(Potree._pointcloudTransformVersion=new Map);for(var t=Potree._pointcloudTransformVersion,r=$jscomp.makeIterator(a),q=r.next();!q.done;q=r.next())if(q=q.value,q.visible)if(q.updateMatrixWorld(),t.has(q)){var u=t.get(q);
u.transform.equals(q.matrixWorld)||(u.number++,u.transform.copy(q.matrixWorld),q.dispatchEvent({type:'transformation_changed',target:q}))}else t.set(q,{number:0,transform:q.matrixWorld.clone()});for(;0<k.size();){r=k.pop();q=r.node;var w=r.parent;u=a[r.pointcloud];var z=q.getBoundingBox(),v=p[r.pointcloud],x=m[r.pointcloud].intersectsBox(z);z=u.maxLevel||Infinity;var A=q.getLevel();x=(x=(x=x&&!(d+q.getNumPoints()>Potree.pointBudget))&&!(e.get(u)+q.getNumPoints()>u.pointBudget))&&A<z;q.spacing?l=Math.min(l,
q.spacing):q.geometryNode&&q.geometryNode.spacing&&(l=Math.min(l,q.geometryNode.spacing));if(d+q.getNumPoints()>Potree.pointBudget)break;if(x)for(d+=q.getNumPoints(),z=e.get(u),e.set(u,z+q.getNumPoints()),u.numVisibleNodes++,u.numVisiblePoints+=q.getNumPoints(),!q.isGeometryNode()||w&&!w.isTreeNode()||(q.isLoaded()&&2>n?(q=u.toTreeNode(q,w),n++):(h.push(q),g.push(q))),q.isTreeNode()&&(Potree.getLRU().touch(q.geometryNode),q.sceneNode.visible=!0,q.sceneNode.material=u.material,f.push(q),u.visibleNodes.push(q),
void 0===q._transformVersion&&(q._transformVersion=-1),w=t.get(u),q._transformVersion!==w.number&&(q.sceneNode.updateMatrix(),q.sceneNode.matrixWorld.multiplyMatrices(u.matrixWorld,q.sceneNode.matrix),q._transformVersion=w.number),u.showBoundingBox&&!q.boundingBoxNode&&q.getBoundingBox?(w=new Potree.Box3Helper(q.getBoundingBox()),w.matrixAutoUpdate=!1,u.boundingBoxNodes.push(w),q.boundingBoxNode=w,q.boundingBoxNode.matrix.copy(u.matrixWorld)):u.showBoundingBox?(q.boundingBoxNode.visible=!0,q.boundingBoxNode.matrix.copy(u.matrixWorld)):
!u.showBoundingBox&&q.boundingBoxNode&&(q.boundingBoxNode.visible=!1)),w=q.getChildren(),z=0;z<w.length;z++){A=w[z];var y=0;if(b.isPerspectiveCamera){x=A.getBoundingSphere(new THREE.Sphere);var B=x.center,C=v.x-B.x;y=v.y-B.y;B=v.z-B.z;C=Math.sqrt(C*C+y*y+B*B);x=x.radius;y=.5*c/(Math.tan(b.fov*Math.PI/180/2)*C)*x;if(y<u.minimumNodePixelSize)continue;0>C-x&&(y=Number.MAX_VALUE)}else x=A.getBoundingBox(),C=A.getBoundingSphere(new THREE.Sphere).center.distanceTo(v),y=x.max.clone().sub(x.min).length()/
C;k.push({pointcloud:r.pointcloud,node:A,parent:q,weight:y})}}a=a.filter(function(a){return a.generateDEM&&a.dem instanceof Potree.DEM});a=$jscomp.makeIterator(a);for(q=a.next();!q.done;q=a.next())b=q.value,e=b.visibleNodes.filter(function(a){return 4>=a.getLevel()}),b.dem.update(e);for(a=0;a<Math.min(Potree.maxNodesLoading,h.length);a++)h[a].load();return{visibleNodes:f,numVisiblePoints:d,lowestSpacing:l}};
Potree.paramThreeToGL=function(a,b){if(b===THREE.RepeatWrapping)return a.REPEAT;if(b===THREE.ClampToEdgeWrapping)return a.CLAMP_TO_EDGE;if(b===THREE.MirroredRepeatWrapping)return a.MIRRORED_REPEAT;if(b===THREE.NearestFilter)return a.NEAREST;if(b===THREE.NearestMipMapNearestFilter)return a.NEAREST_MIPMAP_NEAREST;if(b===THREE.NearestMipMapLinearFilter)return a.NEAREST_MIPMAP_LINEAR;if(b===THREE.LinearFilter)return a.LINEAR;if(b===THREE.LinearMipMapNearestFilter)return a.LINEAR_MIPMAP_NEAREST;if(b===
THREE.LinearMipMapLinearFilter)return a.LINEAR_MIPMAP_LINEAR;if(b===THREE.UnsignedByteType)return a.UNSIGNED_BYTE;if(b===THREE.UnsignedShort4444Type)return a.UNSIGNED_SHORT_4_4_4_4;if(b===THREE.UnsignedShort5551Type)return a.UNSIGNED_SHORT_5_5_5_1;if(b===THREE.UnsignedShort565Type)return a.UNSIGNED_SHORT_5_6_5;if(b===THREE.ByteType)return a.BYTE;if(b===THREE.ShortType)return a.SHORT;if(b===THREE.UnsignedShortType)return a.UNSIGNED_SHORT;if(b===THREE.IntType)return a.INT;if(b===THREE.UnsignedIntType)return a.UNSIGNED_INT;
if(b===THREE.FloatType)return a.FLOAT;if(b===THREE.HalfFloatType){var c=extensions.get('OES_texture_half_float');if(null!==c)return c.HALF_FLOAT_OES}if(b===THREE.AlphaFormat)return a.ALPHA;if(b===THREE.RGBFormat)return a.RGB;if(b===THREE.RGBAFormat)return a.RGBA;if(b===THREE.LuminanceFormat)return a.LUMINANCE;if(b===THREE.LuminanceAlphaFormat)return a.LUMINANCE_ALPHA;if(b===THREE.DepthFormat)return a.DEPTH_COMPONENT;if(b===THREE.DepthStencilFormat)return a.DEPTH_STENCIL;if(b===THREE.AddEquation)return a.FUNC_ADD;
if(b===THREE.SubtractEquation)return a.FUNC_SUBTRACT;if(b===THREE.ReverseSubtractEquation)return a.FUNC_REVERSE_SUBTRACT;if(b===THREE.ZeroFactor)return a.ZERO;if(b===THREE.OneFactor)return a.ONE;if(b===THREE.SrcColorFactor)return a.SRC_COLOR;if(b===THREE.OneMinusSrcColorFactor)return a.ONE_MINUS_SRC_COLOR;if(b===THREE.SrcAlphaFactor)return a.SRC_ALPHA;if(b===THREE.OneMinusSrcAlphaFactor)return a.ONE_MINUS_SRC_ALPHA;if(b===THREE.DstAlphaFactor)return a.DST_ALPHA;if(b===THREE.OneMinusDstAlphaFactor)return a.ONE_MINUS_DST_ALPHA;
if(b===THREE.DstColorFactor)return a.DST_COLOR;if(b===THREE.OneMinusDstColorFactor)return a.ONE_MINUS_DST_COLOR;if(b===THREE.SrcAlphaSaturateFactor)return a.SRC_ALPHA_SATURATE;if(b===THREE.RGB_S3TC_DXT1_Format||b===RGBA_S3TC_DXT1_Format||b===THREE.RGBA_S3TC_DXT3_Format||b===RGBA_S3TC_DXT5_Format)if(c=extensions.get('WEBGL_compressed_texture_s3tc'),null!==c){if(b===THREE.RGB_S3TC_DXT1_Format)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(b===THREE.RGBA_S3TC_DXT1_Format)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;
if(b===THREE.RGBA_S3TC_DXT3_Format)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(b===THREE.RGBA_S3TC_DXT5_Format)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(b===THREE.RGB_PVRTC_4BPPV1_Format||b===THREE.RGB_PVRTC_2BPPV1_Format||b===THREE.RGBA_PVRTC_4BPPV1_Format||b===THREE.RGBA_PVRTC_2BPPV1_Format)if(c=extensions.get('WEBGL_compressed_texture_pvrtc'),null!==c){if(b===THREE.RGB_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(b===THREE.RGB_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
if(b===THREE.RGBA_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(b===THREE.RGBA_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(b===THREE.RGB_ETC1_Format&&(c=extensions.get('WEBGL_compressed_texture_etc1'),null!==c))return c.COMPRESSED_RGB_ETC1_WEBGL;if(b===THREE.MinEquation||b===THREE.MaxEquation)if(c=extensions.get('EXT_blend_minmax'),null!==c){if(b===THREE.MinEquation)return c.MIN_EXT;if(b===THREE.MaxEquation)return c.MAX_EXT}return b===UnsignedInt248Type&&(c=
extensions.get('WEBGL_depth_texture'),null!==c)?c.UNSIGNED_INT_24_8_WEBGL:0};Potree.attributeLocations={position:0,color:1,intensity:2,classification:3,returnNumber:4,numberOfReturns:5,pointSourceID:6,indices:7,normal:8,spacing:9};var lib$potree$potree_clean$classdecl$var1=function(a,b,c,d){this.gl=a;this.name=b;this.vsSource=c;this.fsSource=d;this.cache=new Map;this.program=this.fs=this.vs=null;this.uniformLocations={};this.attributeLocations={};this.update(c,d)};
lib$potree$potree_clean$classdecl$var1.prototype.update=function(a,b){this.vsSource=a;this.fsSource=b;this.linkProgram()};lib$potree$potree_clean$classdecl$var1.prototype.compileShader=function(a,b){var c=this.gl;c.shaderSource(a,b);c.compileShader(a);if(!c.getShaderParameter(a,c.COMPILE_STATUS))throw a=c.getShaderInfoLog(a),b=b.split('\n').map(function(a,b){return(''+(b+1)).padEnd(5)+a}).join('\n'),'could not compile shader '+this.name+': '+a+', \n'+b;};
lib$potree$potree_clean$classdecl$var1.prototype.linkProgram=function(){var a=this.gl;this.uniformLocations={};this.attributeLocations={};a.useProgram(null);var b=this.cache.get(this.vsSource+', '+this.fsSource);if(b)this.program=b.program,this.vs=b.vs,this.fs=b.fs,this.attributeLocations=b.attributeLocations,this.uniformLocations=b.uniformLocations;else{this.vs=a.createShader(a.VERTEX_SHADER);this.fs=a.createShader(a.FRAGMENT_SHADER);this.program=a.createProgram();b=$jscomp.makeIterator(Object.keys(Potree.attributeLocations));
for(var c=b.next();!c.done;c=b.next())c=c.value,a.bindAttribLocation(this.program,Potree.attributeLocations[c],c);this.compileShader(this.vs,this.vsSource);this.compileShader(this.fs,this.fsSource);b=this.program;a.attachShader(b,this.vs);a.attachShader(b,this.fs);a.linkProgram(b);a.detachShader(b,this.vs);a.detachShader(b,this.fs);if(!a.getProgramParameter(b,a.LINK_STATUS))throw a=a.getProgramInfoLog(b),'could not link program '+this.name+': '+a;c=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES);for(var d=
0;d<c;d++){var e=a.getActiveAttrib(b,d),f=a.getAttribLocation(b,e.name);this.attributeLocations[e.name]=f}c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(d=0;d<c;d++)e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),this.uniformLocations[e.name]=f;this.cache.set(this.vsSource+', '+this.fsSource,{program:this.program,vs:this.vs,fs:this.fs,attributeLocations:this.attributeLocations,uniformLocations:this.uniformLocations})}};
lib$potree$potree_clean$classdecl$var1.prototype.setUniformMatrix4=function(a,b){var c=this.gl;a=this.uniformLocations[a];null!=a&&(b=new Float32Array(b.elements),c.uniformMatrix4fv(a,!1,b))};lib$potree$potree_clean$classdecl$var1.prototype.setUniform1f=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1f(a,b)};lib$potree$potree_clean$classdecl$var1.prototype.setUniformBoolean=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)};
lib$potree$potree_clean$classdecl$var1.prototype.setUniformTexture=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)};lib$potree$potree_clean$classdecl$var1.prototype.setUniform2f=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform2f(a,b[0],b[1])};lib$potree$potree_clean$classdecl$var1.prototype.setUniform3f=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform3f(a,b[0],b[1],b[2])};
lib$potree$potree_clean$classdecl$var1.prototype.setUniform=function(a,b){b.constructor===THREE.Matrix4?this.setUniformMatrix4(a,b):'number'===typeof b?this.setUniform1f(a,b):'boolean'===typeof b?this.setUniformBoolean(a,b):b instanceof Potree.WebGLTexture?this.setUniformTexture(a,b):b instanceof Array?2===b.length?this.setUniform2f(a,b):3===b.length&&this.setUniform3f(a,b):console.error('unhandled uniform type: ',a,b)};
lib$potree$potree_clean$classdecl$var1.prototype.setUniform1i=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)};Potree.Shader=lib$potree$potree_clean$classdecl$var1;var lib$potree$potree_clean$classdecl$var2=function(a,b){this.gl=a;this.texture=b;this.id=a.createTexture();this.target=a.TEXTURE_2D;this.version=-1;this.update(b)};
lib$potree$potree_clean$classdecl$var2.prototype.update=function(){if(this.texture.image){var a=this.gl,b=this.texture;if(this.version!==b.version){this.target=a.TEXTURE_2D;a.bindTexture(this.target,this.id);var c=Potree.paramThreeToGL(a,b.format),d=b.image.width,e=b.image.height,f=Potree.paramThreeToGL(a,b.type);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);if(b instanceof THREE.DataTexture){var g=
b.image.data;a.texParameteri(this.target,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(this.target,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,Potree.paramThreeToGL(a,b.magFilter));a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,Potree.paramThreeToGL(a,b.minFilter));a.texImage2D(this.target,0,c,d,e,0,c,f,g)}else b instanceof THREE.CanvasTexture&&(g=b.image,a.texParameteri(this.target,a.TEXTURE_WRAP_S,Potree.paramThreeToGL(a,b.wrapS)),a.texParameteri(this.target,
a.TEXTURE_WRAP_T,Potree.paramThreeToGL(a,b.wrapT)),a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,Potree.paramThreeToGL(a,b.magFilter)),a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,Potree.paramThreeToGL(a,b.minFilter)),a.texImage2D(this.target,0,c,c,f,g));a.bindTexture(this.target,null);this.version=b.version}}else this.version=this.texture.version};Potree.WebGLTexture=lib$potree$potree_clean$classdecl$var2;
var lib$potree$potree_clean$classdecl$var3=function(){this.numElements=0;this.vao=null;this.vbos=new Map};Potree.WebGLBuffer=lib$potree$potree_clean$classdecl$var3;var lib$potree$potree_clean$classdecl$var4=function(a,b,c){this.name=a;this.box=b;this.tileSize=c;this.level=this.name.length-1;this.data=new Float32Array(c*c);this.data.fill(-Infinity);this.children=[];this.mipMap=[this.data];this.mipMapNeedsUpdate=!0};
lib$potree$potree_clean$classdecl$var4.prototype.createMipMap=function(){this.mipMap=[this.data];for(var a=this.tileSize,b=parseInt(a/2),c=this.data;1<b;){for(var d=new Float32Array(b*b),e=0;e<b;e++)for(var f=0;f<b;f++){var g=c[2*e+2*f*a],h=c[2*e+2*f*a+a],l=c[2*e+1+2*f*a],k=c[2*e+1+2*f*a+a],m=$jscomp.makeIterator([0,0]),p=m.next().value;m=m.next().value;isFinite(g)&&(p+=g,m+=1);isFinite(h)&&(p+=h,m+=1);isFinite(l)&&(p+=l,m+=1);isFinite(k)&&(p+=k,m+=1);p/=m;d[e+f*b]=p}this.mipMap.push(d);c=d;a=b;b=
parseInt(b/2)}this.mipMapNeedsUpdate=!1};lib$potree$potree_clean$classdecl$var4.prototype.uv=function(a){var b=this.box.getSize(new THREE.Vector3);return[(a.x-this.box.min.x)/b.x,(a.y-this.box.min.y)/b.y]};
lib$potree$potree_clean$classdecl$var4.prototype.heightAtMipMapLevel=function(a,b){a=this.uv(a);var c=parseInt(this.tileSize/parseInt(Math.pow(2,b))),d=this.mipMap[b],e=Math.min(a[0]*c,c-1),f=Math.min(a[1]*c,c-1);a=e%1;b=f%1;var g=$jscomp.makeIterator([Math.floor(e),Math.ceil(e)]);e=g.next().value;var h=g.next().value;f=$jscomp.makeIterator([Math.floor(f),Math.ceil(f)]);g=f.next().value;var l=f.next().value;f=d[e+c*g];e=d[e+c*l];g=d[h+c*g];c=d[h+c*l];d=isFinite(f)?(1-a)*(1-b):0;h=isFinite(e)?(1-a)*
b:0;l=isFinite(g)?a*(1-b):0;a=isFinite(c)?a*b:0;b=d+h+l+a;d/=b;h/=b;l/=b;a/=b;if(0===b)return null;b=0;isFinite(f)&&(b+=f*d);isFinite(e)&&(b+=e*h);isFinite(g)&&(b+=g*l);isFinite(c)&&(b+=c*a);return b};lib$potree$potree_clean$classdecl$var4.prototype.height=function(a){for(var b=null,c=0;c<this.mipMap.length&&(b=this.heightAtMipMapLevel(a,c),null===b);c++);return b};
lib$potree$potree_clean$classdecl$var4.prototype.traverse=function(a,b){b=void 0===b?0:b;a(this,b);for(var c=$jscomp.makeIterator(this.children.filter(function(a){return void 0!==a})),d=c.next();!d.done;d=c.next())d.value.traverse(a,b+1)};Potree.DEMNode=lib$potree$potree_clean$classdecl$var4;var lib$potree$potree_clean$classdecl$var5=function(a){this.pointcloud=a;this.boundingBox=this.matrix=null;this.tileSize=64;this.root=null;this.version=0};
lib$potree$potree_clean$classdecl$var5.prototype.expandAndFindByBox=function(a,b){if(0===b)return[this.root];for(var c=[],d=[this.root];0<d.length;){var e=d.pop(),f=e.box.getSize(new THREE.Vector3),g=(a.min.x-e.box.min.x)/f.x,h=(a.min.y-e.box.min.y)/f.y,l=(a.max.x-e.box.max.x)/f.x,k=(a.max.y-e.box.max.y)/f.y;g=.5>g?0:1;h=.5>h?0:1;l=.5>l?0:1;k=.5>k?0:1;g=$jscomp.makeIterator(0===g&&0===h&&1===l&&1===k?[0,1,2,3]:g===l&&h===k?[g<<1|h]:[g<<1|h,l<<1|k]);for(h=g.next();!h.done;h=g.next())h=h.value,void 0===
e.children[h]&&(l=e.box.clone(),0<(h&2)?l.min.x+=f.x/2:l.max.x-=f.x/2,0<(h&1)?l.min.y+=f.y/2:l.max.y-=f.y/2,l=new Potree.DEMNode(e.name+h,l,this.tileSize),e.children[h]=l),h=e.children[h],h.level<b?d.push(h):c.push(h)}return c};lib$potree$potree_clean$classdecl$var5.prototype.childIndex=function(a){var b=$jscomp.makeIterator(a.map(function(a){return.5>a?0:1}));a=b.next().value;b=b.next().value;return a<<1|b};
lib$potree$potree_clean$classdecl$var5.prototype.height=function(a){if(!this.root)return 0;for(var b=null,c=[this.root];;){var d=c[c.length-1],e=d.height(a);null!==e&&(b=e);e=d.uv(a);e=this.childIndex(e);if(d.children[e])c.push(d.children[e]);else break}return b+this.pointcloud.position.z};
lib$potree$potree_clean$classdecl$var5.prototype.update=function(a){var b=this;if(!Potree.getDEMWorkerInstance().working){null!==this.matrix&&this.matrix.equals(this.pointcloud.matrixWorld)||(this.matrix=this.pointcloud.matrixWorld.clone(),this.boundingBox=this.pointcloud.boundingBox.clone().applyMatrix4(this.matrix),this.root=new Potree.DEMNode('r',this.boundingBox,this.tileSize),this.version++);var c=null;a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())if(d=d.value,void 0===d.demVersion||
d.demVersion<this.version){c=d;break}if(null!==c){var e=c.getBoundingBox().clone().applyMatrix4(this.matrix),f=e.getSize(new THREE.Vector3),g=this.expandAndFindByBox(e,c.getLevel());c.demVersion=this.version;Potree.getDEMWorkerInstance().onmessage=function(a){a=new Float32Array(a.data.dem.data);for(var c=$jscomp.makeIterator(g),d=c.next();!d.done;d=c.next()){d=d.value;for(var h=d.box.getSize(new THREE.Vector3),p=0;p<b.tileSize;p++)for(var n=0;n<b.tileSize;n++){var t=b.tileSize*(d.box.min.x+p/(b.tileSize-
1)*h.x-e.min.x)/f.x,r=b.tileSize*(d.box.min.y+n/(b.tileSize-1)*h.y-e.min.y)/f.y;0>t||t>b.tileSize||0>r||r>b.tileSize||(t=Math.min(Math.floor(t),b.tileSize-1),r=Math.min(Math.floor(r),b.tileSize-1),d.data[p+b.tileSize*n]=a[t+b.tileSize*r])}d.createMipMap();d.mipMapNeedsUpdate=!0;Potree.getDEMWorkerInstance().working=!1}};a=c.geometryNode.geometry.attributes.position.array;c={boundingBox:{min:c.getBoundingBox().min.toArray(),max:c.getBoundingBox().max.toArray()},position:(new Float32Array(a)).buffer};
a=[c.position];Potree.getDEMWorkerInstance().working=!0;Potree.getDEMWorkerInstance().postMessage(c,a)}}};Potree.DEM=lib$potree$potree_clean$classdecl$var5;Potree.PointCloudTreeNode=function(){this.needsTransformUpdate=!0};Potree.PointCloudTreeNode.prototype.getChildren=function(){throw Error('override function');};Potree.PointCloudTreeNode.prototype.getBoundingBox=function(){throw Error('override function');};
Potree.PointCloudTreeNode.prototype.isLoaded=function(){throw Error('override function');};Potree.PointCloudTreeNode.prototype.isGeometryNode=function(){throw Error('override function');};Potree.PointCloudTreeNode.prototype.isTreeNode=function(){throw Error('override function');};Potree.PointCloudTreeNode.prototype.getLevel=function(){throw Error('override function');};Potree.PointCloudTreeNode.prototype.getBoundingSphere=function(){throw Error('override function');};
var lib$potree$potree_clean$classdecl$var6=function(){var a=THREE.Object3D.call(this)||this;a.dem=new Potree.DEM(a);return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var6,THREE.Object3D);lib$potree$potree_clean$classdecl$var6.prototype.initialized=function(){return null!==this.root};Potree.PointCloudTree=lib$potree$potree_clean$classdecl$var6;var lib$potree$potree_clean$classdecl$var7=function(){this.workers={}};
lib$potree$potree_clean$classdecl$var7.prototype.getWorker=function(a){this.workers[a]||(this.workers[a]=[]);if(0===this.workers[a].length){var b=new Worker(a);this.workers[a].push(b)}return this.workers[a].pop()};lib$potree$potree_clean$classdecl$var7.prototype.returnWorker=function(a,b){this.workers[a].push(b)};Potree.WorkerPool=lib$potree$potree_clean$classdecl$var7;Potree.workerPool=new Potree.WorkerPool;Potree.Shaders['pointcloud.vs']='\nprecision highp float;\nprecision highp int;\n\n#define max_clip_polygons 8\n#define PI 3.141592653589793\n\nattribute vec3 position;\nattribute vec3 color;\nattribute float intensity;\nattribute float classification;\nattribute float returnNumber;\nattribute float numberOfReturns;\nattribute float pointSourceID;\nattribute vec4 indices;\nattribute float spacing;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 uViewInv;\n\nuniform float uScreenWidth;\nuniform float uScreenHeight;\nuniform float fov;\nuniform float near;\nuniform float far;\n\nuniform bool uDebug;\n\nuniform bool uUseOrthographicCamera;\nuniform float uOrthoWidth;\nuniform float uOrthoHeight;\n\n\n#define CLIPTASK_NONE 0\n#define CLIPTASK_HIGHLIGHT 1\n#define CLIPTASK_SHOW_INSIDE 2\n#define CLIPTASK_SHOW_OUTSIDE 3\n\n#define CLIPMETHOD_INSIDE_ANY 0\n#define CLIPMETHOD_INSIDE_ALL 1\n\nuniform int clipTask;\nuniform int clipMethod;\n#if defined(num_clipboxes) && num_clipboxes > 0\n\tuniform mat4 clipBoxes[num_clipboxes];\n#endif\n\n#if defined(num_clipspheres) && num_clipspheres > 0\n\tuniform mat4 uClipSpheres[num_clipspheres];\n#endif\n\n#if defined(num_clippolygons) && num_clippolygons > 0\n\tuniform int uClipPolygonVCount[num_clippolygons];\n\tuniform vec3 uClipPolygonVertices[num_clippolygons * 8];\n\tuniform mat4 uClipPolygonWVP[num_clippolygons];\n#endif\n\n\nuniform float size;\nuniform float minSize;\nuniform float maxSize;\n\nuniform float uPCIndex;\nuniform float uOctreeSpacing;\nuniform float uNodeSpacing;\nuniform float uOctreeSize;\nuniform vec3 uBBSize;\nuniform float uLevel;\nuniform float uVNStart;\nuniform bool uIsLeafNode;\n\nuniform vec3 uColor;\nuniform float uOpacity;\n\nuniform vec2 elevationRange;\nuniform vec2 intensityRange;\nuniform float intensityGamma;\nuniform float intensityContrast;\nuniform float intensityBrightness;\nuniform float rgbGamma;\nuniform float rgbContrast;\nuniform float rgbBrightness;\nuniform float uTransition;\nuniform float wRGB;\nuniform float wIntensity;\nuniform float wElevation;\nuniform float wClassification;\nuniform float wReturnNumber;\nuniform float wSourceID;\n\nuniform vec3 uShadowColor;\n\nuniform sampler2D visibleNodes;\nuniform sampler2D gradient;\nuniform sampler2D classificationLUT;\n\n#if defined(num_shadowmaps) && num_shadowmaps > 0\nuniform sampler2D uShadowMap[num_shadowmaps];\nuniform mat4 uShadowWorldView[num_shadowmaps];\nuniform mat4 uShadowProj[num_shadowmaps];\n#endif\n\nvarying vec3\tvColor;\nvarying float\tvLogDepth;\nvarying vec3\tvViewPosition;\nvarying float \tvRadius;\nvarying float \tvPointSize;\n\n\nfloat round(float number){\n\treturn floor(number + 0.5);\n}\n\n// \n//    ###    ########     ###    ########  ######## #### ##     ## ########     ######  #### ######## ########  ######  \n//   ## ##   ##     ##   ## ##   ##     ##    ##     ##  ##     ## ##          ##    ##  ##       ##  ##       ##    ## \n//  ##   ##  ##     ##  ##   ##  ##     ##    ##     ##  ##     ## ##          ##        ##      ##   ##       ##       \n// ##     ## ##     ## ##     ## ########     ##     ##  ##     ## ######       ######   ##     ##    ######    ######  \n// ######### ##     ## ######### ##           ##     ##   ##   ##  ##                ##  ##    ##     ##             ## \n// ##     ## ##     ## ##     ## ##           ##     ##    ## ##   ##          ##    ##  ##   ##      ##       ##    ## \n// ##     ## ########  ##     ## ##           ##    ####    ###    ########     ######  #### ######## ########  ######  \n// \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\n\n// ---------------------\n// OCTREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_octree)\n/**\n * number of 1-bits up to inclusive index position\n * number is treated as if it were an integer in the range 0-255\n *\n */\nint numberOfOnes(int number, int index){\n\tint numOnes = 0;\n\tint tmp = 128;\n\tfor(int i = 7; i >= 0; i--){\n\t\t\n\t\tif(number >= tmp){\n\t\t\tnumber = number - tmp;\n\n\t\t\tif(i <= index){\n\t\t\t\tnumOnes++;\n\t\t\t}\n\t\t}\n\t\t\n\t\ttmp = tmp / 2;\n\t}\n\n\treturn numOnes;\n}\n\n\n/**\n * checks whether the bit at index is 1\n * number is treated as if it were an integer in the range 0-255\n *\n */\nbool isBitSet(int number, int index){\n\n\t// weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0\n\tint powi = 1;\n\tif(index == 0){\n\t\tpowi = 1;\n\t}else if(index == 1){\n\t\tpowi = 2;\n\t}else if(index == 2){\n\t\tpowi = 4;\n\t}else if(index == 3){\n\t\tpowi = 8;\n\t}else if(index == 4){\n\t\tpowi = 16;\n\t}else if(index == 5){\n\t\tpowi = 32;\n\t}else if(index == 6){\n\t\tpowi = 64;\n\t}else if(index == 7){\n\t\tpowi = 128;\n\t}else{\n\t\treturn false;\n\t}\n\n\tint ndp = number / powi;\n\n\treturn mod(float(ndp), 2.0) != 0.0;\n}\n\n\n/**\n * find the LOD at the point position\n */\nfloat getLOD(){\n\t\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tint iOffset = int(uVNStart);\n\tfloat depth = uLevel;\n\tfor(float i = 0.0; i <= 30.0; i++){\n\t\tfloat nodeSizeAtLevel = uOctreeSize  / pow(2.0, i + uLevel + 0.0);\n\t\t\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\tindex3d = floor(index3d + 0.5);\n\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\tint mask = int(round(value.r * 255.0));\n\n\t\tif(isBitSet(mask, index)){\n\t\t\t// there are more visible child nodes at this position\n\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\tiOffset = iOffset + advance;\n\t\t\t\n\t\t\tdepth++;\n\t\t}else{\n\t\t\t// no more visible child nodes at this position\n\t\t\treturn value.a * 255.0;\n\t\t\t//return depth;\n\t\t}\n\t\t\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t}\n\t\t\n\treturn depth;\n}\n\nfloat getSpacing(){\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tint iOffset = int(uVNStart);\n\tfloat depth = uLevel;\n\tfloat spacing = uNodeSpacing;\n\tfor(float i = 0.0; i <= 30.0; i++){\n\t\tfloat nodeSizeAtLevel = uOctreeSize  / pow(2.0, i + uLevel + 0.0);\n\t\t\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\tindex3d = floor(index3d + 0.5);\n\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\tint mask = int(round(value.r * 255.0));\n\t\tfloat spacingFactor = value.a;\n\n\t\tif(i > 0.0){\n\t\t\tspacing = spacing / (255.0 * spacingFactor);\n\t\t}\n\t\t\n\n\t\tif(isBitSet(mask, index)){\n\t\t\t// there are more visible child nodes at this position\n\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\tiOffset = iOffset + advance;\n\n\t\t\t//spacing = spacing / (255.0 * spacingFactor);\n\t\t\t//spacing = spacing / 3.0;\n\t\t\t\n\t\t\tdepth++;\n\t\t}else{\n\t\t\t// no more visible child nodes at this position\n\t\t\treturn spacing;\n\t\t}\n\t\t\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t}\n\t\t\n\treturn spacing;\n}\n\nfloat getPointSizeAttenuation(){\n\treturn pow(2.0, getLOD());\n}\n\n\n#endif\n\n\n// ---------------------\n// KD-TREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_kdtree)\n\nfloat getLOD(){\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tfloat iOffset = 0.0;\n\tfloat depth = 0.0;\n\t\t\n\t\t\n\tvec3 size = uBBSize;\t\n\tvec3 pos = position;\n\t\t\n\tfor(float i = 0.0; i <= 1000.0; i++){\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n\t\t\n\t\tint children = int(value.r * 255.0);\n\t\tfloat next = value.g * 255.0;\n\t\tint split = int(value.b * 255.0);\n\t\t\n\t\tif(next == 0.0){\n\t\t \treturn depth;\n\t\t}\n\t\t\n\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\n\t\tif(split == 1){\n\t\t\tsplitv.x = 1.0;\n\t\t}else if(split == 2){\n\t\t \tsplitv.y = 1.0;\n\t\t}else if(split == 4){\n\t\t \tsplitv.z = 1.0;\n\t\t}\n\t\t\n\t\tiOffset = iOffset + next;\n\t\t\n\t\tfloat factor = length(pos * splitv / size);\n\t\tif(factor < 0.5){\n\t\t\t// left\n\t\tif(children == 0 || children == 2){\n\t\t\t\treturn depth;\n\t\t\t}\n\t\t}else{\n\t\t\t// right\n\t\t\tpos = pos - size * splitv * 0.5;\n\t\t\tif(children == 0 || children == 1){\n\t\t\t\treturn depth;\n\t\t\t}\n\t\t\tif(children == 3){\n\t\t\t\tiOffset = iOffset + 1.0;\n\t\t\t}\n\t\t}\n\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\n\t\t\n\t\tdepth++;\n\t}\n\t\t\n\t\t\n\treturn depth;\t\n}\n\nfloat getPointSizeAttenuation(){\n\treturn 0.5 * pow(1.3, getLOD());\n}\n\n#endif\n\n\n\n// \n//    ###    ######## ######## ########  #### ########  ##     ## ######## ########  ######  \n//   ## ##      ##       ##    ##     ##  ##  ##     ## ##     ##    ##    ##       ##    ## \n//  ##   ##     ##       ##    ##     ##  ##  ##     ## ##     ##    ##    ##       ##       \n// ##     ##    ##       ##    ########   ##  ########  ##     ##    ##    ######    ######  \n// #########    ##       ##    ##   ##    ##  ##     ## ##     ##    ##    ##             ## \n// ##     ##    ##       ##    ##    ##   ##  ##     ## ##     ##    ##    ##       ##    ## \n// ##     ##    ##       ##    ##     ## #### ########   #######     ##    ########  ######                                                                               \n// \n\n\n\n// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\nfloat getContrastFactor(float contrast){\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\n}\n\nvec3 getRGB(){\n\tvec3 rgb = color;\n\t\n\trgb = pow(rgb, vec3(rgbGamma));\n\trgb = rgb + rgbBrightness;\n\t//rgb = (rgb - 0.5) * getContrastFactor(rgbContrast) + 0.5;\n\trgb = clamp(rgb, 0.0, 1.0);\n\n\t\t//rgb = indices.rgb;\n\t//rgb.b = pcIndex / 255.0;\n\t\n\t\n\treturn rgb;\n}\n\nfloat getIntensity(){\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\n\tw = pow(w, intensityGamma);\n\tw = w + intensityBrightness;\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\n\tw = clamp(w, 0.0, 1.0);\n\n\t//w = w + color.x * 0.0001;\n\t\n\t//float w = color.x * 0.001 + intensity / 1.0;\n\n\treturn w;\n}\n\nvec3 getElevation(){\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\n\tfloat w = (world.z - elevationRange.x) / (elevationRange.y - elevationRange.x);\n\tvec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t\n\treturn cElevation;\n}\n\nvec4 getClassification(){\n\tvec2 uv = vec2(classification / 255.0, 0.5);\n\tvec4 classColor = texture2D(classificationLUT, uv);\n\t\n\treturn classColor;\n}\n\nvec3 getReturnNumber(){\n\tif(numberOfReturns == 1.0){\n\t\treturn vec3(1.0, 1.0, 0.0);\n\t}else{\n\t\tif(returnNumber == 1.0){\n\t\t\treturn vec3(1.0, 0.0, 0.0);\n\t\t}else if(returnNumber == numberOfReturns){\n\t\t\treturn vec3(0.0, 0.0, 1.0);\n\t\t}else{\n\t\t\treturn vec3(0.0, 1.0, 0.0);\n\t\t}\n\t}\n}\n\nvec3 getSourceID(){\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\n\treturn texture2D(gradient, vec2(w,1.0 - w)).rgb;\n}\n\nvec3 getCompositeColor(){\n\tvec3 c;\n\tfloat w;\n\n\tc += wRGB * getRGB();\n\tw += wRGB;\n\t\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\n\tw += wIntensity;\n\t\n\tc += wElevation * getElevation();\n\tw += wElevation;\n\t\n\tc += wReturnNumber * getReturnNumber();\n\tw += wReturnNumber;\n\t\n\tc += wSourceID * getSourceID();\n\tw += wSourceID;\n\t\n\tvec4 cl = wClassification * getClassification();\n    c += cl.a * cl.rgb;\n\tw += wClassification * cl.a;\n\n\tc = c / w;\n\t\n\tif(w == 0.0){\n\t\t//c = color;\n\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t}\n\t\n\treturn c;\n}\n\n\n// \n//  ######  ##       #### ########  ########  #### ##    ##  ######   \n// ##    ## ##        ##  ##     ## ##     ##  ##  ###   ## ##    ##  \n// ##       ##        ##  ##     ## ##     ##  ##  ####  ## ##        \n// ##       ##        ##  ########  ########   ##  ## ## ## ##   #### \n// ##       ##        ##  ##        ##         ##  ##  #### ##    ##  \n// ##    ## ##        ##  ##        ##         ##  ##   ### ##    ##  \n//  ######  ######## #### ##        ##        #### ##    ##  ######                                                          \n// \n\n\n\nvec3 getColor(){\n\tvec3 color;\n\t\n\t#ifdef color_type_rgb\n\t\tcolor = getRGB();\n\t#elif defined color_type_height\n\t\tcolor = getElevation();\n\t#elif defined color_type_rgb_height\n\t\tvec3 cHeight = getElevation();\n\t\tcolor = (1.0 - uTransition) * getRGB() + uTransition * cHeight;\n\t#elif defined color_type_depth\n\t\tfloat linearDepth = gl_Position.w;\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\n\t\tcolor = vec3(linearDepth, expDepth, 0.0);\n\t#elif defined color_type_intensity\n\t\tfloat w = getIntensity();\n\t\tcolor = vec3(w, w, w);\n\t#elif defined color_type_intensity_gradient\n\t\tfloat w = getIntensity();\n\t\tcolor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_color\n\t\tcolor = uColor;\n\t#elif defined color_type_lod\n\t\tfloat depth = getLOD();\n\t\tfloat w = depth / 10.0;\n\t\tcolor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_point_index\n\t\tcolor = indices.rgb;\n\t#elif defined color_type_classification\n\t\tvec4 cl = getClassification(); \n\t\tcolor = cl.rgb;\n\t#elif defined color_type_return_number\n\t\tcolor = getReturnNumber();\n\t#elif defined color_type_source\n\t\tcolor = getSourceID();\n\t#elif defined color_type_normal\n\t\tcolor = (modelMatrix * vec4(normal, 0.0)).xyz;\n\t#elif defined color_type_phong\n\t\tcolor = color;\n\t#elif defined color_type_composite\n\t\tcolor = getCompositeColor();\n\t#endif\n\t\n\treturn color;\n}\n\nfloat getPointSize(){\n\tfloat pointSize = 1.0;\n\t\n\tfloat slope = tan(fov / 2.0);\n\tfloat projFactor = -0.5 * uScreenHeight / (slope * vViewPosition.z);\n\t\n\tfloat r = uOctreeSpacing * 1.7;\n\tvRadius = r;\n\t#if defined fixed_point_size\n\t\tpointSize = size;\n\t#elif defined attenuated_point_size\n\t\tif(uUseOrthographicCamera){\n\t\t\tpointSize = size;\n\t\t}else{\n\t\t\tpointSize = size * spacing * projFactor;\n\t\t\t//pointSize = pointSize * projFactor;\n\t\t}\n\t#elif defined adaptive_point_size\n\t\tif(uUseOrthographicCamera) {\n\t\t\tfloat worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();\n\t\t\tpointSize = (worldSpaceSize / uOrthoWidth) * uScreenWidth;\n\t\t} else {\n\n\t\t\tif(uIsLeafNode && false){\n\t\t\t\tpointSize = size * spacing * projFactor;\n\t\t\t}else{\n\t\t\t\tfloat worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();\n\t\t\t\tpointSize = worldSpaceSize * projFactor;\n\t\t\t}\n\t\t}\n\t#endif\n\n\tpointSize = max(minSize, pointSize);\n\tpointSize = min(maxSize, pointSize);\n\t\n\tvRadius = pointSize / projFactor;\n\n\treturn pointSize;\n}\n\n#if defined(num_clippolygons) && num_clippolygons > 0\nbool pointInClipPolygon(vec3 point, int polyIdx) {\n\n\tmat4 wvp = uClipPolygonWVP[polyIdx];\n\t//vec4 screenClipPos = uClipPolygonVP[polyIdx] * modelMatrix * vec4(point, 1.0);\n\t//screenClipPos.xy = screenClipPos.xy / screenClipPos.w * 0.5 + 0.5;\n\n\tvec4 pointNDC = wvp * vec4(point, 1.0);\n\tpointNDC.xy = pointNDC.xy / pointNDC.w;\n\n\tint j = uClipPolygonVCount[polyIdx] - 1;\n\tbool c = false;\n\tfor(int i = 0; i < 8; i++) {\n\t\tif(i == uClipPolygonVCount[polyIdx]) {\n\t\t\tbreak;\n\t\t}\n\n\t\t//vec4 verti = wvp * vec4(uClipPolygonVertices[polyIdx * 8 + i], 1);\n\t\t//vec4 vertj = wvp * vec4(uClipPolygonVertices[polyIdx * 8 + j], 1);\n\n\t\t//verti.xy = verti.xy / verti.w;\n\t\t//vertj.xy = vertj.xy / vertj.w;\n\n\t\t//verti.xy = verti.xy / verti.w * 0.5 + 0.5;\n\t\t//vertj.xy = vertj.xy / vertj.w * 0.5 + 0.5;\n\n\t\tvec3 verti = uClipPolygonVertices[polyIdx * 8 + i];\n\t\tvec3 vertj = uClipPolygonVertices[polyIdx * 8 + j];\n\n\t\tif( ((verti.y > pointNDC.y) != (vertj.y > pointNDC.y)) && \n\t\t\t(pointNDC.x < (vertj.x-verti.x) * (pointNDC.y-verti.y) / (vertj.y-verti.y) + verti.x) ) {\n\t\t\tc = !c;\n\t\t}\n\t\tj = i;\n\t}\n\n\treturn c;\n}\n#endif\n\nvoid doClipping(){\n\n\t#if !defined color_type_composite\n\t\tvec4 cl = getClassification(); \n\t\tif(cl.a == 0.0){\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t#endif\n\n\tint clipVolumesCount = 0;\n\tint insideCount = 0;\n\n\t#if defined(num_clipboxes) && num_clipboxes > 0\n\t\tfor(int i = 0; i < num_clipboxes; i++){\n\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );\n\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\n\n\t\t\tinsideCount = insideCount + (inside ? 1 : 0);\n\t\t\tclipVolumesCount++;\n\t\t}\t\n\t#endif\n\n\t#if defined(num_clippolygons) && num_clippolygons > 0\n\t\tfor(int i = 0; i < num_clippolygons; i++) {\n\t\t\tbool inside = pointInClipPolygon(position, i);\n\n\t\t\tinsideCount = insideCount + (inside ? 1 : 0);\n\t\t\tclipVolumesCount++;\n\t\t}\n\t#endif\n\n\tbool insideAny = insideCount > 0;\n\tbool insideAll = (clipVolumesCount > 0) && (clipVolumesCount == insideCount);\n\n\tif(clipMethod == CLIPMETHOD_INSIDE_ANY){\n\t\tif(insideAny && clipTask == CLIPTASK_HIGHLIGHT){\n\t\t\tvColor.r += 0.5;\n\t\t}else if(!insideAny && clipTask == CLIPTASK_SHOW_INSIDE){\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}else if(insideAny && clipTask == CLIPTASK_SHOW_OUTSIDE){\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t}else if(clipMethod == CLIPMETHOD_INSIDE_ALL){\n\t\tif(insideAll && clipTask == CLIPTASK_HIGHLIGHT){\n\t\t\tvColor.r += 0.5;\n\t\t}else if(!insideAll && clipTask == CLIPTASK_SHOW_INSIDE){\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}else if(insideAll && clipTask == CLIPTASK_SHOW_OUTSIDE){\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t}\n}\n\n\n\n// \n// ##     ##    ###    #### ##    ## \n// ###   ###   ## ##    ##  ###   ## \n// #### ####  ##   ##   ##  ####  ## \n// ## ### ## ##     ##  ##  ## ## ## \n// ##     ## #########  ##  ##  #### \n// ##     ## ##     ##  ##  ##   ### \n// ##     ## ##     ## #### ##    ## \n//\n\nvoid main() {\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tvViewPosition = mvPosition.xyz;\n\tgl_Position = projectionMatrix * mvPosition;\n\tvLogDepth = log2(-mvPosition.z);\n\n\t// POINT SIZE\n\tfloat pointSize = getPointSize();\n\tgl_PointSize = pointSize;\n\tvPointSize = pointSize;\n\n\t// COLOR\n\tvColor = getColor();\n\n\n\t#if defined hq_depth_pass\n\t\tfloat originalDepth = gl_Position.w;\n\t\tfloat adjustedDepth = originalDepth + 2.0 * vRadius;\n\t\tfloat adjust = adjustedDepth / originalDepth;\n\n\t\tmvPosition.xyz = mvPosition.xyz * adjust;\n\t\tgl_Position = projectionMatrix * mvPosition;\n\t#endif\n\n\n\t// CLIPPING\n\tdoClipping();\n\n\t#if defined(num_clipspheres) && num_clipspheres > 0\n\t\tfor(int i = 0; i < num_clipspheres; i++){\n\t\t\tvec4 sphereLocal = uClipSpheres[i] * mvPosition;\n\n\t\t\tfloat distance = length(sphereLocal.xyz);\n\n\t\t\tif(distance < 1.0){\n\t\t\t\tfloat w = distance;\n\t\t\t\tvec3 cGradient = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\n\t\t\t\t\n\t\t\t\tvColor = cGradient;\n\t\t\t\t//vColor = cGradient * 0.7 + vColor * 0.3;\n\t\t\t}\n\t\t}\n\t#endif\n\n\t#if defined(num_shadowmaps) && num_shadowmaps > 0\n\n\t\tconst float sm_near = 0.1;\n\t\tconst float sm_far = 10000.0;\n\n\t\tfor(int i = 0; i < num_shadowmaps; i++){\n\t\t\tvec3 viewPos = (uShadowWorldView[i] * vec4(position, 1.0)).xyz;\n\t\t\tfloat distanceToLight = abs(viewPos.z);\n\t\t\t\n\t\t\tvec4 projPos = uShadowProj[i] * uShadowWorldView[i] * vec4(position, 1);\n\t\t\tvec3 nc = projPos.xyz / projPos.w;\n\t\t\t\n\t\t\tfloat u = nc.x * 0.5 + 0.5;\n\t\t\tfloat v = nc.y * 0.5 + 0.5;\n\n\t\t\tvec2 sampleStep = vec2(1.0 / (2.0*1024.0), 1.0 / (2.0*1024.0)) * 1.5;\n\t\t\tvec2 sampleLocations[9];\n\t\t\tsampleLocations[0] = vec2(0.0, 0.0);\n\t\t\tsampleLocations[1] = sampleStep;\n\t\t\tsampleLocations[2] = -sampleStep;\n\t\t\tsampleLocations[3] = vec2(sampleStep.x, -sampleStep.y);\n\t\t\tsampleLocations[4] = vec2(-sampleStep.x, sampleStep.y);\n\n\t\t\tsampleLocations[5] = vec2(0.0, sampleStep.y);\n\t\t\tsampleLocations[6] = vec2(0.0, -sampleStep.y);\n\t\t\tsampleLocations[7] = vec2(sampleStep.x, 0.0);\n\t\t\tsampleLocations[8] = vec2(-sampleStep.x, 0.0);\n\n\t\t\tfloat visibleSamples = 0.0;\n\t\t\tfloat numSamples = 0.0;\n\n\t\t\tfloat bias = vRadius * 2.0;\n\n\t\t\tfor(int j = 0; j < 9; j++){\n\t\t\t\tvec4 depthMapValue = texture2D(uShadowMap[i], vec2(u, v) + sampleLocations[j]);\n\n\t\t\t\tfloat linearDepthFromSM = depthMapValue.x + bias;\n\t\t\t\tfloat linearDepthFromViewer = distanceToLight;\n\n\t\t\t\tif(linearDepthFromSM > linearDepthFromViewer){\n\t\t\t\t\tvisibleSamples += 1.0;\n\t\t\t\t}\n\n\t\t\t\tnumSamples += 1.0;\n\t\t\t}\n\n\t\t\tfloat visibility = visibleSamples / numSamples;\n\n\t\t\tif(u < 0.0 || u > 1.0 || v < 0.0 || v > 1.0 || nc.x < -1.0 || nc.x > 1.0 || nc.y < -1.0 || nc.y > 1.0 || nc.z < -1.0 || nc.z > 1.0){\n\t\t\t\t//vColor = vec3(0.0, 0.0, 0.2);\n\t\t\t}else{\n\t\t\t\t//vColor = vec3(1.0, 1.0, 1.0) * visibility + vec3(1.0, 1.0, 1.0) * vec3(0.5, 0.0, 0.0) * (1.0 - visibility);\n\t\t\t\tvColor = vColor * visibility + vColor * uShadowColor * (1.0 - visibility);\n\t\t\t}\n\t\t}\n\n\t#endif\n\n\t//vColor = vec3(1.0, 0.0, 0.0);\n\n\t//if(uDebug){\n\t//\tvColor.b = (vColor.r + vColor.g + vColor.b) / 3.0;\n\t//\tvColor.r = 1.0;\n\t//\tvColor.g = 1.0;\n\t//}\n\n}\n';
Potree.Shaders['pointcloud.fs']='\n#if defined paraboloid_point_shape\n\t#extension GL_EXT_frag_depth : enable\n#endif\n\nprecision highp float;\nprecision highp int;\n\nuniform mat4 viewMatrix;\nuniform mat4 uViewInv;\nuniform mat4 uProjInv;\nuniform vec3 cameraPosition;\n\n\nuniform mat4 projectionMatrix;\nuniform float uOpacity;\n\nuniform float blendHardness;\nuniform float blendDepthSupplement;\nuniform float fov;\nuniform float uSpacing;\nuniform float near;\nuniform float far;\nuniform float uPCIndex;\nuniform float uScreenWidth;\nuniform float uScreenHeight;\n\nvarying vec3\tvColor;\nvarying float\tvLogDepth;\nvarying vec3\tvViewPosition;\nvarying float\tvRadius;\nvarying float \tvPointSize;\nvarying vec3 \tvPosition;\n\n\nfloat specularStrength = 1.0;\n\nvoid main() {\n\n\tvec3 color = vColor;\n\tfloat depth = gl_FragCoord.z;\n\n\t#if defined(circle_point_shape) || defined(paraboloid_point_shape) \n\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;\n\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;\n\t#endif\n\t\n\t#if defined(circle_point_shape) \n\t\tfloat cc = u*u + v*v;\n\t\tif(cc > 1.0){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\t\t\n\t#if defined color_type_point_index\n\t\tgl_FragColor = vec4(color, uPCIndex / 255.0);\n\t#else\n\t\tgl_FragColor = vec4(color, uOpacity);\n\t#endif\n\n\t#if defined paraboloid_point_shape\n\t\tfloat wi = 0.0 - ( u*u + v*v);\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\n\t\tpos.z += wi * vRadius;\n\t\tfloat linearDepth = -pos.z;\n\t\tpos = projectionMatrix * pos;\n\t\tpos = pos / pos.w;\n\t\tfloat expDepth = pos.z;\n\t\tdepth = (pos.z + 1.0) / 2.0;\n\t\tgl_FragDepthEXT = depth;\n\t\t\n\t\t#if defined(color_type_depth)\n\t\t\tcolor.r = linearDepth;\n\t\t\tcolor.g = expDepth;\n\t\t#endif\n\t\t\n\t\t#if defined(use_edl)\n\t\t\tgl_FragColor.a = log2(linearDepth);\n\t\t#endif\n\t\t\n\t#else\n\t\t#if defined(use_edl)\n\t\t\tgl_FragColor.a = vLogDepth;\n\t\t#endif\n\t#endif\n\n\t#if defined(weighted_splats)\n\t\tfloat distance = 2.0 * length(gl_PointCoord.xy - 0.5);\n\t\tfloat weight = max(0.0, 1.0 - distance);\n\t\tweight = pow(weight, 1.5);\n\n\t\tgl_FragColor.a = weight;\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * weight;\n\t#endif\n\t\n}\n\n\n';
Potree.Shaders['pointcloud_sm.vs']='\nprecision mediump float;\nprecision mediump int;\n\nattribute vec3 position;\nattribute vec3 color;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\n\nuniform float uScreenWidth;\nuniform float uScreenHeight;\nuniform float near;\nuniform float far;\n\nuniform float uSpacing;\nuniform float uOctreeSize;\nuniform float uLevel;\nuniform float uVNStart;\n\nuniform sampler2D visibleNodes;\n\nvarying float vLinearDepth;\nvarying vec3 vColor;\n\n#define PI 3.141592653589793\n\n\n\n// ---------------------\n// OCTREE\n// ---------------------\n\n#if defined(adaptive_point_size)\n/**\n * number of 1-bits up to inclusive index position\n * number is treated as if it were an integer in the range 0-255\n *\n */\nfloat numberOfOnes(float number, float index){\n\tfloat tmp = mod(number, pow(2.0, index + 1.0));\n\tfloat numOnes = 0.0;\n\tfor(float i = 0.0; i < 8.0; i++){\n\t\tif(mod(tmp, 2.0) != 0.0){\n\t\t\tnumOnes++;\n\t\t}\n\t\ttmp = floor(tmp / 2.0);\n\t}\n\treturn numOnes;\n}\n\n\n/**\n * checks whether the bit at index is 1\n * number is treated as if it were an integer in the range 0-255\n *\n */\nbool isBitSet(float number, float index){\n\treturn mod(floor(number / pow(2.0, index)), 2.0) != 0.0;\n}\n\n\n/**\n * find the LOD at the point position\n */\nfloat getLOD(){\n\t\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tfloat iOffset = uVNStart;\n\tfloat depth = uLevel;\n\tfor(float i = 0.0; i <= 30.0; i++){\n\t\tfloat nodeSizeAtLevel = uOctreeSize  / pow(2.0, i + uLevel + 0.0);\n\t\t\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\tindex3d = floor(index3d + 0.5);\n\t\tfloat index = 4.0 * index3d.x + 2.0 * index3d.y + index3d.z;\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n\t\tfloat mask = value.r * 255.0;\n\t\tif(isBitSet(mask, index)){\n\t\t\t// there are more visible child nodes at this position\n\t\t\tiOffset = iOffset + value.g * 255.0 * 256.0 + value.b * 255.0 + numberOfOnes(mask, index - 1.0);\n\t\t\tdepth++;\n\t\t}else{\n\t\t\t// no more visible child nodes at this position\n\t\t\treturn depth;\n\t\t}\n\t\t\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t}\n\t\t\n\treturn depth;\n}\n\n#endif\n\nfloat getPointSize(){\n\tfloat pointSize = 1.0;\n\t\n\tfloat slope = tan(fov / 2.0);\n\tfloat projFactor =  -0.5 * uScreenHeight / (slope * vViewPosition.z);\n\t\n\tfloat r = uOctreeSpacing * 1.5;\n\tvRadius = r;\n\t#if defined fixed_point_size\n\t\tpointSize = size;\n\t#elif defined attenuated_point_size\n\t\tif(uUseOrthographicCamera){\n\t\t\tpointSize = size;\t\t\t\n\t\t}else{\n\t\t\tpointSize = pointSize * projFactor;\n\t\t}\n\t#elif defined adaptive_point_size\n\t\tif(uUseOrthographicCamera) {\n\t\t\tfloat worldSpaceSize = 1.5 * size * r / getPointSizeAttenuation();\n\t\t\tpointSize = (worldSpaceSize / uOrthoWidth) * uScreenWidth;\n\t\t} else {\n\t\t\tfloat worldSpaceSize = 1.5 * size * r / getPointSizeAttenuation();\n\t\t\tpointSize = worldSpaceSize * projFactor;\n\t\t}\n\t#endif\n\n\tpointSize = max(minSize, pointSize);\n\tpointSize = min(maxSize, pointSize);\n\t\n\tvRadius = pointSize / projFactor;\n\n\treturn pointSize;\n}\n\n\nvoid main() {\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tvLinearDepth = gl_Position.w;\n\n\tfloat pointSize = getPointSize();\n\tgl_PointSize = pointSize;\n\n}\n';
Potree.Shaders['pointcloud_sm.fs']='\nprecision mediump float;\nprecision mediump int;\n\nvarying vec3 vColor;\nvarying float vLinearDepth;\n\nvoid main() {\n\n\t//gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\t//gl_FragColor = vec4(vColor, 1.0);\n\t//gl_FragColor = vec4(vLinearDepth, pow(vLinearDepth, 2.0), 0.0, 1.0);\n\tgl_FragColor = vec4(vLinearDepth, vLinearDepth / 30.0, vLinearDepth / 30.0, 1.0);\n\t\n}\n\n\n';Potree.Shaders['normalize.vs']='\nprecision mediump float;\nprecision mediump int;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nvarying vec2 vUv;\n\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n}';
Potree.Shaders['normalize.fs']='\n#extension GL_EXT_frag_depth : enable\n\nprecision mediump float;\nprecision mediump int;\n\nuniform sampler2D uWeightMap;\nuniform sampler2D uDepthMap;\n\nvarying vec2 vUv;\n\nvoid main() {\n\tfloat depth = texture2D(uDepthMap, vUv).r;\n\t\n\tif(depth >= 1.0){\n\t\tdiscard;\n\t}\n\n\tgl_FragColor = vec4(depth, 1.0, 0.0, 1.0);\n\n\tvec4 color = texture2D(uWeightMap, vUv); \n\tcolor = color / color.w;\n\t\n\tgl_FragColor = vec4(color.xyz, 1.0); \n\t\n\tgl_FragDepthEXT = depth;\n\n\n}';
Potree.Shaders['normalize_and_edl.fs']='\n#extension GL_EXT_frag_depth : enable\n\nprecision mediump float;\nprecision mediump int;\n\nuniform sampler2D uWeightMap;\nuniform sampler2D uEDLMap;\nuniform sampler2D uDepthMap;\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform vec2 neighbours[NEIGHBOUR_COUNT];\nuniform float edlStrength;\nuniform float radius;\n\nvarying vec2 vUv;\n\nfloat response(float depth){\n\tvec2 uvRadius = radius / vec2(screenWidth, screenHeight);\n\t\n\tfloat sum = 0.0;\n\t\n\tfor(int i = 0; i < NEIGHBOUR_COUNT; i++){\n\t\tvec2 uvNeighbor = vUv + uvRadius * neighbours[i];\n\t\t\n\t\tfloat neighbourDepth = texture2D(uEDLMap, uvNeighbor).a;\n\n\t\tif(neighbourDepth != 0.0){\n\t\t\tif(depth == 0.0){\n\t\t\t\tsum += 100.0;\n\t\t\t}else{\n\t\t\t\tsum += max(0.0, depth - neighbourDepth);\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn sum / float(NEIGHBOUR_COUNT);\n}\n\nvoid main() {\n\n\tfloat edlDepth = texture2D(uEDLMap, vUv).a;\n\tfloat res = response(edlDepth);\n\tfloat shade = exp(-res * 300.0 * edlStrength);\n\n\tfloat depth = texture2D(uDepthMap, vUv).r;\n\tif(depth >= 1.0 && res == 0.0){\n\t\tdiscard;\n\t}\n\t\n\tvec4 color = texture2D(uWeightMap, vUv); \n\tcolor = color / color.w;\n\tcolor = color * shade;\n\n\tgl_FragColor = vec4(color.xyz, 1.0); \n\n\tgl_FragDepthEXT = depth;\n}';
Potree.Shaders['edl.vs']='\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\t\n\tvec4 mvPosition = modelViewMatrix * vec4(position,1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n}';Potree.Shaders['edl.fs']='// \n// adapted from the EDL shader code from Christian Boucheny in cloud compare:\n// https://github.com/cloudcompare/trunk/tree/master/plugins/qEDL/shaders/EDL\n//\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform vec2 neighbours[NEIGHBOUR_COUNT];\nuniform float edlStrength;\nuniform float radius;\nuniform float opacity;\n\n//uniform sampler2D colorMap;\nuniform sampler2D uRegularColor;\nuniform sampler2D uRegularDepth;\nuniform sampler2D uEDLColor;\nuniform sampler2D uEDLDepth;\n\nvarying vec2 vUv;\n\nfloat response(float depth){\n\tvec2 uvRadius = radius / vec2(screenWidth, screenHeight);\n\t\n\tfloat sum = 0.0;\n\t\n\tfor(int i = 0; i < NEIGHBOUR_COUNT; i++){\n\t\tvec2 uvNeighbor = vUv + uvRadius * neighbours[i];\n\t\t\n\t\tfloat neighbourDepth = texture2D(uEDLColor, uvNeighbor).a;\n\t\tneighbourDepth = (neighbourDepth == 1.0) ? 0.0 : neighbourDepth;\n\n\t\tif(neighbourDepth != 0.0){\n\t\t\tif(depth == 0.0){\n\t\t\t\tsum += 100.0;\n\t\t\t}else{\n\t\t\t\tsum += max(0.0, depth - neighbourDepth);\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn sum / float(NEIGHBOUR_COUNT);\n}\n\nvoid main(){\n\tvec4 cReg = texture2D(uRegularColor, vUv);\n\tvec4 cEDL = texture2D(uEDLColor, vUv);\n\t\n\tfloat depth = cEDL.a;\n\tdepth = (depth == 1.0) ? 0.0 : depth;\n\tfloat res = response(depth);\n\tfloat shade = exp(-res * 300.0 * edlStrength);\n\n\tfloat dReg = texture2D(uRegularDepth, vUv).r;\n\tfloat dEDL = texture2D(uEDLDepth, vUv).r;\n\n\tif(dEDL < dReg){\n\t\tgl_FragColor = vec4(cEDL.rgb * shade, opacity);\n\t}else{\n\t\tgl_FragColor = vec4(cReg.rgb * shade, cReg.a);\n\t}\n\n}\n';
Potree.Shaders['blur.vs']='\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);\n}';Potree.Shaders['blur.fs']='\nuniform mat4 projectionMatrix;\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform float near;\nuniform float far;\n\nuniform sampler2D map;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tfloat dx = 1.0 / screenWidth;\n\tfloat dy = 1.0 / screenHeight;\n\n\tvec3 color = vec3(0.0, 0.0, 0.0);\n\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;\n    \n\tcolor = color / 9.0;\n\t\n\tgl_FragColor = vec4(color, 1.0);\n\t\n\t\n}';
Potree.POCLoader=function(){};
Potree.POCLoader.load=function(a,b){try{var c=new Potree.PointCloudOctreeGeometry;c.url=a;var d=Potree.XHRFactory.createXMLHttpRequest();d.open('GET',a,!0);d.onreadystatechange=function(){if(4===d.readyState&&(200===d.status||0===d.status)){var e=JSON.parse(d.responseText),f=new Potree.Version(e.version);0===e.octreeDir.indexOf('http')?c.octreeDir=e.octreeDir:c.octreeDir=a+'/../'+e.octreeDir;c.spacing=e.spacing;c.hierarchyStepSize=e.hierarchyStepSize;c.pointAttributes=e.pointAttributes;var g=new THREE.Vector3(e.boundingBox.lx,
e.boundingBox.ly,e.boundingBox.lz),h=new THREE.Vector3(e.boundingBox.ux,e.boundingBox.uy,e.boundingBox.uz);h=new THREE.Box3(g,h);var l=h.clone();e.tightBoundingBox&&(l.min.copy(new THREE.Vector3(e.tightBoundingBox.lx,e.tightBoundingBox.ly,e.tightBoundingBox.lz)),l.max.copy(new THREE.Vector3(e.tightBoundingBox.ux,e.tightBoundingBox.uy,e.tightBoundingBox.uz)));g=g.clone();h.min.sub(g);h.max.sub(g);l.min.sub(g);l.max.sub(g);c.projection=e.projection;c.boundingBox=h;c.tightBoundingBox=l;c.boundingSphere=
h.getBoundingSphere(new THREE.Sphere);c.tightBoundingSphere=l.getBoundingSphere(new THREE.Sphere);c.offset=g;'LAS'===e.pointAttributes?c.loader=new Potree.LasLazLoader(e.version):'LAZ'===e.pointAttributes?c.loader=new Potree.LasLazLoader(e.version):(c.loader=new Potree.BinaryLoader(e.version,h,e.scale),c.pointAttributes=new Potree.PointAttributes(c.pointAttributes));g={};h=new Potree.PointCloudOctreeGeometryNode('r',c,h);h.level=0;h.hasChildren=!0;h.spacing=c.spacing;f.upTo('1.5')?h.numPoints=e.hierarchy[0][1]:
h.numPoints=0;c.root=h;c.root.load();g.r=h;if(f.upTo('1.4'))for(f=1;f<e.hierarchy.length;f++){h=e.hierarchy[f][0];l=e.hierarchy[f][1];var k=parseInt(h.charAt(h.length-1)),m=h.substring(0,h.length-1);m=g[m];var p=h.length-1;k=Potree.POCLoader.createChildAABB(m.boundingBox,k);k=new Potree.PointCloudOctreeGeometryNode(h,c,k);k.level=p;k.numPoints=l;k.spacing=c.spacing/Math.pow(2,p);m.addChild(k);g[h]=k}c.nodes=g;b(c)}};d.send(null)}catch(e){console.log("loading failed: '"+a+"'"),console.log(e),b()}};
Potree.POCLoader.loadPointAttributes=function(a){a=a.pointAttributes;for(var b=new Potree.PointAttributes,c=0;c<a.length;c++)b.add(Potree.PointAttribute[a[c]]);return b};Potree.POCLoader.createChildAABB=function(a,b){var c=a.min.clone();a=a.max.clone();var d=(new THREE.Vector3).subVectors(a,c);0<(b&1)?c.z+=d.z/2:a.z-=d.z/2;0<(b&2)?c.y+=d.y/2:a.y-=d.y/2;0<(b&4)?c.x+=d.x/2:a.x-=d.x/2;return new THREE.Box3(c,a)};Potree.PointAttributeNames={};Potree.PointAttributeNames.POSITION_CARTESIAN=0;
Potree.PointAttributeNames.COLOR_PACKED=1;Potree.PointAttributeNames.COLOR_FLOATS_1=2;Potree.PointAttributeNames.COLOR_FLOATS_255=3;Potree.PointAttributeNames.NORMAL_FLOATS=4;Potree.PointAttributeNames.FILLER=5;Potree.PointAttributeNames.INTENSITY=6;Potree.PointAttributeNames.CLASSIFICATION=7;Potree.PointAttributeNames.NORMAL_SPHEREMAPPED=8;Potree.PointAttributeNames.NORMAL_OCT16=9;Potree.PointAttributeNames.NORMAL=10;Potree.PointAttributeNames.RETURN_NUMBER=11;
Potree.PointAttributeNames.NUMBER_OF_RETURNS=12;Potree.PointAttributeNames.SOURCE_ID=13;Potree.PointAttributeNames.INDICES=14;Potree.PointAttributeNames.SPACING=15;
Potree.PointAttributeTypes={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}};var i=0,obj;for(obj in Potree.PointAttributeTypes)Potree.PointAttributeTypes[i]=Potree.PointAttributeTypes[obj],i++;
Potree.PointAttribute=function(a,b,c){this.name=a;this.type=b;this.numElements=c;this.byteSize=this.numElements*this.type.size};Potree.PointAttribute.POSITION_CARTESIAN=new Potree.PointAttribute(Potree.PointAttributeNames.POSITION_CARTESIAN,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3);Potree.PointAttribute.RGBA_PACKED=new Potree.PointAttribute(Potree.PointAttributeNames.COLOR_PACKED,Potree.PointAttributeTypes.DATA_TYPE_INT8,4);Potree.PointAttribute.COLOR_PACKED=Potree.PointAttribute.RGBA_PACKED;
Potree.PointAttribute.RGB_PACKED=new Potree.PointAttribute(Potree.PointAttributeNames.COLOR_PACKED,Potree.PointAttributeTypes.DATA_TYPE_INT8,3);Potree.PointAttribute.NORMAL_FLOATS=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_FLOATS,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3);Potree.PointAttribute.FILLER_1B=new Potree.PointAttribute(Potree.PointAttributeNames.FILLER,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1);
Potree.PointAttribute.INTENSITY=new Potree.PointAttribute(Potree.PointAttributeNames.INTENSITY,Potree.PointAttributeTypes.DATA_TYPE_UINT16,1);Potree.PointAttribute.CLASSIFICATION=new Potree.PointAttribute(Potree.PointAttributeNames.CLASSIFICATION,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1);Potree.PointAttribute.NORMAL_SPHEREMAPPED=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_SPHEREMAPPED,Potree.PointAttributeTypes.DATA_TYPE_UINT8,2);
Potree.PointAttribute.NORMAL_OCT16=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_OCT16,Potree.PointAttributeTypes.DATA_TYPE_UINT8,2);Potree.PointAttribute.NORMAL=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3);Potree.PointAttribute.RETURN_NUMBER=new Potree.PointAttribute(Potree.PointAttributeNames.RETURN_NUMBER,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1);
Potree.PointAttribute.NUMBER_OF_RETURNS=new Potree.PointAttribute(Potree.PointAttributeNames.NUMBER_OF_RETURNS,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1);Potree.PointAttribute.SOURCE_ID=new Potree.PointAttribute(Potree.PointAttributeNames.SOURCE_ID,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1);Potree.PointAttribute.INDICES=new Potree.PointAttribute(Potree.PointAttributeNames.INDICES,Potree.PointAttributeTypes.DATA_TYPE_UINT32,1);
Potree.PointAttribute.SPACING=new Potree.PointAttribute(Potree.PointAttributeNames.SPACING,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,1);Potree.PointAttributes=function(a){this.attributes=[];this.size=this.byteSize=0;if(null!=a)for(var b=0;b<a.length;b++){var c=Potree.PointAttribute[a[b]];this.attributes.push(c);this.byteSize+=c.byteSize;this.size++}};Potree.PointAttributes.prototype.add=function(a){this.attributes.push(a);this.byteSize+=a.byteSize;this.size++};
Potree.PointAttributes.prototype.hasColors=function(){for(var a in this.attributes)if(this.attributes[a].name===Potree.PointAttributeNames.COLOR_PACKED)return!0;return!1};Potree.PointAttributes.prototype.hasNormals=function(){for(var a in this.attributes){var b=this.attributes[a];if(b===Potree.PointAttribute.NORMAL_SPHEREMAPPED||b===Potree.PointAttribute.NORMAL_FLOATS||b===Potree.PointAttribute.NORMAL||b===Potree.PointAttribute.NORMAL_OCT16)return!0}return!1};
var lib$potree$potree_clean$classdecl$var8=function(a,b,c){this.version='string'===typeof a?new Potree.Version(a):a;this.boundingBox=b;this.scale=c};
lib$potree$potree_clean$classdecl$var8.prototype.load=function(a){var b=this;if(!a.loaded){var c=a.getURL();this.version.equalOrHigher('1.4')&&(c+='.bin');var d=Potree.XHRFactory.createXMLHttpRequest();d.open('GET',c,!0);d.responseType='arraybuffer';d.overrideMimeType('text/plain; charset=x-user-defined');d.onreadystatechange=function(){if(4===d.readyState){if(200!==d.status&&0!==d.status||null===d.response)throw Error('Failed to load file! HTTP status: '+d.status+', file: '+c);b.parse(a,d.response)}};
try{d.send(null)}catch(e){console.log('fehler beim laden der punktwolke: '+e)}}};
lib$potree$potree_clean$classdecl$var8.prototype.parse=function(a,b){var c=a.pcoGeometry.pointAttributes,d=b.byteLength/a.pcoGeometry.pointAttributes.byteSize;this.version.upTo('1.5')&&(a.numPoints=d);var e=Potree.scriptPath+'/workers/BinaryDecoderWorker.js',f=Potree.workerPool.getWorker(e);f.onmessage=function(b){var d=b.data,g=d.attributeBuffers,k=new THREE.Box3((new THREE.Vector3).fromArray(d.tightBoundingBox.min),(new THREE.Vector3).fromArray(d.tightBoundingBox.max));Potree.workerPool.returnWorker(e,
f);var m=new THREE.BufferGeometry,p;for(p in g){var n=g[p].buffer;parseInt(p)===Potree.PointAttributeNames.POSITION_CARTESIAN?m.addAttribute('position',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(p)===Potree.PointAttributeNames.COLOR_PACKED?m.addAttribute('color',new THREE.BufferAttribute(new Uint8Array(n),4,!0)):parseInt(p)===Potree.PointAttributeNames.INTENSITY?m.addAttribute('intensity',new THREE.BufferAttribute(new Float32Array(n),1)):parseInt(p)===Potree.PointAttributeNames.CLASSIFICATION?
m.addAttribute('classification',new THREE.BufferAttribute(new Uint8Array(n),1)):parseInt(p)===Potree.PointAttributeNames.NORMAL_SPHEREMAPPED?m.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(p)===Potree.PointAttributeNames.NORMAL_OCT16?m.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(p)===Potree.PointAttributeNames.NORMAL?m.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(p)===Potree.PointAttributeNames.INDICES?
(n=new THREE.BufferAttribute(new Uint8Array(n),4),n.normalized=!0,m.addAttribute('indices',n)):parseInt(p)===Potree.PointAttributeNames.SPACING&&(n=new THREE.BufferAttribute(new Float32Array(n),1),m.addAttribute('spacing',n))}k.max.sub(k.min);k.min.set(0,0,0);a.numPoints=b.data.buffer.byteLength/c.byteSize;a.geometry=m;a.mean=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(d.mean))));a.tightBoundingBox=k;a.loaded=!0;a.loading=!1;a.estimatedSpacing=d.estimatedSpacing;
Potree.numNodesLoading--};b={buffer:b,pointAttributes:c,version:this.version.version,min:[a.boundingBox.min.x,a.boundingBox.min.y,a.boundingBox.min.z],offset:[a.pcoGeometry.offset.x,a.pcoGeometry.offset.y,a.pcoGeometry.offset.z],scale:this.scale,spacing:a.spacing,hasChildren:a.hasChildren,name:a.name};f.postMessage(b,[b.buffer])};Potree.BinaryLoader=lib$potree$potree_clean$classdecl$var8;
Potree.GreyhoundBinaryLoader=function(a,b,c){this.version='string'===typeof a?new Potree.Version(a):a;this.boundingBox=b;this.scale=c};
Potree.GreyhoundBinaryLoader.prototype.load=function(a){if(!a.loaded){var b=this,c=a.getURL(),d=Potree.XHRFactory.createXMLHttpRequest();d.open('GET',c,!0);d.responseType='arraybuffer';d.overrideMimeType('text/plain; charset=x-user-defined');d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status?b.parse(a,d.response):console.log('Failed to load file! HTTP status:',d.status,'file:',c))};try{d.send(null)}catch(e){console.log('error loading point cloud: '+e)}}};
Potree.GreyhoundBinaryLoader.prototype.parse=function(a,b){var c=(new DataView(b,b.byteLength-4,4)).getUint32(0,!0),d=a.pcoGeometry.pointAttributes;a.numPoints=c;var e=Potree.scriptPath+'/workers/GreyhoundBinaryDecoderWorker.js',f=Potree.workerPool.getWorker(e);f.onmessage=function(b){b=b.data;var c=b.attributeBuffers,d=new THREE.Box3((new THREE.Vector3).fromArray(b.tightBoundingBox.min),(new THREE.Vector3).fromArray(b.tightBoundingBox.max));Potree.workerPool.returnWorker(e,f);var g=new THREE.BufferGeometry,
h;for(h in c){var n=c[h].buffer;parseInt(h)===Potree.PointAttributeNames.POSITION_CARTESIAN?g.addAttribute('position',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(h)===Potree.PointAttributeNames.COLOR_PACKED?g.addAttribute('color',new THREE.BufferAttribute(new Uint8Array(n),4,!0)):parseInt(h)===Potree.PointAttributeNames.INTENSITY?g.addAttribute('intensity',new THREE.BufferAttribute(new Float32Array(n),1)):parseInt(h)===Potree.PointAttributeNames.CLASSIFICATION?g.addAttribute('classification',
new THREE.BufferAttribute(new Uint8Array(n),1)):parseInt(h)===Potree.PointAttributeNames.NORMAL_SPHEREMAPPED?g.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(h)===Potree.PointAttributeNames.NORMAL_OCT16?g.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(h)===Potree.PointAttributeNames.NORMAL?g.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(h)===Potree.PointAttributeNames.INDICES?(n=new THREE.BufferAttribute(new Uint8Array(n),
4),n.normalized=!0,g.addAttribute('indices',n)):parseInt(h)===Potree.PointAttributeNames.SPACING&&(n=new THREE.BufferAttribute(new Float32Array(n),1),g.addAttribute('spacing',n))}d.max.sub(d.min);d.min.set(0,0,0);a.numPoints=b.numPoints;a.geometry=g;a.mean=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(b.mean))));a.tightBoundingBox=d;a.loaded=!0;a.loading=!1;Potree.numNodesLoading--};c=a.boundingBox;var g=a.pcoGeometry.boundingBox.getCenter().sub(a.boundingBox.min);
b={buffer:b,pointAttributes:d,version:this.version.version,schema:a.pcoGeometry.schema,min:[c.min.x,c.min.y,c.min.z],max:[c.max.x,c.max.y,c.max.z],offset:g.toArray(),scale:this.scale,normalize:a.pcoGeometry.normalize};f.postMessage(b,[b.buffer])};var GreyhoundUtils=function(){};GreyhoundUtils.getQueryParam=function(a){a=a.replace(/[[\]]/g,'\\$&');return(a=(new RegExp('[?&]'+a+'(=([^&#]*)|&|#|$)')).exec(window.location.href))?a[2]?decodeURIComponent(a[2].replace(/\+/g,' ')):'':null};
GreyhoundUtils.createSchema=function(a){var b=[{name:'X',size:4,type:'signed'},{name:'Y',size:4,type:'signed'},{name:'Z',size:4,type:'signed'}];a.forEach(function(a){'COLOR_PACKED'===a?(b.push({name:'Red',size:2,type:'unsigned'}),b.push({name:'Green',size:2,type:'unsigned'}),b.push({name:'Blue',size:2,type:'unsigned'})):'INTENSITY'===a?b.push({name:'Intensity',size:2,type:'unsigned'}):'CLASSIFICATION'===a&&b.push({name:'Classification',size:1,type:'unsigned'})});return b};
GreyhoundUtils.fetch=function(a,b){var c=Potree.XHRFactory.createXMLHttpRequest();c.open('GET',a,!0);c.onreadystatechange=function(){4===c.readyState&&(200===c.status||0===c.status?b(null,c.responseText):b(c.responseText))};c.send(null)};GreyhoundUtils.fetchBinary=function(a,b){var c=Potree.XHRFactory.createXMLHttpRequest();c.open('GET',a,!0);c.responseType='arraybuffer';c.onreadystatechange=function(){4===c.readyState&&(200===c.status||0===c.status?b(null,c.response):b(c.responseText))};c.send(null)};
GreyhoundUtils.pointSizeFrom=function(a){return a.reduce(function(a,c){return a+c.size},0)};
GreyhoundUtils.getNormalization=function(a,b,c){var d=[{name:'X',size:4,type:'floating'},{name:'Y',size:4,type:'floating'},{name:'Z',size:4,type:'floating'},{name:'Red',size:2,type:'unsigned'},{name:'Green',size:2,type:'unsigned'},{name:'Blue',size:2,type:'unsigned'},{name:'Intensity',size:2,type:'unsigned'}];a=a+'read?depth='+b+'&schema='+JSON.stringify(d);GreyhoundUtils.fetchBinary(a,function(a,b){if(a)throw Error(a);a=new DataView(b);b=b.byteLength-4;for(var e=GreyhoundUtils.pointSizeFrom(d),f=
!1,l=!1,k=0;k<b;k+=e){if(255<a.getUint16(k+12,!0)||255<a.getUint16(k+14,!0)||255<a.getUint16(k+16,!0))f=!0;255<a.getUint16(k+18,!0)&&(l=!0);if(f&&l)break}f&&console.log('Normalizing color');l&&console.log('Normalizing intensity');c(null,{color:f,intensity:l})})};Potree.GreyhoundLoader=function(){};Potree.GreyhoundLoader.loadInfoJSON=function(a,b){};
Potree.GreyhoundLoader.load=function(a,b){try{var c=a.split('greyhound://')[1];1===c.split('http://').length&&1===c.split('https://').length&&(c='http://'+c);GreyhoundUtils.fetch(c+'info',function(a,e){if(a)throw Error(a);a=JSON.parse(e);var d=new Potree.Version('1.4'),g=a.bounds;e=a.scale||.01;Array.isArray(e)&&(e=Math.min(e[0],e[1],e[2]));GreyhoundUtils.getQueryParam('scale')&&(e=parseFloat(GreyhoundUtils.getQueryParam('scale')));var h=Math.max(8,a.baseDepth),l=['POSITION_CARTESIAN'],k=!1,m=!1,
p=!1;a.schema.forEach(function(a){'Intensity'===a.name&&l.push('INTENSITY');'Classification'===a.name&&l.push('CLASSIFICATION');'Red'===a.name?k=!0:'Green'===a.name?m=!0:'Blue'===a.name&&(p=!0)});k&&m&&p&&l.push('COLOR_PACKED');var n=new Potree.PointCloudGreyhoundGeometry;n.serverURL=c;n.spacing=(g[3]-g[0])/Math.pow(2,h);n.baseDepth=h;n.hierarchyStepSize=5;n.schema=GreyhoundUtils.createSchema(l);h=GreyhoundUtils.pointSizeFrom(n.schema);n.pointAttributes=new Potree.PointAttributes(l);n.pointAttributes.byteSize=
h;g=new THREE.Box3((new THREE.Vector3).fromArray(g,0),(new THREE.Vector3).fromArray(g,3));h=g.min.clone();g.max.sub(g.min);g.min.set(0,0,0);n.projection=a.srs;n.boundingBox=g;n.boundingSphere=g.getBoundingSphere(new THREE.Sphere);n.scale=e;n.offset=h;console.log('Scale:',e);console.log('Offset:',h);console.log('Bounds:',g);n.loader=new Potree.GreyhoundBinaryLoader(d,g,n.scale);d={};e=new Potree.PointCloudGreyhoundGeometryNode('r',n,g,e,h);e.level=0;e.hasChildren=!0;e.numPoints=a.numPoints;e.spacing=
n.spacing;n.root=e;n.root.load();d.r=e;n.nodes=d;GreyhoundUtils.getNormalization(c,a.baseDepth,function(a,c){c.color&&(n.normalize.color=!0);c.intensity&&(n.normalize.intensity=!0);b(n)})})}catch(d){console.log("loading failed: '"+a+"'"),console.log(d),b()}};Potree.GreyhoundLoader.loadPointAttributes=function(a){a=a.pointAttributes;for(var b=new Potree.PointAttributes,c=0;c<a.length;c++)b.add(Potree.PointAttribute[a[c]]);return b};
Potree.GreyhoundLoader.createChildAABB=function(a,b){var c=a.min;a=a.max;var d=(new THREE.Vector3).copy(a).sub(c).multiplyScalar(.5),e=new THREE.Vector3(d.x,0,0),f=new THREE.Vector3(0,d.y,0),g=new THREE.Vector3(0,0,d.z),h=c,l=(new THREE.Vector3).add(c).add(d);1===b?(c=(new THREE.Vector3).copy(h).add(g),a=(new THREE.Vector3).copy(l).add(g)):3===b?(c=(new THREE.Vector3).copy(h).add(g).add(f),a=(new THREE.Vector3).copy(l).add(g).add(f)):0===b?(c=h,a=l):2===b?(c=(new THREE.Vector3).copy(h).add(f),a=(new THREE.Vector3).copy(l).add(f)):
5===b?(c=(new THREE.Vector3).copy(h).add(g).add(e),a=(new THREE.Vector3).copy(l).add(g).add(e)):7===b?(c=(new THREE.Vector3).copy(h).add(d),a=(new THREE.Vector3).copy(l).add(d)):4===b?(c=(new THREE.Vector3).copy(h).add(e),a=(new THREE.Vector3).copy(l).add(e)):6===b&&(c=(new THREE.Vector3).copy(h).add(e).add(f),a=(new THREE.Vector3).copy(l).add(e).add(f));return new THREE.Box3(c,a)};var lib$potree$potree_clean$classdecl$var9=function(a){this.version='string'===typeof a?new Potree.Version(a):a};
lib$potree$potree_clean$classdecl$var9.progressCB=function(){};
lib$potree$potree_clean$classdecl$var9.prototype.load=function(a){var b=this;if(!a.loaded){var c=a.pcoGeometry.pointAttributes,d=a.getURL();this.version.equalOrHigher('1.4')&&(d+='.'+c.toLowerCase());var e=Potree.XHRFactory.createXMLHttpRequest();e.open('GET',d,!0);e.responseType='arraybuffer';e.overrideMimeType('text/plain; charset=x-user-defined');e.onreadystatechange=function(){4===e.readyState&&(200===e.status?b.parse(a,e.response):console.log('Failed to load file! HTTP status: '+e.status+', file: '+
d))};e.send(null)}};
lib$potree$potree_clean$classdecl$var9.prototype.parse=function(a,b){var c=new LASFile(b),d=new Potree.LasLazBatcher(a);c.open().then(function(a){c.isOpen=!0;return c}).catch(function(a){console.log('failed to open file. :(')}).then(function(a){return a.getHeader().then(function(b){return[a,b]})}).then(function(a){var b=a[0],c=a[1],e=0,l=c.pointsCount,k=function(){return b.readData(1E6,0,1).then(function(a){d.push(new LASDecoder(a.buffer,c.pointsFormatId,c.pointsStructSize,a.count,c.scale,c.offset,
c.mins,c.maxs));e+=a.count;Potree.LasLazLoader.progressCB(e/l);if(a.hasMoreData)return k();c.totalRead=e;c.versionAsString=b.versionAsString;c.isCompressed=b.isCompressed;return[b,c,d]})};return k()}).then(function(a){var b=a[0];Potree.LasLazLoader.progressCB(1);return b.close().then(function(){b.isOpen=!1;return a.slice(1)}).catch(function(a){if(b.isOpen)return b.close().then(function(){b.isOpen=!1;throw a;});throw a;})})};lib$potree$potree_clean$classdecl$var9.prototype.handle=function(a,b){};
Potree.LasLazLoader=lib$potree$potree_clean$classdecl$var9;var lib$potree$potree_clean$classdecl$var10=function(a){this.node=a};
lib$potree$potree_clean$classdecl$var10.prototype.push=function(a){var b=this,c=Potree.scriptPath+'/workers/LASDecoderWorker.js',d=Potree.workerPool.getWorker(c);d.onmessage=function(e){var f=new THREE.BufferGeometry,h=a.pointsCount,l=new Float32Array(e.data.position),k=new Uint8Array(e.data.color),m=new Float32Array(e.data.intensity),p=new Uint8Array(e.data.classification),n=new Uint8Array(e.data.returnNumber),t=new Uint8Array(e.data.numberOfReturns),r=new Uint16Array(e.data.pointSourceID),q=new Uint8Array(e.data.indices);
f.addAttribute('position',new THREE.BufferAttribute(l,3));f.addAttribute('color',new THREE.BufferAttribute(k,4,!0));f.addAttribute('intensity',new THREE.BufferAttribute(m,1));f.addAttribute('classification',new THREE.BufferAttribute(p,1));f.addAttribute('returnNumber',new THREE.BufferAttribute(n,1));f.addAttribute('numberOfReturns',new THREE.BufferAttribute(t,1));f.addAttribute('pointSourceID',new THREE.BufferAttribute(r,1));f.addAttribute('indices',new THREE.BufferAttribute(q,4));f.attributes.indices.normalized=
!0;l=new THREE.Box3((new THREE.Vector3).fromArray(e.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(e.data.tightBoundingBox.max));f.boundingBox=b.node.boundingBox;b.node.tightBoundingBox=l;b.node.geometry=f;b.node.numPoints=h;b.node.loaded=!0;b.node.loading=!1;Potree.numNodesLoading--;b.node.mean=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(e.data.mean))));Potree.workerPool.returnWorker(c,d)};var e={buffer:a.arrayb,numPoints:a.pointsCount,pointSize:a.pointSize,
pointFormatID:2,scale:a.scale,offset:a.offset,mins:a.mins,maxs:a.maxs};d.postMessage(e,[e.buffer])};Potree.LasLazBatcher=lib$potree$potree_clean$classdecl$var10;
Potree.Gradients={RAINBOW:[[0,new THREE.Color(.278,0,.714)],[1/6,new THREE.Color(0,0,1)],[2/6,new THREE.Color(0,1,1)],[.5,new THREE.Color(0,1,0)],[4/6,new THREE.Color(1,1,0)],[5/6,new THREE.Color(1,.64,0)],[1,new THREE.Color(1,0,0)]],SPECTRAL:[[0,new THREE.Color(.3686,.3098,.6353)],[.1,new THREE.Color(.1961,.5333,.7412)],[.2,new THREE.Color(.4,.7608,.6471)],[.3,new THREE.Color(.6706,.8667,.6431)],[.4,new THREE.Color(.902,.9608,.5961)],[.5,new THREE.Color(1,1,.749)],[.6,new THREE.Color(.9961,.8784,
.5451)],[.7,new THREE.Color(.9922,.6824,.3804)],[.8,new THREE.Color(.9569,.4275,.2627)],[.9,new THREE.Color(.8353,.2431,.3098)],[1,new THREE.Color(.6196,.0039,.2588)]],PLASMA:[[0,new THREE.Color(.241,.015,.61)],[.1,new THREE.Color(.387,.001,.654)],[.2,new THREE.Color(.524,.025,.653)],[.3,new THREE.Color(.651,.125,.596)],[.4,new THREE.Color(.752,.227,.513)],[.5,new THREE.Color(.837,.329,.431)],[.6,new THREE.Color(.907,.435,.353)],[.7,new THREE.Color(.963,.554,.272)],[.8,new THREE.Color(.992,.681,.195)],
[.9,new THREE.Color(.987,.822,.144)],[1,new THREE.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new THREE.Color(.1647,.2824,.3451)],[.1,new THREE.Color(.1338,.3555,.4227)],[.2,new THREE.Color(.061,.4319,.4864)],[.3,new THREE.Color(0,.5099,.5319)],[.4,new THREE.Color(0,.5881,.5569)],[.5,new THREE.Color(.137,.665,.5614)],[.6,new THREE.Color(.2906,.7395,.5477)],[.7,new THREE.Color(.4453,.8099,.5201)],[.8,new THREE.Color(.6102,.8748,.485)],[.9,new THREE.Color(.7883,.9323,.4514)],[1,new THREE.Color(.9804,.9804,
.4314)]],VIRIDIS:[[0,new THREE.Color(.267,.005,.329)],[.1,new THREE.Color(.283,.141,.458)],[.2,new THREE.Color(.254,.265,.53)],[.3,new THREE.Color(.207,.372,.553)],[.4,new THREE.Color(.164,.471,.558)],[.5,new THREE.Color(.128,.567,.551)],[.6,new THREE.Color(.135,.659,.518)],[.7,new THREE.Color(.267,.749,.441)],[.8,new THREE.Color(.478,.821,.318)],[.9,new THREE.Color(.741,.873,.15)],[1,new THREE.Color(.993,.906,.144)]],INFERNO:[[0,new THREE.Color(.077,.042,.206)],[.1,new THREE.Color(.225,.036,.388)],
[.2,new THREE.Color(.373,.074,.432)],[.3,new THREE.Color(.522,.128,.42)],[.4,new THREE.Color(.665,.182,.37)],[.5,new THREE.Color(.797,.255,.287)],[.6,new THREE.Color(.902,.364,.184)],[.7,new THREE.Color(.969,.516,.063)],[.8,new THREE.Color(.988,.683,.072)],[.9,new THREE.Color(.961,.859,.298)],[1,new THREE.Color(.988,.998,.645)]],GRAYSCALE:[[0,new THREE.Color(0,0,0)],[1,new THREE.Color(1,1,1)]]};
Potree.Classification={DEFAULT:{0:new THREE.Vector4(.5,.5,.5,1),1:new THREE.Vector4(.5,.5,.5,1),2:new THREE.Vector4(.63,.32,.18,1),3:new THREE.Vector4(0,1,0,1),4:new THREE.Vector4(0,.8,0,1),5:new THREE.Vector4(0,.6,0,1),6:new THREE.Vector4(1,.66,0,1),7:new THREE.Vector4(1,0,1,1),8:new THREE.Vector4(1,0,0,1),9:new THREE.Vector4(0,0,1,1),12:new THREE.Vector4(1,1,0,1),DEFAULT:new THREE.Vector4(.3,.6,.6,.5)}};Potree.PointSizeType={FIXED:0,ATTENUATED:1,ADAPTIVE:2};
Potree.PointShape={SQUARE:0,CIRCLE:1,PARABOLOID:2};Potree.PointColorType={RGB:0,COLOR:1,DEPTH:2,HEIGHT:3,ELEVATION:3,INTENSITY:4,INTENSITY_GRADIENT:5,LOD:6,LEVEL_OF_DETAIL:6,POINT_INDEX:7,CLASSIFICATION:8,RETURN_NUMBER:9,SOURCE:10,NORMAL:11,PHONG:12,RGB_HEIGHT:13,COMPOSITE:50};Potree.TreeType={OCTREE:0,KDTREE:1};
var lib$potree$potree_clean$classdecl$var11=function(a){a=void 0===a?{}:a;var b=THREE.RawShaderMaterial.call(this)||this;b.visibleNodesTexture=Potree.utils.generateDataTexture(2048,1,new THREE.Color(16777215));b.visibleNodesTexture.minFilter=THREE.NearestFilter;b.visibleNodesTexture.magFilter=THREE.NearestFilter;var c=function(a,b){return void 0!==a?a:b},d=c(a.size,1),e=c(a.minSize,2),f=c(a.maxSize,50);a=c(a.treeType,Potree.TreeType.OCTREE);b._pointSizeType=Potree.PointSizeType.FIXED;b._shape=Potree.PointShape.SQUARE;
b._pointColorType=Potree.PointColorType.RGB;b._useClipBox=!1;b.clipBoxes=[];b.clipPolygons=[];b._weighted=!1;b._gradient=Potree.Gradients.SPECTRAL;b.gradientTexture=Potree.PointCloudMaterial.generateGradientTexture(b._gradient);b.lights=!1;b.fog=!1;b._treeType=a;b._useEDL=!1;b._snapEnabled=!1;b._numSnapshots=0;b.defines=new Map;b._defaultIntensityRangeChanged=!1;b._defaultElevationRangeChanged=!1;b.attributes={position:{type:'fv',value:[]},color:{type:'fv',value:[]},normal:{type:'fv',value:[]},intensity:{type:'f',
value:[]},classification:{type:'f',value:[]},returnNumber:{type:'f',value:[]},numberOfReturns:{type:'f',value:[]},pointSourceID:{type:'f',value:[]},indices:{type:'fv',value:[]}};b.uniforms={level:{type:'f',value:0},vnStart:{type:'f',value:0},spacing:{type:'f',value:1},blendHardness:{type:'f',value:2},blendDepthSupplement:{type:'f',value:0},fov:{type:'f',value:1},screenWidth:{type:'f',value:1},screenHeight:{type:'f',value:1},near:{type:'f',value:.1},far:{type:'f',value:1},uColor:{type:'c',value:new THREE.Color(16777215)},
uOpacity:{type:'f',value:1},size:{type:'f',value:d},minSize:{type:'f',value:e},maxSize:{type:'f',value:f},octreeSize:{type:'f',value:0},bbSize:{type:'fv',value:[0,0,0]},elevationRange:{type:'2fv',value:[0,0]},clipBoxCount:{type:'f',value:0},clipPolygonCount:{type:'i',value:0},clipBoxes:{type:'Matrix4fv',value:[]},clipPolygons:{type:'3fv',value:[]},clipPolygonVCount:{type:'iv',value:[]},clipPolygonVP:{type:'Matrix4fv',value:[]},visibleNodes:{type:'t',value:b.visibleNodesTexture},pcIndex:{type:'f',
value:0},gradient:{type:'t',value:b.gradientTexture},classificationLUT:{type:'t',value:b.classificationTexture},uHQDepthMap:{type:'t',value:null},toModel:{type:'Matrix4f',value:[]},diffuse:{type:'fv',value:[1,1,1]},transition:{type:'f',value:.5},intensityRange:{type:'fv',value:[0,65E3]},intensityGamma:{type:'f',value:1},intensityContrast:{type:'f',value:0},intensityBrightness:{type:'f',value:0},rgbGamma:{type:'f',value:1},rgbContrast:{type:'f',value:0},rgbBrightness:{type:'f',value:0},wRGB:{type:'f',
value:1},wIntensity:{type:'f',value:0},wElevation:{type:'f',value:0},wClassification:{type:'f',value:0},wReturnNumber:{type:'f',value:0},wSourceID:{type:'f',value:0},useOrthographicCamera:{type:'b',value:!1},clipTask:{type:'i',value:1},clipMethod:{type:'i',value:1},uSnapshot:{type:'tv',value:[]},uSnapshotDepth:{type:'tv',value:[]},uSnapView:{type:'Matrix4fv',value:[]},uSnapProj:{type:'Matrix4fv',value:[]},uSnapProjInv:{type:'Matrix4fv',value:[]},uSnapViewInv:{type:'Matrix4fv',value:[]},uShadowColor:{type:'3fv',
value:[0,0,0]}};b.classification=Potree.Classification.DEFAULT;b.defaultAttributeValues.normal=[0,0,0];b.defaultAttributeValues.classification=[0,0,0];b.defaultAttributeValues.indices=[0,0,0,0];b.vertexShader=b.getDefines()+Potree.Shaders['pointcloud.vs'];b.fragmentShader=b.getDefines()+Potree.Shaders['pointcloud.fs'];b.vertexColors=THREE.VertexColors;return b};$jscomp.inherits(lib$potree$potree_clean$classdecl$var11,THREE.RawShaderMaterial);
lib$potree$potree_clean$classdecl$var11.prototype.setDefine=function(a,b){void 0!==b&&null!==b?this.defines.get(a)!==b&&(this.defines.set(a,b),this.updateShaderSource()):this.removeDefine(a)};lib$potree$potree_clean$classdecl$var11.prototype.removeDefine=function(a){this.defines.delete(a)};
lib$potree$potree_clean$classdecl$var11.prototype.updateShaderSource=function(){this.vertexShader=this.getDefines()+Potree.Shaders['pointcloud.vs'];this.fragmentShader=this.getDefines()+Potree.Shaders['pointcloud.fs'];1===this.opacity?(this.blending=THREE.NoBlending,this.transparent=!1,this.depthWrite=this.depthTest=!0,this.depthFunc=THREE.LessEqualDepth):1>this.opacity&&!this.useEDL&&(this.blending=THREE.AdditiveBlending,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0,this.depthFunc=THREE.AlwaysDepth);
this.weighted&&(this.blending=THREE.AdditiveBlending,this.depthTest=this.transparent=!0,this.depthWrite=!1);this.needsUpdate=!0};
lib$potree$potree_clean$classdecl$var11.prototype.getDefines=function(){var a=[];this.pointSizeType===Potree.PointSizeType.FIXED?a.push('#define fixed_point_size'):this.pointSizeType===Potree.PointSizeType.ATTENUATED?a.push('#define attenuated_point_size'):this.pointSizeType===Potree.PointSizeType.ADAPTIVE&&a.push('#define adaptive_point_size');this.shape===Potree.PointShape.SQUARE?a.push('#define square_point_shape'):this.shape===Potree.PointShape.CIRCLE?a.push('#define circle_point_shape'):this.shape===
Potree.PointShape.PARABOLOID&&a.push('#define paraboloid_point_shape');this._useEDL&&a.push('#define use_edl');this._snapEnabled&&a.push('#define snap_enabled');this._pointColorType===Potree.PointColorType.RGB?a.push('#define color_type_rgb'):this._pointColorType===Potree.PointColorType.COLOR?a.push('#define color_type_color'):this._pointColorType===Potree.PointColorType.DEPTH?a.push('#define color_type_depth'):this._pointColorType===Potree.PointColorType.HEIGHT?a.push('#define color_type_height'):
this._pointColorType===Potree.PointColorType.INTENSITY?a.push('#define color_type_intensity'):this._pointColorType===Potree.PointColorType.INTENSITY_GRADIENT?a.push('#define color_type_intensity_gradient'):this._pointColorType===Potree.PointColorType.LOD?a.push('#define color_type_lod'):this._pointColorType===Potree.PointColorType.POINT_INDEX?a.push('#define color_type_point_index'):this._pointColorType===Potree.PointColorType.CLASSIFICATION?a.push('#define color_type_classification'):this._pointColorType===
Potree.PointColorType.RETURN_NUMBER?a.push('#define color_type_return_number'):this._pointColorType===Potree.PointColorType.SOURCE?a.push('#define color_type_source'):this._pointColorType===Potree.PointColorType.NORMAL?a.push('#define color_type_normal'):this._pointColorType===Potree.PointColorType.PHONG?a.push('#define color_type_phong'):this._pointColorType===Potree.PointColorType.RGB_HEIGHT?a.push('#define color_type_rgb_height'):this._pointColorType===Potree.PointColorType.COMPOSITE&&a.push('#define color_type_composite');
this._treeType===Potree.TreeType.OCTREE?a.push('#define tree_type_octree'):this._treeType===Potree.TreeType.KDTREE&&a.push('#define tree_type_kdtree');this.weighted&&a.push('#define weighted_splats');for(var b=$jscomp.makeIterator(this.defines),c=b.next();!c.done;c=b.next())c=$jscomp.makeIterator(c.value),c.next(),c=c.next().value,a.push(c);return a.join('\n')};
lib$potree$potree_clean$classdecl$var11.prototype.setClipBoxes=function(a){if(a){var b=this.clipBoxes.length!==a.length&&(0===a.length||0===this.clipBoxes.length);this.uniforms.clipBoxCount.value=this.clipBoxes.length;this.clipBoxes=a;b&&this.updateShaderSource();this.uniforms.clipBoxes.value=new Float32Array(16*this.clipBoxes.length);for(b=0;b<this.clipBoxes.length;b++)this.uniforms.clipBoxes.value.set(a[b].inverse.elements,16*b);for(a=0;a<this.uniforms.clipBoxes.value.length;a++)Number.isNaN(this.uniforms.clipBoxes.value[a])&&
(this.uniforms.clipBoxes.value[a]=Infinity)}};lib$potree$potree_clean$classdecl$var11.prototype.setClipPolygons=function(a,b){a&&(this.clipPolygons=a,this.clipPolygons.length!==a.length&&this.updateShaderSource())};
lib$potree$potree_clean$classdecl$var11.prototype.recomputeClassification=function(){this.classificationTexture=Potree.PointCloudMaterial.generateClassificationTexture(this._classification);this.uniforms.classificationLUT.value=this.classificationTexture;this.dispatchEvent({type:'material_property_changed',target:this})};
lib$potree$potree_clean$classdecl$var11.generateGradientTexture=function(a){var b=document.createElement('canvas');b.width=64;b.height=64;var c=b.getContext('2d');c.rect(0,0,64,64);for(var d=c.createLinearGradient(0,0,64,64),e=0;e<a.length;e++){var f=a[e];d.addColorStop(f[0],'#'+f[1].getHexString())}c.fillStyle=d;c.fill();a=new THREE.CanvasTexture(b);a.needsUpdate=!0;a.minFilter=THREE.LinearFilter;return a};
lib$potree$potree_clean$classdecl$var11.generateClassificationTexture=function(a){for(var b=new Uint8Array(262144),c=0;256>c;c++)for(var d=0;256>d;d++){var e=c+256*d;var f=a[c]?a[c]:a[c%32]?a[c%32]:a.DEFAULT;b[4*e]=255*f.x;b[4*e+1]=255*f.y;b[4*e+2]=255*f.z;b[4*e+3]=255*f.w}a=new THREE.DataTexture(b,256,256,THREE.RGBAFormat);a.magFilter=THREE.NearestFilter;a.needsUpdate=!0;return a};
lib$potree$potree_clean$classdecl$var11.prototype.disableEvents=function(){void 0===this._hiddenListeners&&(this._hiddenListeners=this._listeners,this._listeners={})};lib$potree$potree_clean$classdecl$var11.prototype.enableEvents=function(){this._listeners=this._hiddenListeners;this._hiddenListeners=void 0};lib$potree$potree_clean$classdecl$var11.prototype.copyFrom=function(a){for(var b=$jscomp.makeIterator(this.uniforms),c=b.next();!c.done;c=b.next())c=c.value,this.uniforms[c].value=a.uniforms[c].value};
$jscomp.global.Object.defineProperties(lib$potree$potree_clean$classdecl$var11.prototype,{gradient:{configurable:!0,enumerable:!0,get:function(){return this._gradient},set:function(a){this._gradient!==a&&(this._gradient=a,this.gradientTexture=Potree.PointCloudMaterial.generateGradientTexture(this._gradient),this.uniforms.gradient.value=this.gradientTexture)}},useOrthographicCamera:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.useOrthographicCamera.value},set:function(a){this.uniforms.useOrthographicCamera.value!==
a&&(this.uniforms.useOrthographicCamera.value=a)}},classification:{configurable:!0,enumerable:!0,get:function(){return this._classification},set:function(a){for(var b={},c=$jscomp.makeIterator(Object.keys(a)),d=c.next();!d.done;d=c.next())d=d.value,b[d]=a[d].clone();if(void 0===this._classification)a=!1;else for(a=Object.keys(b).length===Object.keys(this._classification).length,c=$jscomp.makeIterator(Object.keys(b)),d=c.next();!d.done;d=c.next())d=d.value,a=(a=a&&void 0!==this._classification[d])&&
b[d].equals(this._classification[d]);a||(this._classification=b,this.recomputeClassification())}},numSnapshots:{configurable:!0,enumerable:!0,get:function(){return this._numSnapshots},set:function(a){this._numSnapshots=a}},snapEnabled:{configurable:!0,enumerable:!0,get:function(){return this._snapEnabled},set:function(a){this._snapEnabled!==a&&(this._snapEnabled=a,this.updateShaderSource())}},spacing:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.spacing.value},set:function(a){this.uniforms.spacing.value!==
a&&(this.uniforms.spacing.value=a)}},useClipBox:{configurable:!0,enumerable:!0,get:function(){return this._useClipBox},set:function(a){this._useClipBox!==a&&(this._useClipBox=a,this.updateShaderSource())}},clipTask:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.clipTask.value},set:function(a){this.uniforms.clipTask.value=a}},clipMethod:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.clipMethod.value},set:function(a){this.uniforms.clipMethod.value=a}},weighted:{configurable:!0,
enumerable:!0,get:function(){return this._weighted},set:function(a){this._weighted!==a&&(this._weighted=a,this.updateShaderSource())}},fov:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.fov.value},set:function(a){this.uniforms.fov.value!==a&&(this.uniforms.fov.value=a)}},screenWidth:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.screenWidth.value},set:function(a){this.uniforms.screenWidth.value!==a&&(this.uniforms.screenWidth.value=a)}},screenHeight:{configurable:!0,
enumerable:!0,get:function(){return this.uniforms.screenHeight.value},set:function(a){this.uniforms.screenHeight.value!==a&&(this.uniforms.screenHeight.value=a)}},near:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.near.value},set:function(a){this.uniforms.near.value!==a&&(this.uniforms.near.value=a)}},far:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.far.value},set:function(a){this.uniforms.far.value!==a&&(this.uniforms.far.value=a)}},opacity:{configurable:!0,
enumerable:!0,get:function(){return this.uniforms.uOpacity.value},set:function(a){this.uniforms&&this.uniforms.uOpacity&&this.uniforms.uOpacity.value!==a&&(this.uniforms.uOpacity.value=a,this.updateShaderSource(),this.dispatchEvent({type:'opacity_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},pointColorType:{configurable:!0,enumerable:!0,get:function(){return this._pointColorType},set:function(a){this._pointColorType!==a&&(this._pointColorType=a,this.updateShaderSource(),
this.dispatchEvent({type:'point_color_type_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},pointSizeType:{configurable:!0,enumerable:!0,get:function(){return this._pointSizeType},set:function(a){this._pointSizeType!==a&&(this._pointSizeType=a,this.updateShaderSource(),this.dispatchEvent({type:'point_size_type_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},useEDL:{configurable:!0,enumerable:!0,get:function(){return this._useEDL},
set:function(a){this._useEDL!==a&&(this._useEDL=a,this.updateShaderSource())}},color:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.uColor.value},set:function(a){this.uniforms.uColor.value.equals(a)||(this.uniforms.uColor.value.copy(a),this.dispatchEvent({type:'color_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},shape:{configurable:!0,enumerable:!0,get:function(){return this._shape},set:function(a){this._shape!==a&&(this._shape=a,
this.updateShaderSource(),this.dispatchEvent({type:'point_shape_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},treeType:{configurable:!0,enumerable:!0,get:function(){return this._treeType},set:function(a){this._treeType!==a&&(this._treeType=a,this.updateShaderSource())}},bbSize:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.bbSize.value},set:function(a){this.uniforms.bbSize.value=a}},size:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.size.value},
set:function(a){this.uniforms.size.value!==a&&(this.uniforms.size.value=a,this.dispatchEvent({type:'point_size_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},elevationRange:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.elevationRange.value},set:function(a){if(this.uniforms.elevationRange.value[0]!==a[0]||this.uniforms.elevationRange.value[1]!==a[1])this.uniforms.elevationRange.value=a,this._defaultElevationRangeChanged=!0,this.dispatchEvent({type:'material_property_changed',
target:this})}},heightMin:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.elevationRange.value[0]},set:function(a){this.elevationRange=[a,this.elevationRange[1]]}},heightMax:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.elevationRange.value[1]},set:function(a){this.elevationRange=[this.elevationRange[0],a]}},transition:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.transition.value},set:function(a){this.uniforms.transition.value=a}},intensityRange:{configurable:!0,
enumerable:!0,get:function(){return this.uniforms.intensityRange.value},set:function(a){a instanceof Array&&2===a.length&&(a[0]!==this.uniforms.intensityRange.value[0]||a[1]!==this.uniforms.intensityRange.value[1])&&(this.uniforms.intensityRange.value=a,this._defaultIntensityRangeChanged=!0,this.dispatchEvent({type:'material_property_changed',target:this}))}},intensityGamma:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.intensityGamma.value},set:function(a){this.uniforms.intensityGamma.value!==
a&&(this.uniforms.intensityGamma.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},intensityContrast:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.intensityContrast.value},set:function(a){this.uniforms.intensityContrast.value!==a&&(this.uniforms.intensityContrast.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},intensityBrightness:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.intensityBrightness.value},
set:function(a){this.uniforms.intensityBrightness.value!==a&&(this.uniforms.intensityBrightness.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},rgbGamma:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.rgbGamma.value},set:function(a){this.uniforms.rgbGamma.value!==a&&(this.uniforms.rgbGamma.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},rgbContrast:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.rgbContrast.value},
set:function(a){this.uniforms.rgbContrast.value!==a&&(this.uniforms.rgbContrast.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},rgbBrightness:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.rgbBrightness.value},set:function(a){this.uniforms.rgbBrightness.value!==a&&(this.uniforms.rgbBrightness.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightRGB:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wRGB.value},
set:function(a){this.uniforms.wRGB.value!==a&&(this.uniforms.wRGB.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightIntensity:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wIntensity.value},set:function(a){this.uniforms.wIntensity.value!==a&&(this.uniforms.wIntensity.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightElevation:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wElevation.value},
set:function(a){this.uniforms.wElevation.value!==a&&(this.uniforms.wElevation.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightClassification:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wClassification.value},set:function(a){this.uniforms.wClassification.value!==a&&(this.uniforms.wClassification.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightReturnNumber:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wReturnNumber.value},
set:function(a){this.uniforms.wReturnNumber.value!==a&&(this.uniforms.wReturnNumber.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightSourceID:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wSourceID.value},set:function(a){this.uniforms.wSourceID.value!==a&&(this.uniforms.wSourceID.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}}});Potree.PointCloudMaterial=lib$potree$potree_clean$classdecl$var11;
var lib$potree$potree_clean$classdecl$var12=function(a){a=THREE.ShaderMaterial.call(this)||this;a.setValues({uniforms:{screenWidth:{type:'f',value:0},screenHeight:{type:'f',value:0},edlStrength:{type:'f',value:1},radius:{type:'f',value:1},neighbours:{type:'2fv',value:[]},depthMap:{type:'t',value:null},uRegularColor:{type:'t',value:null},uRegularDepth:{type:'t',value:null},uEDLColor:{type:'t',value:null},uEDLDepth:{type:'t',value:null},opacity:{type:'f',value:1}},vertexShader:a.getDefines()+Potree.Shaders['edl.vs'],
fragmentShader:a.getDefines()+Potree.Shaders['edl.fs'],lights:!1});a.neighbourCount=8;return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var12,THREE.ShaderMaterial);lib$potree$potree_clean$classdecl$var12.prototype.getDefines=function(){return'#define NEIGHBOUR_COUNT '+this.neighbourCount+'\n'};
lib$potree$potree_clean$classdecl$var12.prototype.updateShaderSource=function(){var a=this.getDefines()+Potree.Shaders['edl.vs'],b=this.getDefines()+Potree.Shaders['edl.fs'];this.setValues({vertexShader:a,fragmentShader:b});this.uniforms.neighbours.value=this.neighbours;this.needsUpdate=!0};
$jscomp.global.Object.defineProperties(lib$potree$potree_clean$classdecl$var12.prototype,{neighbourCount:{configurable:!0,enumerable:!0,get:function(){return this._neighbourCount},set:function(a){if(this._neighbourCount!==a){this._neighbourCount=a;this.neighbours=new Float32Array(2*this._neighbourCount);for(a=0;a<this._neighbourCount;a++)this.neighbours[2*a]=Math.cos(2*a*Math.PI/this._neighbourCount),this.neighbours[2*a+1]=Math.sin(2*a*Math.PI/this._neighbourCount);this.updateShaderSource()}}}});
Potree.EyeDomeLightingMaterial=lib$potree$potree_clean$classdecl$var12;var lib$potree$potree_clean$classdecl$var13=function(a){a=THREE.ShaderMaterial.call(this)||this;a.setValues({uniforms:{near:{type:'f',value:0},far:{type:'f',value:0},screenWidth:{type:'f',value:0},screenHeight:{type:'f',value:0},map:{type:'t',value:null}},vertexShader:Potree.Shaders['blur.vs'],fragmentShader:Potree.Shaders['blur.fs']});return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var13,THREE.ShaderMaterial);
Potree.BlurMaterial=lib$potree$potree_clean$classdecl$var13;var lib$potree$potree_clean$classdecl$var14=function(a){a=THREE.RawShaderMaterial.call(this)||this;a.setValues({uniforms:{uDepthMap:{type:'t',value:null},uWeightMap:{type:'t',value:null}},vertexShader:a.getDefines()+Potree.Shaders['normalize.vs'],fragmentShader:a.getDefines()+Potree.Shaders['normalize.fs']});return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var14,THREE.RawShaderMaterial);
lib$potree$potree_clean$classdecl$var14.prototype.getDefines=function(){return''};lib$potree$potree_clean$classdecl$var14.prototype.updateShaderSource=function(){var a=this.getDefines()+Potree.Shaders['normalize.vs'],b=this.getDefines()+Potree.Shaders['normalize.fs'];this.setValues({vertexShader:a,fragmentShader:b});this.needsUpdate=!0};Potree.NormalizationMaterial=lib$potree$potree_clean$classdecl$var14;
var lib$potree$potree_clean$classdecl$var15=function(a){a=THREE.RawShaderMaterial.call(this)||this;a.setValues({uniforms:{screenWidth:{type:'f',value:0},screenHeight:{type:'f',value:0},edlStrength:{type:'f',value:1},radius:{type:'f',value:1},neighbours:{type:'2fv',value:[]},uEDLMap:{type:'t',value:null},uDepthMap:{type:'t',value:null},uWeightMap:{type:'t',value:null}},vertexShader:a.getDefines()+Potree.Shaders['normalize.vs'],fragmentShader:a.getDefines()+Potree.Shaders['normalize_and_edl.fs']});
a.neighbourCount=8;return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var15,THREE.RawShaderMaterial);lib$potree$potree_clean$classdecl$var15.prototype.getDefines=function(){return'#define NEIGHBOUR_COUNT '+this.neighbourCount+'\n'};
lib$potree$potree_clean$classdecl$var15.prototype.updateShaderSource=function(){var a=this.getDefines()+Potree.Shaders['normalize.vs'],b=this.getDefines()+Potree.Shaders['normalize_and_edl.fs'];this.setValues({vertexShader:a,fragmentShader:b});this.uniforms.neighbours.value=this.neighbours;this.needsUpdate=!0};
$jscomp.global.Object.defineProperties(lib$potree$potree_clean$classdecl$var15.prototype,{neighbourCount:{configurable:!0,enumerable:!0,get:function(){return this._neighbourCount},set:function(a){if(this._neighbourCount!==a){this._neighbourCount=a;this.neighbours=new Float32Array(2*this._neighbourCount);for(a=0;a<this._neighbourCount;a++)this.neighbours[2*a]=Math.cos(2*a*Math.PI/this._neighbourCount),this.neighbours[2*a+1]=Math.sin(2*a*Math.PI/this._neighbourCount);this.updateShaderSource()}}}});
Potree.NormalizationEDLMaterial=lib$potree$potree_clean$classdecl$var15;function LRUItem(a){this.next=this.previous=null;this.node=a}function LRU(){this.last=this.first=null;this.items={};this.numPoints=this.elements=0}LRU.prototype.size=function(){return this.elements};LRU.prototype.contains=function(a){return null==this.items[a.id]};
LRU.prototype.touch=function(a){if(a.loaded)if(null==this.items[a.id]){var b=new LRUItem(a);b.previous=this.last;this.last=b;null!==b.previous&&(b.previous.next=b);this.items[a.id]=b;this.elements++;null===this.first&&(this.first=b);this.numPoints+=a.numPoints}else b=this.items[a.id],null===b.previous?null!==b.next&&(this.first=b.next,this.first.previous=null,b.previous=this.last,b.next=null,this.last=b,b.previous.next=b):null!==b.next&&(b.previous.next=b.next,b.next.previous=b.previous,b.previous=
this.last,b.next=null,this.last=b,b.previous.next=b)};LRU.prototype.remove=function(a){var b=this.items[a.id];b&&(1===this.elements?this.last=this.first=null:(b.previous||(this.first=b.next,this.first.previous=null),b.next||(this.last=b.previous,this.last.next=null),b.previous&&b.next&&(b.previous.next=b.next,b.next.previous=b.previous)),delete this.items[a.id],this.elements--,this.numPoints-=a.numPoints)};LRU.prototype.getLRUItem=function(){return null===this.first?null:this.first.node};
LRU.prototype.toString=function(){for(var a='{ ',b=this.first;null!==b;)a+=b.node.id,null!==b.next&&(a+=', '),b=b.next;return a=a+'}'+('('+this.size()+')')};LRU.prototype.freeMemory=function(){if(!(1>=this.elements))for(;this.numPoints>Potree.pointLoadLimit;)this.disposeDescendants(this.first.node)};LRU.prototype.disposeDescendants=function(a){var b=[];for(b.push(a);0<b.length;){a=b.pop();a.dispose();this.remove(a);for(var c in a.children)a.children.hasOwnProperty(c)&&a.children[c].loaded&&b.push(a.children[c])}};
var lib$potree$potree_clean$classdecl$var16=function(){Potree.PointCloudTreeNode.call(this);this.children={};this.octree=this.sceneNode=null};$jscomp.inherits(lib$potree$potree_clean$classdecl$var16,Potree.PointCloudTreeNode);lib$potree$potree_clean$classdecl$var16.prototype.getNumPoints=function(){return this.geometryNode.numPoints};lib$potree$potree_clean$classdecl$var16.prototype.isLoaded=function(){return!0};lib$potree$potree_clean$classdecl$var16.prototype.isTreeNode=function(){return!0};
lib$potree$potree_clean$classdecl$var16.prototype.isGeometryNode=function(){return!1};lib$potree$potree_clean$classdecl$var16.prototype.getLevel=function(){return this.geometryNode.level};lib$potree$potree_clean$classdecl$var16.prototype.getBoundingSphere=function(){return this.geometryNode.boundingSphere};lib$potree$potree_clean$classdecl$var16.prototype.getBoundingBox=function(){return this.geometryNode.boundingBox};
lib$potree$potree_clean$classdecl$var16.prototype.getChildren=function(){for(var a=[],b=0;8>b;b++)this.children[b]&&a.push(this.children[b]);return a};
lib$potree$potree_clean$classdecl$var16.prototype.getPointsInBox=function(a){if(!this.sceneNode)return null;var b=this.geometryNode.buffer,c=b.offset('position'),d=b.stride,e=new DataView(b.data);a=(new THREE.Matrix4).getInverse(a.matrixWorld);a=(new THREE.Matrix4).multiplyMatrices(a,this.sceneNode.matrixWorld);for(var f=[],g=new THREE.Vector4,h=0;h<b.numElements;h++){var l=e.getFloat32(h*d+c+0,!0),k=e.getFloat32(h*d+c+4,!0),m=e.getFloat32(h*d+c+8,!0);g.set(l,k,m,1);g.applyMatrix4(a);-.5<g.x&&.5>
g.x&&-.5<g.y&&.5>g.y&&-.5<g.z&&.5>g.z&&(g.set(l,k,m,1).applyMatrix4(this.sceneNode.matrixWorld),f.push(new THREE.Vector3(g.x,g.y,g.z)))}return f};$jscomp.global.Object.defineProperties(lib$potree$potree_clean$classdecl$var16.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.geometryNode.name}}});Potree.PointCloudOctreeNode=lib$potree$potree_clean$classdecl$var16;
Potree.PointCloudOctree=function(a,b){var c=Potree.PointCloudTree.call(this)||this;c.pointBudget=Infinity;c.pcoGeometry=a;c.boundingBox=c.pcoGeometry.boundingBox;c.boundingSphere=c.boundingBox.getBoundingSphere(new THREE.Sphere);c.material=b||new Potree.PointCloudMaterial;c.visiblePointsTarget=2E6;c.minimumNodePixelSize=150;c.level=0;c.position.copy(a.offset);c.updateMatrix();c.showBoundingBox=!1;c.boundingBoxNodes=[];c.loadQueue=[];c.visibleBounds=new THREE.Box3;c.visibleNodes=[];c.visibleGeometry=
[];c.generateDEM=!1;c.profileRequests=[];c.name='';b=[c.pcoGeometry.tightBoundingBox,c.getBoundingBoxWorld()].find(function(a){return void 0!==a});c.updateMatrixWorld(!0);b=Potree.utils.computeTransformedBoundingBox(b,c.matrixWorld);var d=b.max.z;c.material.heightMin=b.min.z;c.material.heightMax=d;c.projection=a.projection;c.root=c.pcoGeometry.root;return c};$jscomp.inherits(Potree.PointCloudOctree,Potree.PointCloudTree);
Potree.PointCloudOctree.prototype.setName=function(a){this.name!==a&&(this.name=a,this.dispatchEvent({type:'name_changed',name:a,pointcloud:this}))};Potree.PointCloudOctree.prototype.getName=function(){return this.name};
Potree.PointCloudOctree.prototype.toTreeNode=function(a,b){var c=this,d=new Potree.PointCloudOctreeNode,e=new THREE.Points(a.geometry,this.material);e.name=a.name;e.position.copy(a.boundingBox.min);e.frustumCulled=!1;e.onBeforeRender=function(b,e,f,k,m,p){m.program&&(b.getContext().useProgram(m.program.program),m.program.getUniforms().map.level&&(e=a.getLevel(),m.uniforms.level.value=e,m.program.getUniforms().map.level.setValue(b.getContext(),e)),c.visibleNodeTextureOffsets&&m.program.getUniforms().map.vnStart&&
(e=c.visibleNodeTextureOffsets.get(d),m.uniforms.vnStart.value=e,m.program.getUniforms().map.vnStart.setValue(b.getContext(),e)),m.program.getUniforms().map.pcIndex&&(e=d.pcIndex?d.pcIndex:c.visibleNodes.indexOf(d),m.uniforms.pcIndex.value=e,m.program.getUniforms().map.pcIndex.setValue(b.getContext(),e)))};d.geometryNode=a;d.sceneNode=e;d.pointcloud=this;d.children={};for(var f in a.children)d.children[f]=a.children[f];b?(f=parseInt(a.name[a.name.length-1]),b.sceneNode.add(e),b.children[f]=d):(this.root=
d,this.add(e));a.oneTimeDisposeHandlers.push(function(){var c=parseInt(a.name[a.name.length-1]);b.sceneNode.remove(d.sceneNode);b.children[c]=a});return d};
Potree.PointCloudOctree.prototype.updateVisibleBounds=function(){for(var a=[],b=0;b<this.visibleNodes.length;b++){for(var c=this.visibleNodes[b],d=!0,e=0;e<c.children.length;e++){var f=c.children[e];f instanceof Potree.PointCloudOctreeNode?d=d&&!f.sceneNode.visible:f instanceof Potree.PointCloudOctreeGeometryNode&&(d=!0)}d&&a.push(c)}this.visibleBounds.min=new THREE.Vector3(Infinity,Infinity,Infinity);this.visibleBounds.max=new THREE.Vector3(-Infinity,-Infinity,-Infinity);for(b=0;b<a.length;b++)c=
a[b],this.visibleBounds.expandByPoint(c.getBoundingBox().min),this.visibleBounds.expandByPoint(c.getBoundingBox().max)};Potree.PointCloudOctree.prototype.updateMaterial=function(a,b,c,d){a.fov=Math.PI/180*c.fov;a.screenWidth=d.domElement.clientWidth;a.screenHeight=d.domElement.clientHeight;a.spacing=this.pcoGeometry.spacing*Math.max(this.scale.x,this.scale.y,this.scale.z);a.near=c.near;a.far=c.far;a.uniforms.octreeSize.value=this.pcoGeometry.boundingBox.getSize(new THREE.Vector3).x};
Potree.PointCloudOctree.prototype.computeVisibilityTextureData=function(a,b){Potree.measureTimings&&performance.mark('computeVisibilityTextureData-start');var c=new Uint8Array(4*a.length),d=new Map;a=a.slice();a.sort(function(a,b){a=a.geometryNode.name;b=b.geometryNode.name;return a.length!==b.length?a.length-b.length:a<b?-1:a>b?1:0});for(var e=new THREE.Vector3,f=function(a,b){e.subVectors(b.center,a.origin);a=e.dot(a.direction);var c=e.dot(e)-a*a;b=b.radius*b.radius;if(c>b)return null;b=a+Math.sqrt(b-
c);return 0>b?null:b},g=new Map,h=new Map,l=0;l<a.length;l++){var k=a[l];d.set(k,l);for(var m=[],p=0;8>p;p++){var n=k.children[p];n&&n.constructor===Potree.PointCloudOctreeNode&&a.includes(n,l)&&m.push(n)}c[4*l]=0;c[4*l+1]=0;c[4*l+2]=0;c[4*l+3]=k.getLevel();for(p=0;p<m.length;p++){n=m[p];var t=parseInt(n.geometryNode.name.substr(-1));c[4*l]+=Math.pow(2,t);0===p&&(n=a.indexOf(n,l),c[4*l+1]=n-l>>8,c[4*l+2]=(n-l)%256)}p=k.getBoundingBox().clone().getBoundingSphere(new THREE.Sphere);p.applyMatrix4(k.sceneNode.matrixWorld);
p.applyMatrix4(b.matrixWorldInverse);m=new THREE.Ray(b.position,b.getWorldDirection());m=f(m,p);p=p.center.distanceTo(b.position)+p.radius;null===m&&(m=p);m=Math.max(m,p);g.has(k.getLevel())?(p=g.get(k.getLevel()),p=Math.max(p,m),g.set(k.getLevel(),p)):g.set(k.getLevel(),m);k.geometryNode.hasChildren||h.set(k,{distance:m,i:l})}a=$jscomp.makeIterator(h);for(b=a.next();!b.done;b=a.next())if(f=$jscomp.makeIterator(b.value),b=f.next().value,f=f.next().value,h=b.getLevel(),b=f.distance,f=f.i,!(4>h))for(h=
$jscomp.makeIterator(g),l=h.next();!l.done;l=h.next())k=$jscomp.makeIterator(l.value),l=k.next().value,k=k.next().value,b<1.2*k&&(c[4*f+3]=l);Potree.measureTimings&&(performance.mark('computeVisibilityTextureData-end'),performance.measure('render.computeVisibilityTextureData','computeVisibilityTextureData-start','computeVisibilityTextureData-end'));return{data:c,offsets:d}};
Potree.PointCloudOctree.prototype.nodeIntersectsProfile=function(a,b){a=a.boundingBox.clone().applyMatrix4(this.matrixWorld).getBoundingSphere(new THREE.Sphere);for(var c=!1,d=0;d<b.points.length-1;d++){var e=new THREE.Vector3(b.points[d+0].x,b.points[d+0].y,a.center.z),f=new THREE.Vector3(b.points[d+1].x,b.points[d+1].y,a.center.z);e=(new THREE.Line3(e,f)).closestPointToPoint(a.center,!0).distanceTo(a.center);c=c||e<a.radius+b.width}return c};
Potree.PointCloudOctree.prototype.nodesOnRay=function(a,b){var c=[];b=b.clone();for(var d=0;d<a.length;d++){var e=a[d],f=e.getBoundingSphere(new THREE.Sphere).clone().applyMatrix4(this.matrixWorld);b.intersectsSphere(f)&&c.push(e)}return c};
Potree.PointCloudOctree.prototype.updateMatrixWorld=function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1};
Potree.PointCloudOctree.prototype.hideDescendants=function(a){for(var b=[],c=0;c<a.children.length;c++){var d=a.children[c];d.visible&&b.push(d)}for(;0<b.length;)for(a=b.shift(),a.visible=!1,c=0;c<a.children.length;c++)d=a.children[c],d.visible&&b.push(d)};Potree.PointCloudOctree.prototype.moveToOrigin=function(){this.position.set(0,0,0);this.updateMatrixWorld(!0);var a=Potree.utils.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld);this.position.set(0,0,0).sub(a.getCenter())};
Potree.PointCloudOctree.prototype.moveToGroundPlane=function(){this.updateMatrixWorld(!0);var a=Potree.utils.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld);this.position.y+=-a.min.y};Potree.PointCloudOctree.prototype.getBoundingBoxWorld=function(){this.updateMatrixWorld(!0);return Potree.utils.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld)};
Potree.PointCloudOctree.prototype.getPointsInProfile=function(a,b,c){if(c)return c=new Potree.ProfileRequest(this,a,b,c),this.profileRequests.push(c),c;c={segments:[],boundingBox:new THREE.Box3,projectedBoundingBox:new THREE.Box2};for(var d=0;d<a.points.length-1;d++){var e=a.points[d],f=a.points[d+1],g=this.getProfile(e,f,a.width,b);c.segments.push({start:e,end:f,points:g,project:null});c.boundingBox.expandByPoint(g.boundingBox.min);c.boundingBox.expandByPoint(g.boundingBox.max)}a=new THREE.Vector3;
for(b=0;b<c.segments.length;b++)d=c.segments[b],e=d.start,f=d.end,g=function(a,b,c,d){var e=new THREE.Vector3(1,0,0);b=(new THREE.Vector3).subVectors(b,a);b.y=0;b.normalize();var f=Math.acos(e.dot(b));0<b.z&&(f=-f);return function(b){var e=(new THREE.Matrix4).makeTranslation(-a.x,-d.min.y,-a.z),g=(new THREE.Matrix4).makeRotationY(-f),h=(new THREE.Matrix4).makeTranslation(c.x,0,0);b=b.clone();b.applyMatrix4(e);b.applyMatrix4(g);b.applyMatrix4(h);return b}}(e,f,a.clone(),c.boundingBox.clone()),d.project=
g,a.x+=(new THREE.Vector3(e.x,0,e.z)).distanceTo(new THREE.Vector3(f.x,0,f.z)),a.y+=f.y-e.y;c.projectedBoundingBox.min.x=0;c.projectedBoundingBox.min.y=c.boundingBox.min.y;c.projectedBoundingBox.max.x=a.x;c.projectedBoundingBox.max.y=c.boundingBox.max.y;return c};Potree.PointCloudOctree.prototype.getProfile=function(a,b,c,d,e){a=new Potree.ProfileRequest(a,b,c,d,e);this.profileRequests.push(a)};Potree.PointCloudOctree.prototype.getVisibleExtent=function(){return this.visibleBounds.applyMatrix4(this.matrixWorld)};
Potree.PointCloudOctree.prototype.pick=function(a,b,c,d){d=void 0===d?{}:d;var e=a.renderer,f=a.pRenderer;performance.mark('pick-start');var g=function(a,b){return void 0!==a?a:b};a=g(d.pickWindowSize,17);g(d.pickOutsideClipRegion,!1);var h=e.getSize(new THREE.Vector3),l=Math.ceil(g(d.width,h.width));h=Math.ceil(g(d.height,h.height));var k=g(d.pointSizeType,this.material.pointSizeType);g=g(d.pointSize,this.material.size);c=this.nodesOnRay(this.visibleNodes,c);if(0===c.length)return null;if(!this.pickState){var m=
new THREE.Scene,p=new Potree.PointCloudMaterial;p.pointColorType=Potree.PointColorType.POINT_INDEX;this.pickState={renderTarget:new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),material:p,scene:m}}m=this.pickState;p=m.material;p.pointSizeType=k;p.shape=this.material.shape;p.size=g;p.uniforms.minSize.value=this.material.uniforms.minSize.value;p.uniforms.maxSize.value=this.material.uniforms.maxSize.value;p.classification=this.material.classification;
d.pickClipped?(p.clipBoxes=this.material.clipBoxes,p.clipTask=this.material.clipTask===Potree.ClipTask.HIGHLIGHT?Potree.ClipTask.NONE:this.material.clipTask):p.clipBoxes=[];this.updateMaterial(p,c,b,e);m.renderTarget.setSize(l,h);g=new THREE.Vector2(d.x,d.y);k=e.getContext();k.enable(k.SCISSOR_TEST);k.scissor(parseInt(g.x-(a-1)/2),parseInt(g.y-(a-1)/2),parseInt(a),parseInt(a));e.state.buffers.depth.setTest(p.depthTest);e.state.buffers.depth.setMask(p.depthWrite);e.state.setBlending(THREE.NoBlending);
e.setRenderTarget(m.renderTarget);k.clearColor(0,0,0,0);e.clearTarget(m.renderTarget,!0,!0,!0);var n=this.material;this.material=p;f.renderOctree(this,c,b,m.renderTarget);this.material=n;b=parseInt(Math.min(Math.max(0,g.x-(a-1)/2),l));f=parseInt(Math.min(Math.max(0,g.y-(a-1)/2),h));l=parseInt(Math.min(b+a,l)-b);h=parseInt(Math.min(f+a,h)-f);l=new Uint8Array(4*l*h);k.readPixels(b,f,a,a,k.RGBA,k.UNSIGNED_BYTE,l);e.setRenderTarget(null);e.resetGLState();e.setScissorTest(!1);k.disable(k.SCISSOR_TEST);
h=new Uint32Array(l.buffer);e=[];for(b=0;b<a;b++)for(f=0;f<a;f++)m=b+f*a,k=Math.pow(b-(a-1)/2,2)+Math.pow(f-(a-1)/2,2),g=l[4*m+3],l[4*m+3]=0,m=h[m],0===g&&0===m||void 0===g||void 0===m||(g={pIndex:m,pcIndex:g,distanceToCenter:k},d.all?e.push(g):0<e.length?k<e[0].distanceToCenter&&(e[0]=g):e.push(g));a=$jscomp.makeIterator(e);for(l=a.next();!l.done;l=a.next()){l=l.value;h={};if(!c[l.pcIndex])return null;f=c[l.pcIndex];b=f.sceneNode;f=f.geometryNode.geometry;for(var t in f.attributes)k=f.attributes[t],
'position'===t&&(k=new THREE.Vector3(k.array[3*l.pIndex],k.array[3*l.pIndex+1],k.array[3*l.pIndex+2]),k.applyMatrix4(b.matrixWorld),h[t]=k);l.point=h}performance.mark('pick-end');performance.measure('pick','pick-start','pick-end');return d.all?e.map(function(a){return a.point}):0===e.length?null:e[0].point};
Potree.PointCloudOctree.prototype.getFittedBoxGen=function $jscomp$generator$function(a){var c,d,e,f=this,g,h,l,k,m,p,n,t,r,q,u,w,z,v,x,A;return $jscomp.generator.createGenerator($jscomp$generator$function,function(y){switch(y.nextAddress){case 1:c=performance.now(),d=new THREE.Box3,e=(new THREE.Matrix4).getInverse(a.matrixWorld),g=$jscomp.makeIterator(f.visibleNodes),h=g.next();case 2:if(h.done)return z=d.getCenter().applyMatrix4(a.matrixWorld),v=new THREE.Object3D,v.position.copy(z),v.scale.copy(a.scale),
v.rotation.copy(a.rotation),x=(new THREE.Vector3).subVectors(d.max,d.min),v.scale.multiply(x),A=performance.now()-c,console.log('duration: ',A),y.yield(v,0);l=h.value;if(!l.sceneNode){y.jumpTo(3);break}k=l.geometryNode.buffer;m=k.offset('position');p=k.stride;n=new DataView(k.data);t=(new THREE.Matrix4).multiplyMatrices(e,l.sceneNode.matrixWorld);r=new THREE.Vector4;for(var B=0;B<k.numElements;B++)q=n.getFloat32(B*p+m+0,!0),u=n.getFloat32(B*p+m+4,!0),w=n.getFloat32(B*p+m+8,!0),r.set(q,u,w,1),r.applyMatrix4(t),
-.5<r.x&&.5>r.x&&-.5<r.y&&.5>r.y&&-.5<r.z&&.5>r.z&&d.expandByPoint(r);return y.yield(void 0,3);case 3:h=g.next(),y.jumpTo(2)}})};
Potree.PointCloudOctree.prototype.getFittedBox=function(a,b){b=Infinity;for(var c=performance.now(),d=new THREE.Box3,e=(new THREE.Matrix4).getInverse(a.matrixWorld),f=$jscomp.makeIterator(this.visibleNodes),g=f.next();!g.done;g=f.next()){var h=g.value;if(h.sceneNode&&!(h.getLevel()>b)){g=h.geometryNode.buffer;var l=g.offset('position'),k=g.stride,m=new DataView(g.data);h=(new THREE.Matrix4).multiplyMatrices(e,h.sceneNode.matrixWorld);for(var p=new THREE.Vector4,n=0;n<g.numElements;n++){var t=m.getFloat32(n*
k+l+0,!0),r=m.getFloat32(n*k+l+4,!0),q=m.getFloat32(n*k+l+8,!0);p.set(t,r,q,1);p.applyMatrix4(h);-.5<p.x&&.5>p.x&&-.5<p.y&&.5>p.y&&-.5<p.z&&.5>p.z&&d.expandByPoint(p)}}}e=d.getCenter().applyMatrix4(a.matrixWorld);b=new THREE.Object3D;b.position.copy(e);b.scale.copy(a.scale);b.rotation.copy(a.rotation);a=(new THREE.Vector3).subVectors(d.max,d.min);b.scale.multiply(a);c=performance.now()-c;console.log('duration: ',c);return b};
Potree.PointCloudOctree.prototype.find=function(a){var b=null;a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())c=c.value,b='r'===c?this.root:b.children[c];return b};$jscomp.global.Object.defineProperties(Potree.PointCloudOctree.prototype,{progress:{configurable:!0,enumerable:!0,get:function(){return this.visibleNodes.length/this.visibleGeometry.length}}});
var lib$potree$potree_clean$classdecl$var17=function(){this.octreeDir=this.url=null;this.spacing=0;this.pointAttributes=this.nodes=this.root=this.boundingBox=null;this.hierarchyStepSize=-1;this.loader=null};Potree.PointCloudOctreeGeometry=lib$potree$potree_clean$classdecl$var17;
var lib$potree$potree_clean$classdecl$var18=function(a,b,c){Potree.PointCloudTreeNode.call(this);this.id=Potree.PointCloudOctreeGeometryNode.IDCount++;this.name=a;this.index=parseInt(a.charAt(a.length-1));this.pcoGeometry=b;this.geometry=null;this.boundingBox=c;this.boundingSphere=c.getBoundingSphere(new THREE.Sphere);this.children={};this.numPoints=0;this.level=null;this.loaded=!1;this.oneTimeDisposeHandlers=[]};$jscomp.inherits(lib$potree$potree_clean$classdecl$var18,Potree.PointCloudTreeNode);
lib$potree$potree_clean$classdecl$var18.prototype.isGeometryNode=function(){return!0};lib$potree$potree_clean$classdecl$var18.prototype.getLevel=function(){return this.level};lib$potree$potree_clean$classdecl$var18.prototype.isTreeNode=function(){return!1};lib$potree$potree_clean$classdecl$var18.prototype.isLoaded=function(){return this.loaded};lib$potree$potree_clean$classdecl$var18.prototype.getBoundingSphere=function(){return this.boundingSphere};
lib$potree$potree_clean$classdecl$var18.prototype.getBoundingBox=function(){return this.boundingBox};lib$potree$potree_clean$classdecl$var18.prototype.getChildren=function(){for(var a=[],b=0;8>b;b++)this.children[b]&&a.push(this.children[b]);return a};
lib$potree$potree_clean$classdecl$var18.prototype.getURL=function(){var a='',b=this.pcoGeometry.loader.version;b.equalOrHigher('1.5')?a=this.pcoGeometry.octreeDir+'/'+this.getHierarchyPath()+'/'+this.name:b.equalOrHigher('1.4')?a=this.pcoGeometry.octreeDir+'/'+this.name:b.upTo('1.3')&&(a=this.pcoGeometry.octreeDir+'/'+this.name);return a};
lib$potree$potree_clean$classdecl$var18.prototype.getHierarchyPath=function(){for(var a='r/',b=this.pcoGeometry.hierarchyStepSize,c=this.name.substr(1),d=Math.floor(c.length/b),e=0;e<d;e++)a+=c.substr(e*b,b)+'/';return a=a.slice(0,-1)};lib$potree$potree_clean$classdecl$var18.prototype.addChild=function(a){this.children[a.index]=a;a.parent=this};
lib$potree$potree_clean$classdecl$var18.prototype.load=function(){!0===this.loading||!0===this.loaded||Potree.numNodesLoading>=Potree.maxNodesLoading||(this.loading=!0,Potree.numNodesLoading++,this.pcoGeometry.loader.version.equalOrHigher('1.5')?0===this.level%this.pcoGeometry.hierarchyStepSize&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints():this.loadPoints())};lib$potree$potree_clean$classdecl$var18.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)};
lib$potree$potree_clean$classdecl$var18.prototype.loadHierachyThenPoints=function(){var a=this;if(0===a.level%a.pcoGeometry.hierarchyStepSize){var b=a.pcoGeometry.octreeDir+'/'+a.getHierarchyPath()+'/'+a.name+'.hrc',c=Potree.XHRFactory.createXMLHttpRequest();c.open('GET',b,!0);c.responseType='arraybuffer';c.overrideMimeType('text/plain; charset=x-user-defined');c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status||0===c.status){var d=c.response,e=new DataView(d),f=[],g=e.getUint8(0),
h=e.getUint32(1,!0);a.numPoints=h;f.push({children:g,numPoints:h,name:a.name});g=[];for(h=5;0<f.length;){for(var l=f.shift(),k=1,m=0;8>m;m++){if(0!==(l.children&k)){var p=l.name+m,n=e.getUint8(h),t=e.getUint32(h+1,!0);f.push({children:n,numPoints:t,name:p});g.push({children:n,numPoints:t,name:p});h+=5}k*=2}if(h===d.byteLength)break}d={};d[a.name]=a;e=a.pcoGeometry;for(f=0;f<g.length;f++)h=g[f].name,l=g[f].numPoints,p=parseInt(h.charAt(h.length-1)),k=h.substring(0,h.length-1),k=d[k],m=h.length-1,p=
Potree.POCLoader.createChildAABB(k.boundingBox,p),p=new Potree.PointCloudOctreeGeometryNode(h,e,p),p.level=m,p.numPoints=l,p.hasChildren=0<g[f].children,p.spacing=e.spacing/Math.pow(2,m),k.addChild(p),d[h]=p;a.loadPoints()}else console.log('Failed to load file! HTTP status: '+c.status+', file: '+b),Potree.numNodesLoading--};try{c.send(null)}catch(d){console.log('fehler beim laden der punktwolke: '+d)}}};lib$potree$potree_clean$classdecl$var18.prototype.getNumPoints=function(){return this.numPoints};
lib$potree$potree_clean$classdecl$var18.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();this.oneTimeDisposeHandlers=[]}};Potree.PointCloudOctreeGeometryNode=lib$potree$potree_clean$classdecl$var18;Potree.PointCloudOctreeGeometryNode.IDCount=0;Object.assign(Potree.PointCloudOctreeGeometryNode.prototype,THREE.EventDispatcher.prototype);
Potree.PointCloudGreyhoundGeometry=function(){this.spacing=0;this.nodes=this.root=this.boundingBox=null;this.pointAttributes={};this.hierarchyStepSize=-1;this.serverURL=this.boundingSphere=this.projection=this.offset=this.baseDepth=this.schema=this.loader=null;this.normalize={color:!1,intensity:!1}};
Potree.PointCloudGreyhoundGeometryNode=function(a,b,c,d,e){this.id=Potree.PointCloudGreyhoundGeometryNode.IDCount++;this.name=a;this.index=parseInt(a.charAt(a.length-1));this.pcoGeometry=b;this.geometry=null;this.boundingBox=c;this.boundingSphere=c.getBoundingSphere(new THREE.Sphere);this.scale=d;this.offset=e;this.children={};this.numPoints=0;this.level=null;this.loaded=!1;this.oneTimeDisposeHandlers=[];this.baseLoaded=!1;a=this.boundingBox.clone();a.min.sub(this.pcoGeometry.boundingBox.getCenter());
a.max.sub(this.pcoGeometry.boundingBox.getCenter());this.scale&&(a.min.multiplyScalar(1/this.scale),a.max.multiplyScalar(1/this.scale));this.greyhoundBounds=a;this.greyhoundOffset=this.pcoGeometry.offset.clone().add(this.pcoGeometry.boundingBox.getSize(new THREE.Vector3).multiplyScalar(.5))};Potree.PointCloudGreyhoundGeometryNode.IDCount=0;Potree.PointCloudGreyhoundGeometryNode.prototype=Object.create(Potree.PointCloudTreeNode.prototype);
Potree.PointCloudGreyhoundGeometryNode.prototype.isGeometryNode=function(){return!0};Potree.PointCloudGreyhoundGeometryNode.prototype.isTreeNode=function(){return!1};Potree.PointCloudGreyhoundGeometryNode.prototype.isLoaded=function(){return this.loaded};Potree.PointCloudGreyhoundGeometryNode.prototype.getBoundingSphere=function(){return this.boundingSphere};Potree.PointCloudGreyhoundGeometryNode.prototype.getBoundingBox=function(){return this.boundingBox};
Potree.PointCloudGreyhoundGeometryNode.prototype.getLevel=function(){return this.level};Potree.PointCloudGreyhoundGeometryNode.prototype.getChildren=function(){for(var a=[],b=0;8>b;++b)this.children[b]&&a.push(this.children[b]);return a};
Potree.PointCloudGreyhoundGeometryNode.prototype.getURL=function(){var a=this.greyhoundBounds;a=''+this.pcoGeometry.serverURL+'read?depthBegin='+(this.baseLoaded?this.level+this.pcoGeometry.baseDepth:0)+'&depthEnd='+(this.level+this.pcoGeometry.baseDepth+1)+'&bounds=['+(a.min.x+','+a.min.y+','+a.min.z+','+a.max.x+','+a.max.y+','+a.max.z)+']&schema='+JSON.stringify(this.pcoGeometry.schema)+'&compress=true';this.scale&&(a+='&scale='+this.scale);if(this.greyhoundOffset){var b=this.greyhoundOffset;a+=
'&offset=['+b.x+','+b.y+','+b.z+']'}this.baseLoaded||(this.baseLoaded=!0);return a};Potree.PointCloudGreyhoundGeometryNode.prototype.addChild=function(a){this.children[a.index]=a;a.parent=this};Potree.PointCloudGreyhoundGeometryNode.prototype.load=function(){!0===this.loading||!0===this.loaded||Potree.numNodesLoading>=Potree.maxNodesLoading||(this.loading=!0,Potree.numNodesLoading++,0===this.level%this.pcoGeometry.hierarchyStepSize&&this.hasChildren?this.loadHierarchyThenPoints():this.loadPoints())};
Potree.PointCloudGreyhoundGeometryNode.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)};
Potree.PointCloudGreyhoundGeometryNode.prototype.loadHierarchyThenPoints=function(){var a=[0,2,1,3,4,6,5,7],b=function(b){var c=0;Object.keys(b).forEach(function(b){'swd'===b?c+=1<<a[0]:'nwd'===b?c+=1<<a[1]:'swu'===b?c+=1<<a[2]:'nwu'===b?c+=1<<a[3]:'sed'===b?c+=1<<a[4]:'ned'===b?c+=1<<a[5]:'seu'===b?c+=1<<a[6]:'neu'===b&&(c+=1<<a[7])});return c},c=function(d,e,f){var g,h;Object.keys(d).forEach(function(k){if('n'!==k){switch(k){case 'swd':g=d.swd;h=e+a[0];break;case 'nwd':g=d.nwd;h=e+a[1];break;case 'swu':g=
d.swu;h=e+a[2];break;case 'nwu':g=d.nwu;h=e+a[3];break;case 'sed':g=d.sed;h=e+a[4];break;case 'ned':g=d.ned;h=e+a[5];break;case 'seu':g=d.seu;h=e+a[6];break;case 'neu':g=d.neu,h=e+a[7]}f.push({children:b(g),numPoints:g.n,name:h});c(g,h,f)}})};if(0===this.level%this.pcoGeometry.hierarchyStepSize){var d=this.level+this.pcoGeometry.baseDepth,e=this.greyhoundBounds,f=''+this.pcoGeometry.serverURL+'hierarchy?bounds=['+(e.min.x+','+e.min.y+','+e.min.z+','+e.max.x+','+e.max.y+','+e.max.z)+']&depthBegin='+
d+'&depthEnd='+(d+this.pcoGeometry.hierarchyStepSize+2);this.scale&&(f+='&scale='+this.scale);this.greyhoundOffset&&(d=this.greyhoundOffset,f+='&offset=['+d.x+','+d.y+','+d.z+']');var g=Potree.XHRFactory.createXMLHttpRequest();g.open('GET',f,!0);var h=this;g.onreadystatechange=function(){if(4===g.readyState)if(200===g.status||0===g.status){var a=JSON.parse(g.responseText)||{},b=[];h.numPoints=a.n;c(a,h.name,b);a={};a[h.name]=h;for(var d=h.pcoGeometry,e=0;e<b.length;e++){var n=b[e].name,t=b[e].numPoints,
r=parseInt(n.charAt(n.length-1)),q=n.substring(0,n.length-1);q=a[q];var u=n.length-1;r=Potree.GreyhoundLoader.createChildAABB(q.boundingBox,r);r=new Potree.PointCloudGreyhoundGeometryNode(n,d,r,h.scale,h.offset);r.level=u;r.numPoints=t;r.hasChildren=0<b[e].children;r.spacing=d.spacing/Math.pow(2,u);q.addChild(r);a[n]=r}h.loadPoints()}else console.log('Failed to load file! HTTP status:',g.status,'file:',f)};try{g.send(null)}catch(l){console.log('fehler beim laden der punktwolke: '+l)}}};
Potree.PointCloudGreyhoundGeometryNode.prototype.getNumPoints=function(){return this.numPoints};Potree.PointCloudGreyhoundGeometryNode.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();this.oneTimeDisposeHandlers=[]}};Object.assign(Potree.PointCloudGreyhoundGeometryNode.prototype,THREE.EventDispatcher.prototype);Potree.utils=function(){};
Potree.utils.loadShapefileFeatures=function(a,b){var c=[];shapefile.open(a).then(function(a){a.read().then(function g(d){if(d.done)b(c);else return d.value&&'Feature'===d.value.type&&void 0!==d.value.geometry&&c.push(d.value),a.read().then(g)})})};Potree.utils.toString=function(a){return a instanceof THREE.Vector3?a.x.toFixed(2)+', '+a.y.toFixed(2)+', '+a.z.toFixed(2):''+a};Potree.utils.normalizeURL=function(a){a=new URL(a);return a.protocol+'//'+a.hostname+a.pathname.replace(/\/+/g,'/')};
Potree.utils.pathExists=function(a){var b=Potree.XHRFactory.createXMLHttpRequest();b.open('GET',a,!1);b.send(null);return 200!==b.status?!1:!0};Potree.utils.debugSphere=function(a,b,c,d){var e=new THREE.SphereGeometry(1,8,8);d=void 0!==d?new THREE.MeshBasicMaterial({color:d}):new THREE.MeshNormalMaterial;e=new THREE.Mesh(e,d);e.position.copy(b);e.scale.set(c,c,c);a.add(e)};
Potree.utils.debugLine=function(a,b,c,d){d=new THREE.LineBasicMaterial({color:d});var e=new THREE.Geometry;e.vertices.push(b,c);b=new THREE.Line(e,d);a.add(b)};
Potree.utils.computeTransformedBoundingBox=function(a,b){a=[(new THREE.Vector3(a.min.x,a.min.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.min.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,a.min.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.max.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.min.y,a.max.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.max.y,a.max.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,a.max.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,
a.min.y,a.max.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,a.max.y,a.max.z)).applyMatrix4(b)];b=new THREE.Box3;b.setFromPoints(a);return b};Potree.utils.addCommas=function(a){var b=(a+'').split('.');a=b[0];b=1<b.length?'.'+b[1]:'';for(var c=/(\d+)(\d{3})/;c.test(a);)a=a.replace(c,'$1,$2');return a+b};Potree.utils.removeCommas=function(a){return a.replace(/,/g,'')};Potree.utils.createWorker=function(a){a=new Blob([a],{type:'application/javascript'});return new Worker(URL.createObjectURL(a))};
Potree.utils.moveTo=function(a,b,c){var d=a.view,e=a.getActiveCamera();a=TWEEN.Easing.Quartic.Out;b=(new TWEEN.Tween(d.position)).to(b,500);b.easing(a);b.start();b=e.position.distanceTo(c);var f=(new THREE.Vector3).addVectors(e.position,e.getWorldDirection().clone().multiplyScalar(b));c=(new TWEEN.Tween(f)).to(c,500);c.easing(a);c.onUpdate(function(){d.lookAt(f)});c.onComplete(function(){d.lookAt(f)});c.start()};
Potree.utils.loadSkybox=function(a){var b=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1E5);b.up.set(0,0,1);var c=new THREE.Scene,d=[a+'px.jpg',a+'nx.jpg',a+'py.jpg',a+'ny.jpg',a+'pz.jpg',a+'nz.jpg'];a=[];for(var e={},f=0;6>f;e={material:e.material},f++)e.material=new THREE.MeshBasicMaterial({map:null,side:THREE.BackSide,depthTest:!1,depthWrite:!1,color:4343126}),a.push(e.material),(new THREE.TextureLoader).load(d[f],function(a){return function(b){a.material.map=b;a.material.needsUpdate=
!0;a.material.color.setHex(16777215)}}(e),function(a){},function(a){console.log('An error happened',a)});d=new THREE.CubeGeometry(5E3,5E3,5E3);a=new THREE.Mesh(d,a);c.add(a);c.rotation.x=Math.PI/2;return{camera:b,scene:c}};
Potree.utils.createGrid=function(a,b,c,d){d=new THREE.LineBasicMaterial({color:d||8947848});for(var e=new THREE.Geometry,f=0;f<=b;f++)e.vertices.push(new THREE.Vector3(-(c*a)/2,f*c-c*b/2,0)),e.vertices.push(new THREE.Vector3(+(c*a)/2,f*c-c*b/2,0));for(f=0;f<=a;f++)e.vertices.push(new THREE.Vector3(f*c-c*a/2,-(c*b)/2,0)),e.vertices.push(new THREE.Vector3(f*c-c*a/2,+(c*b)/2,0));a=new THREE.LineSegments(e,d,THREE.LinePieces);a.receiveShadow=!0;return a};
Potree.utils.createBackgroundTexture=function(a,b){function c(a,b){return 1/(2*Math.PI)*Math.exp(-(a*a+b*b)/2)}for(var d=new Uint8Array(3*a*b),e=[1,1.5,1.7],f=c(0,0),g=0;g<a;g++)for(var h=0;h<b;h++){var l=g+a*h,k=c(2*(g/a*2-1),2*(h/b*2-1))/f,m=(Math.random()+Math.random()+Math.random())/3;m=(.5*k+.5)*m*.03;m*=.4;d[3*l]=255*(k/15+.05+m)*e[0];d[3*l+1]=255*(k/15+.05+m)*e[1];d[3*l+2]=255*(k/15+.05+m)*e[2]}a=new THREE.DataTexture(d,a,b,THREE.RGBFormat);a.needsUpdate=!0;return a};
Potree.utils.getMousePointCloudIntersection=function(a,b,c,d,e){e=void 0===e?{}:e;var f=c.renderer,g={x:a.x/f.domElement.clientWidth*2-1,y:2*-(a.y/f.domElement.clientHeight)+1},h={};e.pickClipped&&(h.pickClipped=e.pickClipped);h.x=a.x;h.y=f.domElement.clientHeight-a.y;a=new THREE.Raycaster;a.setFromCamera(g,b);g=a.ray;a=null;e=Infinity;var l=f=null;d=$jscomp.makeIterator(d);for(var k=d.next();!k.done;k=d.next()){k=k.value;var m=k.pick(c,b,g,h);if(m){var p=b.position.distanceTo(m.position);p<e&&(e=
p,a=k,f=m.position,l=m)}}return a?{location:f,distance:e,pointcloud:a,point:l}:null};Potree.utils.pixelsArrayToImage=function(a,b,c){var d=document.createElement('canvas');d.width=b;d.height=c;var e=d.getContext('2d');a=new a.constructor(a);for(var f=0;f<a.length;f++)a[4*f+3]=255;b=e.createImageData(b,c);b.data.set(a);e.putImageData(b,0,0);a=new Image;a.src=d.toDataURL();return a};
Potree.utils.pixelsArrayToDataUrl=function(a,b,c){var d=document.createElement('canvas');d.width=b;d.height=c;var e=d.getContext('2d');a=new a.constructor(a);for(var f=0;f<a.length;f++)a[4*f+3]=255;b=e.createImageData(b,c);b.data.set(a);e.putImageData(b,0,0);return d.toDataURL()};
Potree.utils.pixelsArrayToCanvas=function(a,b,c){var d=document.createElement('canvas');d.width=b;d.height=c;var e=d.getContext('2d');a=new a.constructor(a);for(var f=4*b,g=0;g<parseInt(c/2);g++){var h=c-g-1,l=a.slice(g*f,g*f+f),k=a.slice(h*f,h*f+f);a.set(k,g*f);a.set(l,h*f)}b=e.createImageData(b,c);b.data.set(a);e.putImageData(b,0,0);return d};Potree.utils.removeListeners=function(a,b){void 0!==a._listeners&&a._listeners[b]&&delete a._listeners[b]};
Potree.utils.mouseToRay=function(a,b,c,d){c=a.x/c*2-1;d=2*-(a.y/d)+1;a=new THREE.Vector3(c,d,.5);c=new THREE.Vector3(c,d,0);a.unproject(b);c.unproject(b);b=(new THREE.Vector3).subVectors(a,c).normalize();return new THREE.Ray(c,b)};
Potree.utils.projectedRadius=function(a,b,c,d,e){if(b instanceof THREE.OrthographicCamera)return Potree.utils.projectedRadiusOrtho(a,b.projectionMatrix,d,e);if(b instanceof THREE.PerspectiveCamera)return Potree.utils.projectedRadiusPerspective(a,b.fov*Math.PI/180,c,e);throw Error('invalid parameters');};Potree.utils.projectedRadiusPerspective=function(a,b,c,d){return 1/Math.tan(b/2)/c*d/2*a};
Potree.utils.projectedRadiusOrtho=function(a,b,c,d){var e=new THREE.Vector4(0);a=new THREE.Vector4(a);e.applyMatrix4(b);a.applyMatrix4(b);e=new THREE.Vector3(e.x,e.y,e.z);a=new THREE.Vector3(a.x,a.y,a.z);e.x=.5*(e.x+1)*c;e.y=.5*(e.y+1)*d;a.x=.5*(a.x+1)*c;a.y=.5*(a.y+1)*d;return e.distanceTo(a)};Potree.utils.topView=function(a,b){a.position.set(0,1,0);a.rotation.set(-Math.PI/2,0,0);a.zoomTo(b,1)};Potree.utils.frontView=function(a,b){a.position.set(0,0,1);a.rotation.set(0,0,0);a.zoomTo(b,1)};
Potree.utils.leftView=function(a,b){a.position.set(-1,0,0);a.rotation.set(0,-Math.PI/2,0);a.zoomTo(b,1)};Potree.utils.rightView=function(a,b){a.position.set(1,0,0);a.rotation.set(0,Math.PI/2,0);a.zoomTo(b,1)};Potree.utils.frustumSphereIntersection=function(a,b){a=a.planes;for(var c=b.center,d=-b.radius,e=Number.MAX_VALUE,f=0;6>f;f++){var g=a[f].distanceToPoint(c);if(g<d)return 0;e=Math.min(e,g)}return e>=b.radius?2:1};
Potree.utils.generateDataTexture=function(a,b,c){var d=a*b,e=new Uint8Array(4*a*b),f=Math.floor(255*c.r),g=Math.floor(255*c.g);c=Math.floor(255*c.b);for(var h=0;h<d;h++)e[3*h]=f,e[3*h+1]=g,e[3*h+2]=c;a=new THREE.DataTexture(e,a,b,THREE.RGBAFormat);a.needsUpdate=!0;a.magFilter=THREE.NearestFilter;return a};
Potree.utils.getParameterByName=function(a){a=a.replace(/[[]/,'\\[').replace(/[\]]/,'\\]');a=(new RegExp('[\\?&]'+a+'=([^&#]*)')).exec(document.location.search);return null===a?null:decodeURIComponent(a[1].replace(/\+/g,' '))};
Potree.utils.setParameter=function(a,b){a=a.replace(/[[]/,'\\[').replace(/[\]]/,'\\]');var c=(new RegExp('([\\?&])('+a+'=([^&#]*))')).exec(document.location.search),d=window.location.href;null===c?(d=0===window.location.search.length?d+'?':d+'&',d=d+a+'='+b):d=d.replace(c[2],a+'='+b);window.history.replaceState({},'',d)};
Potree.utils.clipboardCopy=function(a){var b=document.createElement('textarea');b.style.position='fixed';b.style.top=0;b.style.left=0;b.style.width='2em';b.style.height='2em';b.style.padding=0;b.style.border='none';b.style.outline='none';b.style.boxShadow='none';b.style.background='transparent';b.value=a;document.body.appendChild(b);b.select();try{document.execCommand('copy')?console.log('copied text to clipboard'):console.log('copy to clipboard failed')}catch(c){console.log('error while trying to copy to clipboard')}document.body.removeChild(b)};
Potree.utils.screenPass=new function(){this.screenScene=new THREE.Scene;this.screenQuad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2,0));this.screenQuad.material.depthTest=!0;this.screenQuad.material.depthWrite=!0;this.screenQuad.material.transparent=!0;this.screenScene.add(this.screenQuad);this.camera=new THREE.Camera;this.render=function(a,b,c){this.screenQuad.material=b;'undefined'===typeof c?a.render(this.screenScene,this.camera):a.render(this.screenScene,this.camera,c)}};
Potree.Features=function(){var a=document.createElement('canvas'),b=a.getContext('webgl')||a.getContext('experimental-webgl');if(null===b)return null;a=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_FLOAT);var c=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_FLOAT),d=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT),e=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT);c=0<c.precision&&0<e.precision;return{SHADER_INTERPOLATION:{isSupported:function(){var a;return a=(a=b.getExtension('EXT_frag_depth'))&&
8<=b.getParameter(b.MAX_VARYING_VECTORS)}},SHADER_SPLATS:{isSupported:function(){var a;return a=(a=(a=b.getExtension('EXT_frag_depth'))&&b.getExtension('OES_texture_float'))&&8<=b.getParameter(b.MAX_VARYING_VECTORS)}},SHADER_EDL:{isSupported:function(){var a;return a=(a=b.getExtension('OES_texture_float'))&&8<=b.getParameter(b.MAX_VARYING_VECTORS)}},precision:0<a.precision&&0<d.precision?'highp':c?'mediump':'lowp'}}();
var lib$potree$potree_clean$classdecl$var19=function(a){var b=THREE.Object3D.call(this)||this;var c=new THREE.Texture;c.minFilter=THREE.LinearFilter;c.magFilter=THREE.LinearFilter;c=new THREE.SpriteMaterial({map:c,depthTest:!1,depthWrite:!1});b.material=c;b.sprite=new THREE.Sprite(c);b.add(b.sprite);b.borderThickness=4;b.fontface='Arial';b.fontsize=28;b.borderColor={r:0,g:0,b:0,a:1};b.backgroundColor={r:255,g:255,b:255,a:1};b.textColor={r:255,g:255,b:255,a:1};b.text='';b.setText(a);return b};
$jscomp.inherits(lib$potree$potree_clean$classdecl$var19,THREE.Object3D);lib$potree$potree_clean$classdecl$var19.prototype.setText=function(a){this.text!==a&&(this.text=a,this.update())};lib$potree$potree_clean$classdecl$var19.prototype.setTextColor=function(a){this.textColor=a;this.update()};lib$potree$potree_clean$classdecl$var19.prototype.setBorderColor=function(a){this.borderColor=a;this.update()};
lib$potree$potree_clean$classdecl$var19.prototype.setBackgroundColor=function(a){this.backgroundColor=a;this.update()};
lib$potree$potree_clean$classdecl$var19.prototype.update=function(){var a=document.createElement('canvas'),b=a.getContext('2d');b.font='Bold '+this.fontsize+'px '+this.fontface;var c=b.measureText(this.text).width,d=10+c+2*this.borderThickness,e=1.4*this.fontsize+2*this.borderThickness;b.canvas.width=d;b.canvas.height=e;b.font='Bold '+this.fontsize+'px '+this.fontface;b.fillStyle='rgba('+this.backgroundColor.r+','+this.backgroundColor.g+','+this.backgroundColor.b+','+this.backgroundColor.a+')';b.strokeStyle=
'rgba('+this.borderColor.r+','+this.borderColor.g+','+this.borderColor.b+','+this.borderColor.a+')';b.lineWidth=this.borderThickness;this.roundRect(b,this.borderThickness/2,this.borderThickness/2,c+this.borderThickness+10,1.4*this.fontsize+this.borderThickness,6);b.strokeStyle='rgba(0, 0, 0, 1.0)';b.strokeText(this.text,this.borderThickness+5,this.fontsize+this.borderThickness);b.fillStyle='rgba('+this.textColor.r+','+this.textColor.g+','+this.textColor.b+','+this.textColor.a+')';b.fillText(this.text,
this.borderThickness+5,this.fontsize+this.borderThickness);a=new THREE.Texture(a);a.minFilter=THREE.LinearFilter;a.magFilter=THREE.LinearFilter;a.needsUpdate=!0;this.sprite.material.map=a;this.sprite.scale.set(.01*d,.01*e,1)};
lib$potree$potree_clean$classdecl$var19.prototype.roundRect=function(a,b,c,d,e,f){a.beginPath();a.moveTo(b+f,c);a.lineTo(b+d-f,c);a.quadraticCurveTo(b+d,c,b+d,c+f);a.lineTo(b+d,c+e-f);a.quadraticCurveTo(b+d,c+e,b+d-f,c+e);a.lineTo(b+f,c+e);a.quadraticCurveTo(b,c+e,b,c+e-f);a.lineTo(b,c+f);a.quadraticCurveTo(b,c,b+f,c);a.closePath();a.fill();a.stroke()};Potree.TextSprite=lib$potree$potree_clean$classdecl$var19;
Potree.Version=function(a){this.version=a;var b=-1===a.indexOf('.')?a.length:a.indexOf('.');this.versionMajor=parseInt(a.substr(0,b));this.versionMinor=parseInt(a.substr(b+1));0===this.versionMinor.length&&(this.versionMinor=0)};Potree.Version.prototype.newerThan=function(a){a=new Potree.Version(a);return this.versionMajor>a.versionMajor?!0:this.versionMajor===a.versionMajor&&this.versionMinor>a.versionMinor?!0:!1};
Potree.Version.prototype.equalOrHigher=function(a){a=new Potree.Version(a);return this.versionMajor>a.versionMajor?!0:this.versionMajor===a.versionMajor&&this.versionMinor>=a.versionMinor?!0:!1};Potree.Version.prototype.upTo=function(a){return!this.newerThan(a)};
var lib$potree$potree_clean$classdecl$var20=function(){var a=THREE.Object3D.call(this)||this;a.constructor.counter=void 0===a.constructor.counter?0:a.constructor.counter+1;a.name='Measure_'+a.constructor.counter;a.points=[];a._showDistances=!0;a._showCoordinates=!1;a._showArea=!1;a._closed=!0;a._showAngles=!1;a._showHeight=!1;a.maxMarkers=Number.MAX_SAFE_INTEGER;a.sphereGeometry=new THREE.SphereGeometry(.4,10,10);a.color=new THREE.Color(16711680);a.lengthUnit={code:'m'};a.spheres=[];a.edges=[];a.sphereLabels=
[];a.edgeLabels=[];a.angleLabels=[];a.coordinateLabels=[];var b=new THREE.Geometry;b.vertices.push(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3);b.colors.push(a.color,a.color,a.color);var c=new THREE.LineDashedMaterial({color:16711680,dashSize:5,gapSize:2});c.depthTest=!1;a.heightEdge=new THREE.Line(b,c);a.heightEdge.visible=!1;a.add(a.heightEdge);a.heightLabel=new Potree.TextSprite('');a.heightLabel.setBorderColor({r:0,g:0,b:0,a:.8});a.heightLabel.setBackgroundColor({r:0,
g:0,b:0,a:.3});a.heightLabel.setTextColor({r:180,g:220,b:180,a:1});a.heightLabel.material.depthTest=!1;a.heightLabel.material.opacity=1;a.heightLabel.visible=!1;a.add(a.heightLabel);a.areaLabel=new Potree.TextSprite('');a.areaLabel.setBorderColor({r:0,g:0,b:0,a:.8});a.areaLabel.setBackgroundColor({r:0,g:0,b:0,a:.3});a.areaLabel.setTextColor({r:180,g:220,b:180,a:1});a.areaLabel.material.depthTest=!1;a.areaLabel.material.opacity=1;a.areaLabel.visible=!1;a.add(a.areaLabel);return a};
$jscomp.inherits(lib$potree$potree_clean$classdecl$var20,THREE.Object3D);lib$potree$potree_clean$classdecl$var20.prototype.createSphereMaterial=function(){return new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:this.color,depthTest:!1,depthWrite:!1})};
lib$potree$potree_clean$classdecl$var20.prototype.addMarker=function(a){var b=this;a instanceof THREE.Vector3?a={position:a}:a instanceof Array&&(a={position:new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a))))});this.points.push(a);var c=new THREE.Mesh(this.sphereGeometry,this.createSphereMaterial());this.add(c);this.spheres.push(c);var d=new THREE.Geometry;d.vertices.push(new THREE.Vector3,new THREE.Vector3);d.colors.push(this.color,this.color,this.color);
var e=new THREE.LineBasicMaterial({linewidth:1});e.depthTest=!1;d=new THREE.Line(d,e);d.visible=!0;this.add(d);this.edges.push(d);d=new Potree.TextSprite;d.setBorderColor({r:0,g:0,b:0,a:.8});d.setBackgroundColor({r:0,g:0,b:0,a:.3});d.material.depthTest=!1;d.visible=!1;this.edgeLabels.push(d);this.add(d);d=new Potree.TextSprite;d.setBorderColor({r:0,g:0,b:0,a:.8});d.setBackgroundColor({r:0,g:0,b:0,a:.3});d.material.depthTest=!1;d.material.opacity=1;d.visible=!1;this.angleLabels.push(d);this.add(d);
d=new Potree.TextSprite;d.setBorderColor({r:0,g:0,b:0,a:.8});d.setBackgroundColor({r:0,g:0,b:0,a:.3});d.material.depthTest=!1;d.material.opacity=1;d.visible=!1;this.coordinateLabels.push(d);this.add(d);c.addEventListener('drag',function(a){var c=Potree.utils.getMousePointCloudIntersection(a.drag.end,a.viewer.scene.getActiveCamera(),a.viewer,a.viewer.scene.pointclouds,{pickClipped:!0});if(c&&(a=b.spheres.indexOf(a.drag.object),-1!==a)){for(var d=b.points[a],e=$jscomp.makeIterator(Object.keys(c.point).filter(function(a){return'position'!==
a})),f=e.next();!f.done;f=e.next())f=f.value,d[f]=c.point[f];b.setPosition(a,c.location)}});c.addEventListener('drop',function(a){a=b.spheres.indexOf(a.drag.object);-1!==a&&b.dispatchEvent({type:'marker_dropped',measurement:b,index:a})});c.addEventListener('mouseover',function(a){return a.object.material.emissive.setHex(8947848)});c.addEventListener('mouseleave',function(a){return a.object.material.emissive.setHex(0)});this.dispatchEvent({type:'marker_added',measurement:this,sphere:c});this.setMarker(this.points.length-
1,a)};lib$potree$potree_clean$classdecl$var20.prototype.removeMarker=function(a){this.points.splice(a,1);this.remove(this.spheres[a]);var b=0===a?0:a-1;this.remove(this.edges[b]);this.edges.splice(b,1);this.remove(this.edgeLabels[b]);this.edgeLabels.splice(b,1);this.coordinateLabels.splice(a,1);this.spheres.splice(a,1);this.update();this.dispatchEvent({type:'marker_removed',measurement:this})};
lib$potree$potree_clean$classdecl$var20.prototype.setMarker=function(a,b){this.points[a]=b;a={type:'marker_moved',measure:this,index:a,position:b.position.clone()};this.dispatchEvent(a);this.update()};lib$potree$potree_clean$classdecl$var20.prototype.setPosition=function(a,b){this.points[a].position.copy(b);a={type:'marker_moved',measure:this,index:a,position:b.clone()};this.dispatchEvent(a);this.update()};
lib$potree$potree_clean$classdecl$var20.prototype.getArea=function(){for(var a=0,b=this.points.length-1,c=0;c<this.points.length;c++){var d=this.points[c].position;b=this.points[b].position;a+=(b.x+d.x)*(d.y-b.y);b=c}return Math.abs(a/2)};
lib$potree$potree_clean$classdecl$var20.prototype.getTotalDistance=function(){if(0===this.points.length)return 0;for(var a=0,b=1;b<this.points.length;b++){var c=this.points[b-1].position.distanceTo(this.points[b].position);a+=c}this.closed&&1<this.points.length&&(b=this.points[this.points.length-1].position.distanceTo(this.points[0].position),a+=b);return a};
lib$potree$potree_clean$classdecl$var20.prototype.getAngleBetweenLines=function(a,b,c){b=(new THREE.Vector3).subVectors(b.position,a.position);a=(new THREE.Vector3).subVectors(c.position,a.position);return b.angleTo(a)};lib$potree$potree_clean$classdecl$var20.prototype.getAngle=function(a){return 3>this.points.length||a>=this.points.length?0:this.getAngleBetweenLines(this.points[a],0===a?this.points[this.points.length-1]:this.points[a-1],this.points[(a+1)%this.points.length])};
lib$potree$potree_clean$classdecl$var20.prototype.update=function(){if(0!==this.points.length)if(1===this.points.length){var a=this.points[0].position;this.spheres[0].position.copy(a);var b=this.coordinateLabels[0];a=a.toArray().map(function(a){return Potree.utils.addCommas(a.toFixed(2))}).join(', ');b.setText(a);b.visible=this.showCoordinates}else{a=this.points.length-1;b=new THREE.Vector3;for(var c=0;c<=a;c++)b.add(this.points[c].position);b.divideScalar(this.points.length);for(c=0;c<=a;c++){var d=
c,e=this.points[d],f=this.points[c+1>a?0:c+1],g=this.points[0===c?a:c-1],h=this.spheres[d];h.position.copy(e.position);h.material.color=this.color;h=this.edges[d];h.material.color=this.color;h.position.copy(e.position);h.geometry.vertices[0].set(0,0,0);h.geometry.vertices[1].copy(f.position).sub(e.position);h.geometry.verticesNeedUpdate=!0;h.geometry.computeBoundingSphere();h.visible=d<a||this.closed;h=this.edgeLabels[c];var l=(new THREE.Vector3).add(e.position);l.add(f.position);l=l.multiplyScalar(.5);
var k=e.position.distanceTo(f.position);h.position.copy(l);h.setText(Potree.utils.addCommas(k.toFixed(2))+' '+this.lengthUnit.code);h.visible=this.showDistances&&(d<a||this.closed)&&2<=this.points.length&&0<k;h=this.angleLabels[c];l=this.getAngleBetweenLines(e,g,f);k=f.position.clone().sub(g.position);k.multiplyScalar(.5);k=g.position.clone().add(k).sub(e.position).normalize();f=Math.min(e.position.distanceTo(g.position),e.position.distanceTo(f.position));f/=9;e=e.position.clone().add(k.multiplyScalar(f));
h.position.copy(e);e=Potree.utils.addCommas((180/Math.PI*l).toFixed(1))+'\u00b0';h.setText(e);h.visible=this.showAngles&&(d<a||this.closed)&&3<=this.points.length&&0<l}a=this.heightEdge;a.visible=this.showHeight;if(this.heightLabel.visible=this.showHeight)d=this.points.slice().sort(function(a,b){return a.position.z-b.position.z}),c=d[0].position.clone(),e=d[d.length-1].position.clone(),g=c.z,f=e.z,d=f-g,g=new THREE.Vector3(e.x,e.y,g),e=new THREE.Vector3(e.x,e.y,f),a.position.copy(c),a.geometry.vertices[0].set(0,
0,0),a.geometry.vertices[1].copy(g).sub(c),a.geometry.vertices[2].copy(g).sub(c),a.geometry.vertices[3].copy(e).sub(c),a.geometry.verticesNeedUpdate=!0,a.geometry.computeBoundingSphere(),a=g.clone().add(e).multiplyScalar(.5),this.heightLabel.position.copy(a),a=Potree.utils.addCommas(d.toFixed(2))+' '+this.lengthUnit.code,this.heightLabel.setText(a);this.areaLabel.position.copy(b);this.areaLabel.visible=this.showArea&&3<=this.points.length;b=Potree.utils.addCommas(this.getArea().toFixed(1))+' '+this.lengthUnit.code+
'\u00b2';this.areaLabel.setText(b)}};lib$potree$potree_clean$classdecl$var20.prototype.raycast=function(a,b){for(var c=0;c<this.points.length;c++)this.spheres[c].raycast(a,b);for(c=0;c<b.length;c++){var d=b[c];d.distance=a.ray.origin.distanceTo(d.point)}b.sort(function(a,b){return a.distance-b.distance})};
$jscomp.global.Object.defineProperties(lib$potree$potree_clean$classdecl$var20.prototype,{showCoordinates:{configurable:!0,enumerable:!0,get:function(){return this._showCoordinates},set:function(a){this._showCoordinates=a;this.update()}},showAngles:{configurable:!0,enumerable:!0,get:function(){return this._showAngles},set:function(a){this._showAngles=a;this.update()}},showHeight:{configurable:!0,enumerable:!0,get:function(){return this._showHeight},set:function(a){this._showHeight=a;this.update()}},
showArea:{configurable:!0,enumerable:!0,get:function(){return this._showArea},set:function(a){this._showArea=a;this.update()}},closed:{configurable:!0,enumerable:!0,get:function(){return this._closed},set:function(a){this._closed=a;this.update()}},showDistances:{configurable:!0,enumerable:!0,get:function(){return this._showDistances},set:function(a){this._showDistances=a;this.update()}}});Potree.Measure=lib$potree$potree_clean$classdecl$var20;
Potree.Profile=function(){var a=THREE.Object3D.call(this)||this;a.constructor.counter=void 0===a.constructor.counter?0:a.constructor.counter+1;a.name='Profile_'+a.constructor.counter;a.points=[];a.spheres=[];a.edges=[];a.boxes=[];a.width=1;a.height=20;a._modifiable=!0;a.sphereGeometry=new THREE.SphereGeometry(.4,10,10);a.color=new THREE.Color(16711680);a.lineColor=new THREE.Color(16711680);return a};$jscomp.inherits(Potree.Profile,THREE.Object3D);
Potree.Profile.prototype.createSphereMaterial=function(){return new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:16711680,depthTest:!1,depthWrite:!1})};Potree.Profile.prototype.getSegments=function(){for(var a=[],b=0;b<this.points.length-1;b++){var c=this.points[b].clone(),d=this.points[b+1].clone();a.push({start:c,end:d})}return a};
Potree.Profile.prototype.getSegmentMatrices=function(){var a=this.getSegments(),b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var d=c.start,e=c.end;c=new THREE.Object3D;var f=d.clone().setZ(0).distanceTo(e.clone().setZ(0));c.scale.set(f,1E4,this.width);c.up.set(0,0,1);f=(new THREE.Vector3).addVectors(d,e).multiplyScalar(.5);d=(new THREE.Vector3).subVectors(e,d);d=new THREE.Vector3(d.y,-d.x,0);c.position.set(0,0,0);c.lookAt(d);c.position.copy(f);c.updateMatrixWorld();
b.push(c.matrixWorld)}return b};
Potree.Profile.prototype.addMarker=function(a){var b=this;this.points.push(a);var c=new THREE.Mesh(this.sphereGeometry,this.createSphereMaterial());this.add(c);this.spheres.push(c);if(1<this.points.length){var d=new THREE.Geometry;d.vertices.push(new THREE.Vector3,new THREE.Vector3);d.colors.push(this.lineColor,this.lineColor,this.lineColor);var e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:2,transparent:!0,opacity:.4});e.depthTest=!1;d=new THREE.Line(d,e);d.visible=!1;
this.add(d);this.edges.push(d);d=new THREE.BoxGeometry(1,1,1);e=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.2});d=new THREE.Mesh(d,e);d.visible=!1;this.add(d);this.boxes.push(d)}c.addEventListener('drag',function(a){var c=Potree.utils.getMousePointCloudIntersection(a.drag.end,a.viewer.scene.getActiveCamera(),a.viewer,a.viewer.scene.pointclouds);c&&(a=b.spheres.indexOf(a.drag.object),-1!==a&&b.setPosition(a,c.location))});c.addEventListener('drop',function(a){a=b.spheres.indexOf(a.drag.object);
-1!==a&&b.dispatchEvent({type:'marker_dropped',profile:b,index:a})});c.addEventListener('mouseover',function(a){return a.object.material.emissive.setHex(8947848)});c.addEventListener('mouseleave',function(a){return a.object.material.emissive.setHex(0)});this.dispatchEvent({type:'marker_added',profile:this,sphere:c});this.setPosition(this.points.length-1,a)};
Potree.Profile.prototype.removeMarker=function(a){this.points.splice(a,1);this.remove(this.spheres[a]);var b=0===a?0:a-1;this.remove(this.edges[b]);this.edges.splice(b,1);this.remove(this.boxes[b]);this.boxes.splice(b,1);this.spheres.splice(a,1);this.update();this.dispatchEvent({type:'marker_removed',profile:this})};Potree.Profile.prototype.setPosition=function(a,b){var c=this.points[a];c.copy(b);a={type:'marker_moved',profile:this,index:a,position:c.clone()};this.dispatchEvent(a);this.update()};
Potree.Profile.prototype.setWidth=function(a){this.width=a;this.dispatchEvent({type:'width_changed',profile:this,width:a});this.update()};Potree.Profile.prototype.getWidth=function(){return this.width};
Potree.Profile.prototype.update=function(){if(0!==this.points.length)if(1===this.points.length)this.spheres[0].position.copy(this.points[0]);else{for(var a=this.points[0].clone(),b=this.points[0].clone(),c=new THREE.Vector3,d=this.points.length-1,e=0;e<=d;e++){var f=this.points[e],g=this.spheres[e],h=0===e?d:e-1,l=this.points[h],k=this.edges[h],m=this.edges[e];h=this.boxes[h];g.position.copy(f);g.visible=this._modifiable?!0:!1;k&&(k.geometry.vertices[1].copy(f),k.geometry.verticesNeedUpdate=!0,k.geometry.computeBoundingSphere());
m&&(m.geometry.vertices[0].copy(f),m.geometry.verticesNeedUpdate=!0,m.geometry.computeBoundingSphere());h&&(k=f,g=l.clone().setZ(0).distanceTo(k.clone().setZ(0)),h.scale.set(g,1E6,this.width),h.up.set(0,0,1),g=(new THREE.Vector3).addVectors(l,k).multiplyScalar(.5),l=(new THREE.Vector3).subVectors(k,l),l=new THREE.Vector3(l.y,-l.x,0),h.position.set(0,0,0),h.lookAt(l),h.position.copy(g));c.add(f);a.min(f);b.max(f)}c.multiplyScalar(1/this.points.length);for(c=0;c<this.boxes.length;c++)this.boxes[c].position.z=
a.z+(b.z-a.z)/2}};Potree.Profile.prototype.raycast=function(a,b){for(var c=0;c<this.points.length;c++)this.spheres[c].raycast(a,b);for(c=0;c<b.length;c++){var d=b[c];d.distance=a.ray.origin.distanceTo(d.point)}b.sort(function(a,b){return a.distance-b.distance})};$jscomp.global.Object.defineProperties(Potree.Profile.prototype,{modifiable:{configurable:!0,enumerable:!0,get:function(){return this._modifiable},set:function(a){this._modifiable=a;this.update()}}});
Potree.Volume=function(a){a=void 0===a?{}:a;var b=THREE.Object3D.call(this)||this;b._clip=a.clip||!1;b._visible=!0;b.showVolumeLabel=!0;b._modifiable=a.modifiable||!0;b.label=new Potree.TextSprite('0');b.label.setBorderColor({r:0,g:255,b:0,a:0});b.label.setBackgroundColor({r:0,g:255,b:0,a:0});b.label.material.depthTest=!1;b.label.material.depthWrite=!1;b.label.material.transparent=!0;b.label.position.y-=.5;b.add(b.label);b.label.updateMatrixWorld=function(){var a=new THREE.Vector3;a.setFromMatrixPosition(b.matrixWorld);
b.label.position.copy(a);b.label.updateMatrix();b.label.matrixWorld.copy(b.label.matrix);b.label.matrixWorldNeedsUpdate=!1;a=0;for(var d=b.label.children.length;a<d;a++)b.label.children[a].updateMatrixWorld(!0)};b.addEventListener('select',function(a){});b.addEventListener('deselect',function(a){});return b};$jscomp.inherits(Potree.Volume,THREE.Object3D);Potree.Volume.prototype.getVolume=function(){console.warn('override this in subclass')};Potree.Volume.prototype.update=function(){};
Potree.Volume.prototype.raycast=function(a,b){};
$jscomp.global.Object.defineProperties(Potree.Volume.prototype,{visible:{configurable:!0,enumerable:!0,get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.dispatchEvent({type:'visibility_changed',object:this}))}},clip:{configurable:!0,enumerable:!0,get:function(){return this._clip},set:function(a){this._clip!==a&&(this._clip=a,this.update(),this.dispatchEvent({type:'clip_changed',object:this}))}},modifieable:{configurable:!0,enumerable:!0,get:function(){return this._modifiable},
set:function(a){this._modifiable=a;this.update()}}});
var lib$potree$potree_clean$classdecl$var21=function(a){a=void 0===a?{}:a;a=Potree.Volume.call(this,a)||this;a.constructor.counter=void 0===a.constructor.counter?0:a.constructor.counter+1;a.name='box_'+a.constructor.counter;var b=new THREE.BoxGeometry(1,1,1);b.computeBoundingBox();var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-.5,-.5,.5));c.vertices.push(new THREE.Vector3(.5,-.5,.5));c.vertices.push(new THREE.Vector3(.5,-.5,.5));c.vertices.push(new THREE.Vector3(.5,-.5,-.5));c.vertices.push(new THREE.Vector3(.5,
-.5,-.5));c.vertices.push(new THREE.Vector3(-.5,-.5,-.5));c.vertices.push(new THREE.Vector3(-.5,-.5,-.5));c.vertices.push(new THREE.Vector3(-.5,-.5,.5));c.vertices.push(new THREE.Vector3(-.5,.5,.5));c.vertices.push(new THREE.Vector3(.5,.5,.5));c.vertices.push(new THREE.Vector3(.5,.5,.5));c.vertices.push(new THREE.Vector3(.5,.5,-.5));c.vertices.push(new THREE.Vector3(.5,.5,-.5));c.vertices.push(new THREE.Vector3(-.5,.5,-.5));c.vertices.push(new THREE.Vector3(-.5,.5,-.5));c.vertices.push(new THREE.Vector3(-.5,
.5,.5));c.vertices.push(new THREE.Vector3(-.5,-.5,.5));c.vertices.push(new THREE.Vector3(-.5,.5,.5));c.vertices.push(new THREE.Vector3(.5,-.5,.5));c.vertices.push(new THREE.Vector3(.5,.5,.5));c.vertices.push(new THREE.Vector3(.5,-.5,-.5));c.vertices.push(new THREE.Vector3(.5,.5,-.5));c.vertices.push(new THREE.Vector3(-.5,-.5,-.5));c.vertices.push(new THREE.Vector3(-.5,.5,-.5));a.material=new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1});a.box=new THREE.Mesh(b,
a.material);a.box.geometry.computeBoundingBox();a.boundingBox=a.box.geometry.boundingBox;a.add(a.box);a.frame=new THREE.LineSegments(c,new THREE.LineBasicMaterial({color:0}));a.add(a.frame);a.update();return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var21,Potree.Volume);
lib$potree$potree_clean$classdecl$var21.prototype.update=function(){this.boundingBox=this.box.geometry.boundingBox;this.boundingSphere=this.boundingBox.getBoundingSphere(new THREE.Sphere);this._clip?(this.box.visible=!1,this.label.visible=!1):(this.box.visible=!0,this.label.visible=this.showVolumeLabel)};lib$potree$potree_clean$classdecl$var21.prototype.raycast=function(a,b){var c=[];this.box.raycast(a,c);0<c.length&&(a=c[0],b.push({distance:a.distance,object:this,point:a.point.clone()}))};
lib$potree$potree_clean$classdecl$var21.prototype.getVolume=function(){return Math.abs(this.scale.x*this.scale.y*this.scale.z)};Potree.BoxVolume=lib$potree$potree_clean$classdecl$var21;
var lib$potree$potree_clean$classdecl$var22=function(a){a=void 0===a?{}:a;a=Potree.Volume.call(this,a)||this;a.constructor.counter=void 0===a.constructor.counter?0:a.constructor.counter+1;a.name='sphere_'+a.constructor.counter;var b=new THREE.SphereGeometry(1,32,32);b.computeBoundingBox();a.material=new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1});a.sphere=new THREE.Mesh(b,a.material);a.sphere.visible=!1;a.sphere.geometry.computeBoundingBox();a.boundingBox=
a.sphere.geometry.boundingBox;a.add(a.sphere);a.label.visible=!1;for(var c=new THREE.Geometry,d=0;8>d;d++){var e=d/8*Math.PI*2,f=Math.cos(e);e=Math.sin(e);for(var g=0;64>=g;g++){var h=g/64*Math.PI*2,l=h+2*Math.PI/64,k=Math.cos(h),m=Math.sin(l);l=Math.cos(l);h=new THREE.Vector3(f*k,e*k,Math.sin(h));c.vertices.push(h);m=new THREE.Vector3(f*l,e*l,m);c.vertices.push(m)}}for(d=0;6>=d;d++)for(e=d/6,e=-Math.PI/2*(1-e)+Math.PI/2*e,f=Math.sin(e),console.log(e,f),e=0;64>=e;e++)m=e/64*Math.PI*2,h=m+2*Math.PI/
64,g=Math.cos(h),h=Math.sin(h),k=Math.sqrt(1-f*f),m=new THREE.Vector3(Math.cos(m)*k,Math.sin(m)*k,f),c.vertices.push(m),g=new THREE.Vector3(g*k,h*k,f),c.vertices.push(g);a.frame=new THREE.LineSegments(c,new THREE.LineBasicMaterial({color:0}));a.add(a.frame);c=new THREE.MeshBasicMaterial({wireframe:!0,color:0});a.frame=new THREE.Mesh(b,c);a.update();return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var22,Potree.Volume);
lib$potree$potree_clean$classdecl$var22.prototype.update=function(){this.boundingBox=this.sphere.geometry.boundingBox;this.boundingSphere=this.boundingBox.getBoundingSphere(new THREE.Sphere)};lib$potree$potree_clean$classdecl$var22.prototype.raycast=function(a,b){var c=[];this.sphere.raycast(a,c);0<c.length&&(a=c[0],b.push({distance:a.distance,object:this,point:a.point.clone()}))};lib$potree$potree_clean$classdecl$var22.prototype.getVolume=function(){return 4/3*Math.PI*this.scale.x*this.scale.y*this.scale.z};
Potree.SphereVolume=lib$potree$potree_clean$classdecl$var22;
Potree.PolygonClipVolume=function(a){var b=THREE.Object3D.call(this)||this;b.constructor.counter=void 0===b.constructor.counter?0:b.constructor.counter+1;b.name='polygon_clip_volume_'+b.constructor.counter;b.camera=a.clone();b.camera.rotation.set.apply(b.camera.rotation,$jscomp.arrayFromIterable(a.rotation.toArray()));b.camera.updateMatrixWorld();b.camera.updateProjectionMatrix();b.camera.matrixWorldInverse.getInverse(b.camera.matrixWorld);b.viewMatrix=b.camera.matrixWorldInverse.clone();b.projMatrix=
b.camera.projectionMatrix.clone();b.markers=[];b.initialized=!1;return b};$jscomp.inherits(Potree.PolygonClipVolume,THREE.Object3D);
Potree.PolygonClipVolume.prototype.addMarker=function(){var a=new THREE.Mesh,b=function(b){var c=b.viewer.renderer.getSize(new THREE.Vector3);b=new THREE.Vector3(b.drag.end.x/c.width*2-1,b.drag.end.y/c.height*-2+1,0);a.position.copy(b)},c=function(a){d()};var d=function(d){a.removeEventListener('drag',b);a.removeEventListener('drop',c)};a.addEventListener('drag',b);a.addEventListener('drop',c);this.markers.push(a)};
Potree.PolygonClipVolume.prototype.removeLastMarker=function(){0<this.markers.length&&this.markers.splice(this.markers.length-1,1)};
var lib$potree$potree_clean$classdecl$var23=function(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array([a.min.x,a.min.y,a.min.z,a.max.x,a.min.y,a.min.z,a.max.x,a.min.y,a.max.z,a.min.x,a.min.y,a.max.z,a.min.x,a.max.y,a.min.z,a.max.x,a.max.y,a.min.z,a.max.x,a.max.y,a.max.z,a.min.x,a.max.y,a.max.z]);a=new THREE.BufferGeometry;a.setIndex(new THREE.BufferAttribute(c,1));a.addAttribute('position',new THREE.BufferAttribute(d,3));b=new THREE.LineBasicMaterial({color:b});
return THREE.LineSegments.call(this,a,b)||this};$jscomp.inherits(lib$potree$potree_clean$classdecl$var23,THREE.LineSegments);Potree.Box3Helper=lib$potree$potree_clean$classdecl$var23;
var lib$potree$potree_clean$classdecl$var24=function(a){this.potreeRenderer=a;this.threeRenderer=this.potreeRenderer.threeRenderer;this.target=new THREE.WebGLRenderTarget(2048,2048,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.FloatType});this.target.depthTexture=new THREE.DepthTexture;this.target.depthTexture.type=THREE.UnsignedIntType;this.threeRenderer.setClearColor(0,1);this.threeRenderer.clearTarget(this.target,!0,!0,!0)};
lib$potree$potree_clean$classdecl$var24.prototype.setLight=function(a){this.light=a;this.camera=new THREE.PerspectiveCamera(180*a.angle/Math.PI,a.shadow.mapSize.width/a.shadow.mapSize.height,.1,0===a.distance?1E4:a.distance);this.camera.up.set(0,0,1);this.camera.position.copy(a.position);a=(new THREE.Vector3).addVectors(a.position,a.getWorldDirection());this.camera.lookAt(a);this.camera.updateProjectionMatrix();this.camera.updateMatrix();this.camera.updateMatrixWorld();this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld)};
lib$potree$potree_clean$classdecl$var24.prototype.setSize=function(a,b){this.target.width===a&&this.target.height===b||this.target.dispose();this.target.setSize(a,b)};lib$potree$potree_clean$classdecl$var24.prototype.render=function(a,b){this.threeRenderer.clearTarget(this.target,!0,!0,!0);this.potreeRenderer.render(a,this.camera,this.target,{})};Potree.PointCloudSM=lib$potree$potree_clean$classdecl$var24;
var lib$potree$potree_clean$classdecl$var25=function(a){this.content=a;this.element=$('\n\t\t\t<div class="potree_message">\n\t\t\t\t<span name="content_container" style="flex-grow: 1; padding: 5px"></span>\n\t\t\t\t<img name="close" src="'+(Potree.resourcePath+'/icons/close.svg')+'" class="button-icon" style="width: 16px; height: 16px;">\n\t\t\t</div>');this.elClose=this.element.find('img[name=close]');this.elContainer=this.element.find('span[name=content_container]');'string'===typeof a?this.elContainer.append($('<span>'+
a+'</span>')):this.elContainer.append(a)};lib$potree$potree_clean$classdecl$var25.prototype.setMessage=function(a){this.elContainer.empty();'string'===typeof a?this.elContainer.append($('<span>'+a+'</span>')):this.elContainer.append(a)};Potree.Message=lib$potree$potree_clean$classdecl$var25;
var lib$potree$potree_clean$classdecl$var26=function(a,b){var c=THREE.Object3D.call(this)||this;c.light=a;c.color=b;c.updateMatrix();c.updateMatrixWorld();a=new THREE.SphereGeometry(1,32,32);b=new THREE.MeshNormalMaterial;c.sphere=new THREE.Mesh(a,b);c.sphere.scale.set(.5,.5,.5);c.add(c.sphere);b=new Float32Array([0,0,0,0,0,1,0,0,0,-1,-1,1,0,0,0,1,-1,1,0,0,0,1,1,1,0,0,0,-1,1,1,-1,-1,1,1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,1,1,-1,-1,1]);a=new THREE.BufferGeometry;a.addAttribute('position',new THREE.BufferAttribute(b,
3));b=new THREE.LineBasicMaterial;c.frustum=new THREE.LineSegments(a,b);c.add(c.frustum);c.update();return c};$jscomp.inherits(lib$potree$potree_clean$classdecl$var26,THREE.Object3D);
lib$potree$potree_clean$classdecl$var26.prototype.update=function(){this.light.updateMatrix();this.light.updateMatrixWorld();var a=this.light.position,b=(new THREE.Vector3).addVectors(light.position,this.light.getWorldDirection().multiplyScalar(-1));b=(new THREE.Quaternion).setFromRotationMatrix((new THREE.Matrix4).lookAt(a,b,new THREE.Vector3(0,0,1)));this.setRotationFromQuaternion(b);this.position.copy(a);a=0<this.light.distance?this.light.distance:1E3;b=a*Math.tan(.5*this.light.angle);this.frustum.scale.set(b,
b,a)};Potree.SpotLightHelper=lib$potree$potree_clean$classdecl$var26;var lib$potree$potree_clean$classdecl$var27=function(){};
lib$potree$potree_clean$classdecl$var27.measurementToFeatures=function(a){var b=a.points.map(function(a){return a.position.toArray()}),c=[];1===b.length?c.push({type:'Feature',geometry:{type:'Point',coordinates:b[0]},properties:{name:a.name}}):1<b.length&&!a.closed?c.push({type:'Feature',geometry:{type:'LineString',coordinates:b},properties:{name:a.name}}):1<b.length&&a.closed&&(b={type:'Feature',geometry:{type:'Polygon',coordinates:[[].concat($jscomp.arrayFromIterable(b),[b[0]])]},properties:{name:a.name}},
c.push(b));a.showDistances&&a.edgeLabels.forEach(function(a){a={type:'Feature',geometry:{type:'Point',coordinates:a.position.toArray()},properties:{distance:a.text}};c.push(a)});a.showArea&&(a={type:'Feature',geometry:{type:'Point',coordinates:a.areaLabel.position.toArray()},properties:{area:a.areaLabel.text}},c.push(a));return c};
lib$potree$potree_clean$classdecl$var27.toString=function(a){a instanceof Array||(a=[a]);a=a.filter(function(a){return a instanceof Potree.Measure});var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())c=Potree.GeoJSONExporter.measurementToFeatures(c.value),b=b.concat(c);return JSON.stringify({type:'FeatureCollection',features:b},null,'\t')};Potree.GeoJSONExporter=lib$potree$potree_clean$classdecl$var27;var lib$potree$potree_clean$classdecl$var28=function(){};
lib$potree$potree_clean$classdecl$var28.measurementPointSection=function(a){return(a=a.points[0].position)?'0\nCIRCLE\n8\nlayer_point\n10\n'+a.x+'\n20\n'+a.y+'\n30\n'+a.z+'\n40\n1.0\n':''};
lib$potree$potree_clean$classdecl$var28.measurementPolylineSection=function(a){var b=8;a.closed&&(b+=1);b='0\nPOLYLINE\n8\nlayer_polyline\n62\n1\n66\n1\n10\n0.0\n20\n0.0\n30\n0.0\n70\n'+b+'\n';a=$jscomp.makeIterator(a.points);for(var c=a.next();!c.done;c=a.next())c=c.value,c=c.position,b+='0\nVERTEX\n8\n0\n10\n'+c.x+'\n20\n'+c.y+'\n30\n'+c.z+'\n70\n32\n';return b+'0\nSEQEND\n'};
lib$potree$potree_clean$classdecl$var28.measurementSection=function(a){if(0===a.points.length)return'';if(1===a.points.length)return Potree.DXFExporter.measurementPointSection(a);if(2<=a.points.length)return Potree.DXFExporter.measurementPolylineSection(a)};
lib$potree$potree_clean$classdecl$var28.toString=function(a){a instanceof Array||(a=[a]);a=a.filter(function(a){return a instanceof Potree.Measure});var b=a.filter(function(a){return a instanceof Potree.Measure}).map(function(a){return a.points}).reduce(function(a,b){return a.concat(b)}).map(function(a){return a.position}),c=new THREE.Vector3(Infinity,Infinity,Infinity),d=new THREE.Vector3(-Infinity,-Infinity,-Infinity);b=$jscomp.makeIterator(b);for(var e=b.next();!e.done;e=b.next())e=e.value,c.min(e),
d.max(e);c='999\nDXF created from potree\n0\nSECTION\n2\nHEADER\n9\n$ACADVER\n1\nAC1006\n9\n$INSBASE\n10\n0.0\n20\n0.0\n30\n0.0\n9\n$EXTMIN\n10\n'+c.x+'\n20\n'+c.y+'\n30\n'+c.z+'\n9\n$EXTMAX\n10\n'+d.x+'\n20\n'+d.y+'\n30\n'+d.z+'\n0\nENDSEC\n';d='0\nSECTION\n2\nENTITIES\n';a=$jscomp.makeIterator(a);for(b=a.next();!b.done;b=a.next())d+=Potree.DXFExporter.measurementSection(b.value);return c+(d+'0\nENDSEC\n')+'0\nEOF'};Potree.DXFExporter=lib$potree$potree_clean$classdecl$var28;
var lib$potree$potree_clean$classdecl$var29=function(){};
lib$potree$potree_clean$classdecl$var29.toString=function(a){var b='',c=Object.keys(a.data).filter(function(a){return'normal'!==a}).sort(function(a,b){if('position'===a)return-1;if('position'===b)return 1;if('color'===a)return-1;if('color'===b)return 1});b=[];for(var d=$jscomp.makeIterator(c),e=d.next();!e.done;e=d.next()){var f=e.value,g=a.data[f].length/a.numPoints;if('position'===f)b=b.concat(['x','y','z']);else if('color'===f)b=b.concat(['r','g','b','a']);else if(1<g)for(e=0;e<g;e++)b.push(f+
'_'+e);else b.push(f)}b=b.join(', ')+'\n';for(d=0;d<a.numPoints;d++){f=[];g=$jscomp.makeIterator(c);for(e=g.next();!e.done;e=g.next()){e=e.value;var h=a.data[e].length/a.numPoints;e=a.data[e].subarray(h*d,h*d+h).join(', ');f.push(e)}b+=f.join(', ')+'\n'}return b};Potree.CSVExporter=lib$potree$potree_clean$classdecl$var29;var lib$potree$potree_clean$classdecl$var30=function(){};
lib$potree$potree_clean$classdecl$var30.toLAS=function(a){var b=a.boundingBox,c=b.min.clone(),d=b.min.distanceTo(b.max),e=new THREE.Vector3(.001,.001,.001);e=1E6<d?new THREE.Vector3(.01,.01,.01):new THREE.Vector3(.001,.001,.001);var f=function(a,b,c){c=new Uint8Array(c);for(var d=0;d<a.length;d++){var e=a.charCodeAt(d);c[b+d]=e}};d=new ArrayBuffer(227+28*a.numPoints);var g=new DataView(d),h=new Uint8Array(d);f('LASF',0,d);h[24]=1;h[25]=2;f('Potree 1.5',58,d);g.setUint16(94,227,!0);g.setUint32(96,
227,!0);h[104]=2;g.setUint16(105,28,!0);g.setUint32(107,a.numPoints,!0);g.setFloat64(131,e.x,!0);g.setFloat64(139,e.y,!0);g.setFloat64(147,e.z,!0);g.setFloat64(155,c.x,!0);g.setFloat64(163,c.y,!0);g.setFloat64(171,c.z,!0);g.setFloat64(179,b.max.x,!0);g.setFloat64(187,b.min.x,!0);g.setFloat64(195,b.max.y,!0);g.setFloat64(203,b.min.y,!0);g.setFloat64(211,b.max.z,!0);g.setFloat64(219,b.min.z,!0);b=227;for(f=0;f<a.numPoints;f++){var l=a.data.position[3*f+1],k=a.data.position[3*f+2];h=parseInt((a.data.position[3*
f]-c.x)/e.x);l=parseInt((l-c.y)/e.y);k=parseInt((k-c.z)/e.z);g.setUint32(b+0,h,!0);g.setUint32(b+4,l,!0);g.setUint32(b+8,k,!0);a.data.intensity&&g.setUint16(b+12,a.data.intensity[f],!0);h=0;a.data.returnNumber&&(h+=a.data.returnNumber[f]);a.data.numberOfReturns&&(h+=a.data.numberOfReturns[f]<<3);g.setUint8(b+14,h);a.data.classification&&g.setUint8(b+15,a.data.classification[f]);a.data.pointSourceID&&g.setUint16(b+18,a.data.pointSourceID[f]);a.data.color&&(g.setUint16(b+20,255*a.data.color[4*f],!0),
g.setUint16(b+22,255*a.data.color[4*f+1],!0),g.setUint16(b+24,255*a.data.color[4*f+2],!0));b+=28}return d};Potree.LASExporter=lib$potree$potree_clean$classdecl$var30;var lib$potree$potree_clean$classdecl$var31=function(){Potree.PointCloudTreeNode.call(this);this.kdtree=this.sceneNode=this.right=this.left=null};$jscomp.inherits(lib$potree$potree_clean$classdecl$var31,Potree.PointCloudTreeNode);lib$potree$potree_clean$classdecl$var31.prototype.getNumPoints=function(){return this.geometryNode.numPoints};
lib$potree$potree_clean$classdecl$var31.prototype.isLoaded=function(){return!0};lib$potree$potree_clean$classdecl$var31.prototype.isTreeNode=function(){return!0};lib$potree$potree_clean$classdecl$var31.prototype.isGeometryNode=function(){return!1};lib$potree$potree_clean$classdecl$var31.prototype.getLevel=function(){return this.geometryNode.level};lib$potree$potree_clean$classdecl$var31.prototype.getBoundingSphere=function(){return this.geometryNode.boundingSphere};
lib$potree$potree_clean$classdecl$var31.prototype.getBoundingBox=function(){return this.geometryNode.boundingBox};lib$potree$potree_clean$classdecl$var31.prototype.toTreeNode=function(a){var b=null;this.left===a?b=this.left:this.right===a&&(b=this.right);if(b.loaded){a=new Potree.PointCloudArena4DNode;var c=THREE.PointCloud(b.geometry,this.kdtree.material);c.visible=!1;a.kdtree=this.kdtree;a.geometryNode=b;a.sceneNode=c;a.parent=this;a.left=this.geometryNode.left;a.right=this.geometryNode.right}};
lib$potree$potree_clean$classdecl$var31.prototype.getChildren=function(){var a=[];this.left&&a.push(this.left);this.right&&a.push(this.right);return a};Potree.PointCloudArena4DNode=lib$potree$potree_clean$classdecl$var31;
var lib$potree$potree_clean$classdecl$var32=function(a){var b=Potree.PointCloudTree.call(this)||this;b.root=null;a.root?b.root=a.root:a.addEventListener('hierarchy_loaded',function(){b.root=a.root});b.visiblePointsTarget=2E6;b.minimumNodePixelSize=150;b.position.sub(a.offset);b.updateMatrix();b.numVisibleNodes=0;b.numVisiblePoints=0;b.boundingBoxNodes=[];b.loadQueue=[];b.visibleNodes=[];b.pcoGeometry=a;b.boundingBox=b.pcoGeometry.boundingBox;b.boundingSphere=b.pcoGeometry.boundingSphere;b.material=
new Potree.PointCloudMaterial({vertexColors:THREE.VertexColors,size:.05,treeType:Potree.TreeType.KDTREE});b.material.sizeType=Potree.PointSizeType.ATTENUATED;b.material.size=.05;b.profileRequests=[];b.name='';return b};$jscomp.inherits(lib$potree$potree_clean$classdecl$var32,Potree.PointCloudTree);lib$potree$potree_clean$classdecl$var32.prototype.getBoundingBoxWorld=function(){this.updateMatrixWorld(!0);return Potree.utils.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld)};
lib$potree$potree_clean$classdecl$var32.prototype.setName=function(a){this.name!==a&&(this.name=a,this.dispatchEvent({type:'name_changed',name:a,pointcloud:this}))};lib$potree$potree_clean$classdecl$var32.prototype.getName=function(){return this.name};lib$potree$potree_clean$classdecl$var32.prototype.getLevel=function(){return this.level};
lib$potree$potree_clean$classdecl$var32.prototype.toTreeNode=function(a,b){var c=this,d=new Potree.PointCloudArena4DNode,e=new THREE.Points(a.geometry,this.material);e.frustumCulled=!1;e.onBeforeRender=function(b,e,h,l,k,m){k.program&&(b.getContext().useProgram(k.program.program),k.program.getUniforms().map.level&&(e=a.getLevel(),k.uniforms.level.value=e,k.program.getUniforms().map.level.setValue(b.getContext(),e)),c.visibleNodeTextureOffsets&&k.program.getUniforms().map.vnStart&&(e=c.visibleNodeTextureOffsets.get(d),
k.uniforms.vnStart.value=e,k.program.getUniforms().map.vnStart.setValue(b.getContext(),e)),k.program.getUniforms().map.pcIndex&&(e=d.pcIndex?d.pcIndex:c.visibleNodes.indexOf(d),k.uniforms.pcIndex.value=e,k.program.getUniforms().map.pcIndex.setValue(b.getContext(),e)))};d.geometryNode=a;d.sceneNode=e;d.pointcloud=this;d.left=a.left;d.right=a.right;b?(b.sceneNode.add(e),b.left===a?b.left=d:b.right===a&&(b.right=d)):(this.root=d,this.add(e));a.oneTimeDisposeHandlers.push(function(){b.sceneNode.remove(d.sceneNode);
b.left===d?b.left=a:b.right===d&&(b.right=a)});return d};lib$potree$potree_clean$classdecl$var32.prototype.updateMaterial=function(a,b,c,d){a.fov=Math.PI/180*c.fov;a.screenWidth=d.domElement.clientWidth;a.screenHeight=d.domElement.clientHeight;a.spacing=this.pcoGeometry.spacing;a.near=c.near;a.far=c.far;this.maxLevel>a.levels&&(a.levels=this.maxLevel+2);b=this.boundingBox.getSize(new THREE.Vector3);a.bbSize=[b.x,b.y,b.z]};lib$potree$potree_clean$classdecl$var32.prototype.updateVisibleBounds=function(){};
lib$potree$potree_clean$classdecl$var32.prototype.hideDescendants=function(a){for(var b=[],c=0;c<a.children.length;c++){var d=a.children[c];d.visible&&b.push(d)}for(;0<b.length;)for(a=b.shift(),a.visible=!1,a.boundingBoxNode&&(a.boundingBoxNode.visible=!1),c=0;c<a.children.length;c++)d=a.children[c],d.visible&&b.push(d)};
lib$potree$potree_clean$classdecl$var32.prototype.updateMatrixWorld=function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1};
lib$potree$potree_clean$classdecl$var32.prototype.nodesOnRay=function(a,b){var c=[];b=b.clone();for(var d=0;d<a.length;d++){var e=a[d],f=e.getBoundingSphere(new THREE.Sphere).clone().applyMatrix4(e.sceneNode.matrixWorld);b.intersectsSphere(f)&&c.push(e)}return c};
lib$potree$potree_clean$classdecl$var32.prototype.pick=function(a,b,c,d){d=void 0===d?{}:d;var e=a.renderer,f=a.pRenderer;performance.mark('pick-start');var g=function(a,b){return void 0!==a?a:b};a=g(d.pickWindowSize,17);g(d.pickOutsideClipRegion,!1);var h=e.getSize(new THREE.Vector3),l=Math.ceil(g(d.width,h.width));h=Math.ceil(g(d.height,h.height));var k=g(d.pointSizeType,this.material.pointSizeType);g=g(d.pointSize,this.material.size);c=this.nodesOnRay(this.visibleNodes,c);if(0===c.length)return null;
if(!this.pickState){var m=new THREE.Scene,p=new Potree.PointCloudMaterial;p.pointColorType=Potree.PointColorType.POINT_INDEX;this.pickState={renderTarget:new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),material:p,scene:m}}m=this.pickState;p=m.material;p.pointSizeType=k;p.shape=this.material.shape;p.size=g;p.uniforms.minSize.value=this.material.uniforms.minSize.value;p.uniforms.maxSize.value=this.material.uniforms.maxSize.value;
p.classification=this.material.classification;d.pickClipped?(p.clipBoxes=this.material.clipBoxes,p.clipTask=this.material.clipTask===Potree.ClipTask.HIGHLIGHT?Potree.ClipTask.NONE:this.material.clipTask):p.clipBoxes=[];this.updateMaterial(p,c,b,e);m.renderTarget.setSize(l,h);g=new THREE.Vector2(d.x,d.y);k=e.getContext();k.enable(k.SCISSOR_TEST);k.scissor(parseInt(g.x-(a-1)/2),parseInt(g.y-(a-1)/2),parseInt(a),parseInt(a));e.state.buffers.depth.setTest(p.depthTest);e.state.buffers.depth.setMask(p.depthWrite);
e.state.setBlending(THREE.NoBlending);e.clearTarget(m.renderTarget,!0,!0,!0);e.setRenderTarget(m.renderTarget);k.clearColor(0,0,0,0);e.clearTarget(m.renderTarget,!0,!0,!0);var n=this.material;this.material=p;f.renderOctree(this,c,b,m.renderTarget);this.material=n;b=parseInt(Math.min(Math.max(0,g.x-(a-1)/2),l));f=parseInt(Math.min(Math.max(0,g.y-(a-1)/2),h));l=parseInt(Math.min(b+a,l)-b);h=parseInt(Math.min(f+a,h)-f);l=new Uint8Array(4*l*h);k.readPixels(b,f,a,a,k.RGBA,k.UNSIGNED_BYTE,l);e.setRenderTarget(null);
e.resetGLState();e.setScissorTest(!1);k.disable(k.SCISSOR_TEST);h=new Uint32Array(l.buffer);e=[];for(b=0;b<a;b++)for(f=0;f<a;f++)m=b+f*a,k=Math.pow(b-(a-1)/2,2)+Math.pow(f-(a-1)/2,2),g=l[4*m+3],l[4*m+3]=0,m=h[m],0===g&&0===m||void 0===g||void 0===m||(g={pIndex:m,pcIndex:g,distanceToCenter:k},d.all?e.push(g):0<e.length?k<e[0].distanceToCenter&&(e[0]=g):e.push(g));a=$jscomp.makeIterator(e);for(l=a.next();!l.done;l=a.next()){l=l.value;h={};if(!c[l.pcIndex])return null;f=c[l.pcIndex];b=f.sceneNode;f=
f.geometryNode.geometry;for(var t in f.attributes)k=f.attributes[t],'position'===t&&(k=new THREE.Vector3(k.array[3*l.pIndex],k.array[3*l.pIndex+1],k.array[3*l.pIndex+2]),k.applyMatrix4(b.matrixWorld),h[t]=k);l.point=h}performance.mark('pick-end');performance.measure('pick','pick-start','pick-end');return d.all?e.map(function(a){return a.point}):0===e.length?null:e[0].point};
lib$potree$potree_clean$classdecl$var32.prototype.computeVisibilityTextureData=function(a){Potree.measureTimings&&performance.mark('computeVisibilityTextureData-start');var b=new Uint8Array(3*a.length),c=new Map;a=a.slice();a.sort(function(a,b){var c=a.geometryNode.level,d=b.geometryNode.level;a=a.geometryNode.number;b=b.geometryNode.number;return c!==d?c-d:a<b?-1:a>b?1:0});for(var d=[],e=0;e<a.length;e++)d.push(a[e].geometryNode.number);for(e=0;e<a.length;e++){var f=a[e];c.set(f,e);var g=0,h=0,l=
0;f.geometryNode.left&&0<d.indexOf(f.geometryNode.left.number)&&(g+=1,h=d.indexOf(f.geometryNode.left.number)-e);f.geometryNode.right&&0<d.indexOf(f.geometryNode.right.number)&&(g+=2,h=0===h?d.indexOf(f.geometryNode.right.number)-e:h);'X'===f.geometryNode.split?l=1:'Y'===f.geometryNode.split?l=2:'Z'===f.geometryNode.split&&(l=4);b[3*e]=g;b[3*e+1]=h;b[3*e+2]=l}Potree.measureTimings&&(performance.mark('computeVisibilityTextureData-end'),performance.measure('render.computeVisibilityTextureData','computeVisibilityTextureData-start',
'computeVisibilityTextureData-end'));return{data:b,offsets:c}};$jscomp.global.Object.defineProperties(lib$potree$potree_clean$classdecl$var32.prototype,{progress:{configurable:!0,enumerable:!0,get:function(){return this.pcoGeometry.root?0<Potree.numNodesLoading?0:1:0}}});Potree.PointCloudArena4D=lib$potree$potree_clean$classdecl$var32;
var lib$potree$potree_clean$classdecl$var33=function(){this.pcoGeometry=this.number=this.boundingBox=this.right=this.left=null;this.loaded=!1;this.level=this.numPoints=0;this.children=[];this.oneTimeDisposeHandlers=[]};lib$potree$potree_clean$classdecl$var33.prototype.isGeometryNode=function(){return!0};lib$potree$potree_clean$classdecl$var33.prototype.isTreeNode=function(){return!1};lib$potree$potree_clean$classdecl$var33.prototype.isLoaded=function(){return this.loaded};
lib$potree$potree_clean$classdecl$var33.prototype.getBoundingSphere=function(){return this.boundingSphere};lib$potree$potree_clean$classdecl$var33.prototype.getBoundingBox=function(){return this.boundingBox};lib$potree$potree_clean$classdecl$var33.prototype.getChildren=function(){var a=[];this.left&&a.push(this.left);this.right&&a.push(this.right);return a};lib$potree$potree_clean$classdecl$var33.prototype.getLevel=function(){return this.level};
lib$potree$potree_clean$classdecl$var33.prototype.load=function(){if(!(this.loaded||this.loading||Potree.numNodesLoading>=Potree.maxNodesLoading)){this.loading=!0;Potree.numNodesLoading++;var a=this.pcoGeometry.url+'?node='+this.number,b=Potree.XHRFactory.createXMLHttpRequest();b.open('GET',a,!0);b.responseType='arraybuffer';var c=this;b.onreadystatechange=function(){if(4===b.readyState&&200===b.status){var a=b.response,e=new DataView(a);a=a.byteLength/17;var f=new ArrayBuffer(28*a);new DataView(f);
f=new Float32Array(3*a);for(var g=new Uint8Array(4*a),h=new Float32Array(a),l=new Uint8Array(a),k=new ArrayBuffer(4*a),m=new Uint32Array(k),p=new THREE.Box3,n=0;n<a;n++){var t=e.getFloat32(17*n,!0)+c.boundingBox.min.x,r=e.getFloat32(17*n+4,!0)+c.boundingBox.min.y,q=e.getFloat32(17*n+8,!0)+c.boundingBox.min.z,u=e.getUint8(17*n+12,!0),w=e.getUint8(17*n+13,!0),z=e.getUint8(17*n+14,!0),v=e.getUint8(17*n+15,!0),x=e.getUint8(17*n+16,!0);p.expandByPoint(new THREE.Vector3(t,r,q));f[3*n]=t;f[3*n+1]=r;f[3*
n+2]=q;g[4*n]=u;g[4*n+1]=w;g[4*n+2]=z;g[4*n+3]=255;h[n]=v;l[n]=x;m[n]=n}e=new THREE.BufferGeometry;e.addAttribute('position',new THREE.BufferAttribute(f,3));e.addAttribute('color',new THREE.BufferAttribute(g,4,!0));e.addAttribute('intensity',new THREE.BufferAttribute(h,1));e.addAttribute('classification',new THREE.BufferAttribute(l,1));f=new THREE.BufferAttribute(new Uint8Array(k),4,!0);e.addAttribute('indices',f);c.geometry=e;c.numPoints=a;c.loaded=!0;c.loading=!1;Potree.numNodesLoading--}};b.send(null)}};
lib$potree$potree_clean$classdecl$var33.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();this.oneTimeDisposeHandlers=[]}};lib$potree$potree_clean$classdecl$var33.prototype.getNumPoints=function(){return this.numPoints};Potree.PointCloudArena4DGeometryNode=lib$potree$potree_clean$classdecl$var33;
var lib$potree$potree_clean$classdecl$var34=function(){var a=THREE.EventDispatcher.call(this)||this;a.numPoints=0;a.version=0;a.boundingBox=null;a.numNodes=0;a.name=null;a.provider=null;a.url=null;a.root=null;a.levels=0;a._spacing=null;a.pointAttributes=new Potree.PointAttributes(['POSITION_CARTESIAN','COLOR_PACKED']);return a};$jscomp.inherits(lib$potree$potree_clean$classdecl$var34,THREE.EventDispatcher);
lib$potree$potree_clean$classdecl$var34.load=function(a,b){var c=Potree.XHRFactory.createXMLHttpRequest();c.open('GET',a+'?info',!0);c.onreadystatechange=function(){try{if(4===c.readyState&&200===c.status){var d=JSON.parse(c.responseText),e=new Potree.PointCloudArena4DGeometry;e.url=a;e.name=d.Name;e.provider=d.Provider;e.numNodes=d.Nodes;e.numPoints=d.Points;e.version=d.Version;e.boundingBox=new THREE.Box3((new THREE.Vector3).fromArray(d.BoundingBox.slice(0,3)),(new THREE.Vector3).fromArray(d.BoundingBox.slice(3,
6)));d.Spacing&&(e.spacing=d.Spacing);var f=e.boundingBox.min.clone().multiplyScalar(-1);e.boundingBox.min.add(f);e.boundingBox.max.add(f);e.offset=f;var g=e.boundingBox.getCenter(),h=e.boundingBox.getSize(new THREE.Vector3).length()/2;e.boundingSphere=new THREE.Sphere(g,h);e.loadHierarchy();b(e)}else 4===c.readyState&&b(null)}catch(l){console.error(l.message),b(null)}};c.send(null)};
lib$potree$potree_clean$classdecl$var34.prototype.loadHierarchy=function(){var a=this,b=this.url+'?tree',c=Potree.XHRFactory.createXMLHttpRequest();c.open('GET',b,!0);c.responseType='arraybuffer';c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var b=c.response,e=b.byteLength/3;b=new DataView(b);for(var f=[],g=null,h=0,l=0;l<e;l++){var k=b.getUint8(3*l,!0),m=0<(k&1),p=0<(k&2),n=0<(k&8),t=0<(k&16),r=null;0<(k&4)?r='X':n&&(r='Y');t&&(r='Z');k=new Potree.PointCloudArena4DGeometryNode;
k.hasLeft=m;k.hasRight=p;k.split=r;k.isLeaf=!m&&!p;k.number=l;k.left=null;k.right=null;k.pcoGeometry=a;k.level=f.length;h=Math.max(h,k.level);0<f.length?(m=f[f.length-1],k.boundingBox=m.boundingBox.clone(),p=m.boundingBox.getSize(new THREE.Vector3),m.hasLeft&&!m.left?(m.left=k,m.children.push(k),'X'===m.split?k.boundingBox.max.x=k.boundingBox.min.x+p.x/2:'Y'===m.split?k.boundingBox.max.y=k.boundingBox.min.y+p.y/2:'Z'===m.split&&(k.boundingBox.max.z=k.boundingBox.min.z+p.z/2),m=k.boundingBox.getCenter(),
p=k.boundingBox.getSize(new THREE.Vector3).length()/2,k.boundingSphere=new THREE.Sphere(m,p)):(m.right=k,m.children.push(k),'X'===m.split?k.boundingBox.min.x+=p.x/2:'Y'===m.split?k.boundingBox.min.y+=p.y/2:'Z'===m.split&&(k.boundingBox.min.z+=p.z/2),m=k.boundingBox.getCenter(),p=k.boundingBox.getSize(new THREE.Vector3).length()/2,k.boundingSphere=new THREE.Sphere(m,p))):(g=k,g.boundingBox=a.boundingBox.clone(),m=g.boundingBox.getCenter(),p=g.boundingBox.getSize(new THREE.Vector3).length()/2,g.boundingSphere=
new THREE.Sphere(m,p));m=k.boundingBox.getSize(new THREE.Vector3);k.spacing=(m.x+m.y+m.z)/3/75;k.estimatedSpacing=k.spacing;f.push(k);if(k.isLeaf)for(k=!1;!k&&0<f.length;)f.pop(),k=f[f.length-1],k=0<f.length&&k.hasRight&&null==k.right}a.root=g;a.levels=h;a.dispatchEvent({type:'hierarchy_loaded'})}};c.send(null)};
$jscomp.global.Object.defineProperties(lib$potree$potree_clean$classdecl$var34.prototype,{spacing:{configurable:!0,enumerable:!0,get:function(){if(this._spacing)return this._spacing;if(this.root)return this.root.spacing},set:function(a){this._spacing=a}}});Potree.PointCloudArena4DGeometry=lib$potree$potree_clean$classdecl$var34;var lib$potree$potree_clean$classdecl$var35=function(a,b){this.gl=a;this.material=b;this.program=a.createProgram();this.recompile()};
lib$potree$potree_clean$classdecl$var35.prototype.compileShader=function(a,b){var c=this.gl;a=c.createShader(a);c.shaderSource(a,b);c.compileShader(a);return c.getShaderParameter(a,c.COMPILE_STATUS)?a:(console.error('could not compile shader:'),c=c.getShaderInfoLog(a),console.error(c,b),null)};
lib$potree$potree_clean$classdecl$var35.prototype.recompile=function(){var a=this.gl,b=this.compileShader(a.VERTEX_SHADER,this.material.vertexShader),c=this.compileShader(a.FRAGMENT_SHADER,this.material.fragmentShader);if(null!==b&&null!==c){var d=this.program;a.attachShader(d,b);a.attachShader(d,c);a.linkProgram(d);if(a.getProgramParameter(d,a.LINK_STATUS)){a.detachShader(d,b);a.detachShader(d,c);a.deleteShader(b);a.deleteShader(c);a.useProgram(d);b={};c=a.getProgramParameter(d,a.ACTIVE_UNIFORMS);
for(var e=0;e<c;e++){var f=a.getActiveUniform(d,e).name,g=a.getUniformLocation(d,f);b[f]=g}this.uniforms=b}else console.error('could not compile/link program:'),console.error(this.material.vertexShader),console.error(this.material.fragmentShader)}};Potree.GLProgram=lib$potree$potree_clean$classdecl$var35;var lib$potree$potree_clean$classdecl$var36=function(a,b,c,d,e){this.name=a;this.bytes=b;this.numElements=c;this.normalized=e;this.type=d};Potree.InterleavedBufferAttribute=lib$potree$potree_clean$classdecl$var36;
var lib$potree$potree_clean$classdecl$var37=function(a,b,c){this.data=a;this.attributes=b;this.stride=b.reduce(function(a,b){return a+b.bytes},0);this.stride=4*Math.ceil(this.stride/4);this.numElements=c};lib$potree$potree_clean$classdecl$var37.prototype.offset=function(a){for(var b=0,c=$jscomp.makeIterator(this.attributes),d=c.next();!d.done;d=c.next()){d=d.value;if(d.name===a)return b;b+=d.bytes}return null};Potree.InterleavedBuffer=lib$potree$potree_clean$classdecl$var37;
Potree.toInterleavedBufferAttribute=function(a){var b=null;a.name===Potree.PointAttribute.POSITION_CARTESIAN.name?b=new Potree.InterleavedBufferAttribute('position',12,3,'FLOAT',!1):a.name===Potree.PointAttribute.COLOR_PACKED.name?b=new Potree.InterleavedBufferAttribute('color',4,4,'UNSIGNED_BYTE',!0):a.name===Potree.PointAttribute.INTENSITY.name?b=new Potree.InterleavedBufferAttribute('intensity',4,1,'FLOAT',!1):a.name===Potree.PointAttribute.CLASSIFICATION.name?b=new Potree.InterleavedBufferAttribute('classification',
4,1,'FLOAT',!1):a.name===Potree.PointAttribute.RETURN_NUMBER.name?b=new Potree.InterleavedBufferAttribute('returnNumber',4,1,'FLOAT',!1):a.name===Potree.PointAttribute.NUMBER_OF_RETURNS.name?b=new Potree.InterleavedBufferAttribute('numberOfReturns',4,1,'FLOAT',!1):a.name===Potree.PointAttribute.SOURCE_ID.name?b=new Potree.InterleavedBufferAttribute('pointSourceID',4,1,'FLOAT',!1):a.name===Potree.PointAttribute.NORMAL_SPHEREMAPPED.name?b=new Potree.InterleavedBufferAttribute('normal',12,3,'FLOAT',
!1):a.name===Potree.PointAttribute.NORMAL_OCT16.name?b=new Potree.InterleavedBufferAttribute('normal',12,3,'FLOAT',!1):a.name===Potree.PointAttribute.NORMAL.name&&(b=new Potree.InterleavedBufferAttribute('normal',12,3,'FLOAT',!1));return b};
var GeoTIFF=function(a){var b=function(a){for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this[c]=a[c]};b.prototype.inspect=function(){return'Enum('+this.name+': '+this.value+')'};var c=function(a){this.object=a;for(var c=$jscomp.makeIterator(Object.keys(a)),d=c.next();!d.done;d=c.next()){d=d.value;var e=a[d];'object'===typeof e?e.name=d:e={name:d,value:e};this[d]=new b(e)}};c.prototype.fromValue=function(a){for(var b=$jscomp.makeIterator(Object.keys(this.object)),
c=b.next();!c.done;c=b.next())if(c=c.value,this[c].value===a)return this[c];throw Error('No enum for value: '+a);};var d=new c({LITTLE:'II',BIG:'MM'}),e=new c({BYTE:{value:1,bytes:1},ASCII:{value:2,bytes:1},SHORT:{value:3,bytes:2},LONG:{value:4,bytes:4},RATIONAL:{value:5,bytes:8},SBYTE:{value:6,bytes:1},UNDEFINED:{value:7,bytes:1},SSHORT:{value:8,bytes:2},SLONG:{value:9,bytes:4},SRATIONAL:{value:10,bytes:8},FLOAT:{value:11,bytes:4},DOUBLE:{value:12,bytes:8}}),f=new c({IMAGE_WIDTH:256,IMAGE_HEIGHT:257,
BITS_PER_SAMPLE:258,COMPRESSION:259,PHOTOMETRIC_INTERPRETATION:262,STRIP_OFFSETS:273,ORIENTATION:274,SAMPLES_PER_PIXEL:277,ROWS_PER_STRIP:278,STRIP_BYTE_COUNTS:279,X_RESOLUTION:282,Y_RESOLUTION:283,PLANAR_CONFIGURATION:284,RESOLUTION_UNIT:296,SOFTWARE:305,COLOR_MAP:320,SAMPLE_FORMAT:339,MODEL_PIXEL_SCALE:33550,MODEL_TIEPOINT:33922,GEO_KEY_DIRECTORY:34735,GEO_DOUBLE_PARAMS:34736,GEO_ASCII_PARAMS:34737}),g=new Map([[e.BYTE,Uint8Array],[e.ASCII,Uint8Array],[e.SHORT,Uint16Array],[e.LONG,Uint32Array],
[e.RATIONAL,Uint32Array],[e.SBYTE,Int8Array],[e.UNDEFINED,Uint8Array],[e.SSHORT,Int16Array],[e.SLONG,Int32Array],[e.SRATIONAL,Int32Array],[e.FLOAT,Float32Array],[e.DOUBLE,Float64Array]]),h=function(a,b,c,d,e){this.tag=a;this.type=b;this.count=c;this.offset=d;this.value=e},l=function(){this.height=this.width=0;this.buffer=null;this.metadata=[]};c=function(){};c.read=function(a){var b=String.fromCharCode.apply(String,$jscomp.arrayFromIterable(Array.from(a.slice(0,2))));d.fromValue(b);if(42!==a.readUInt8(2))throw Error('not a valid tiff file');
b=a.readUInt32LE(4);console.log('offsetToFirstIFD',b);var c=[],k=b;for(b=0;100>b;){console.log('currentIFDOffset',k);var m=a.readUInt16LE(k),q=a.readUInt32LE(k+2+12*m);console.log('next offset: ',k+2+12*m);k=a.slice(k+2,k+2+12*m);for(var u=0;u<m;u++){var w=f.fromValue(k.readUInt16LE(12*u)),z=e.fromValue(k.readUInt16LE(12*u+2)),v=k.readUInt32LE(12*u+4),x=k.readUInt32LE(12*u+8),A=z.bytes*v,y=void 0;4>=A?y=x:(y=new Uint8Array(A),y.set(a.slice(x,x+A)),y=new (g.get(z))(y.buffer),z===e.ASCII&&(y=String.fromCharCode.apply(String,
$jscomp.arrayFromIterable(y))));w=new h(w,z,v,x,y);c.push(w)}console.log('nextIFDOffset',q);if(0===q)break;k=q;b++}k=function(a){for(var b=$jscomp.makeIterator(c),d=b.next();!d.done;d=b.next())if(d=d.value,d.tag===a)return d;return null};b=k(f.IMAGE_WIDTH,c).value;m=k(f.IMAGE_HEIGHT,c).value;k(f.COMPRESSION,c);q=k(f.ROWS_PER_STRIP,c).value;z=k(f.STRIP_OFFSETS,c);w=k(f.STRIP_BYTE_COUNTS,c);k=Math.ceil(m/q);u=[];for(v=0;v<w.count;v++)x=w.type,A=w.offset+v*x.bytes,y=void 0,x===e.SHORT?y=a.readUInt16LE(A):
x===e.LONG&&(y=a.readUInt32LE(A)),u.push(y);w=[];for(v=0;v<z.count;v++)x=z.type,A=z.offset+v*x.bytes,y=void 0,x===e.SHORT?y=a.readUInt16LE(A):x===e.LONG&&(y=a.readUInt32LE(A)),w.push(y);z=new Uint8Array(b*m*3);for(x=v=0;x<k;x++){A=w[x];A=a.slice(A,A+u[x]);y=3*b;for(var B=0;B<q;B++){var C=A.slice(B*y,B*y+y);z.set(C,v*y);if(C.length===y)v++;else break}}console.log('width: '+b);console.log('height: '+m);console.log('numStrips: '+k);console.log('stripByteCounts',u.join(', '));console.log('stripOffsets',
w.join(', '));a=new l;a.width=b;a.height=m;a.buffer=z;a.metadata=c;return a};var k=function(){};k.toTiffBuffer=function(a,b){b=void 0===b?{}:b;var c=new Uint8Array([73,73,42,0,8,0,0,0]),d=$jscomp.makeIterator([a.width,a.height]),g=d.next().value;d=d.next().value;var k=[new h(f.IMAGE_WIDTH,e.SHORT,1,null,g),new h(f.IMAGE_HEIGHT,e.SHORT,1,null,d),new h(f.BITS_PER_SAMPLE,e.SHORT,4,null,new Uint16Array([8,8,8,8])),new h(f.COMPRESSION,e.SHORT,1,null,1),new h(f.PHOTOMETRIC_INTERPRETATION,e.SHORT,1,null,
2),new h(f.ORIENTATION,e.SHORT,1,null,1),new h(f.SAMPLES_PER_PIXEL,e.SHORT,1,null,4),new h(f.ROWS_PER_STRIP,e.LONG,1,null,d),new h(f.STRIP_BYTE_COUNTS,e.LONG,1,null,g*d*3),new h(f.PLANAR_CONFIGURATION,e.SHORT,1,null,1),new h(f.RESOLUTION_UNIT,e.SHORT,1,null,1),new h(f.SOFTWARE,e.ASCII,6,null,'......'),new h(f.STRIP_OFFSETS,e.LONG,1,null,null),new h(f.X_RESOLUTION,e.RATIONAL,1,null,new Uint32Array([1,1])),new h(f.Y_RESOLUTION,e.RATIONAL,1,null,new Uint32Array([1,1]))];b.ifdEntries&&k.push.apply(k,
$jscomp.arrayFromIterable(b.ifdEntries));var l=12*k.length+14,m=new Map;b=new Map;for(var p=$jscomp.makeIterator(k),v=p.next();!v.done;v=p.next()){v=v.value;var x=new ArrayBuffer(12),A=new DataView(x);A.setUint16(0,v.tag.value,!0);A.setUint16(2,v.type.value,!0);A.setUint32(4,v.count,!0);1===v.count&&4>=v.type.bytes?A.setUint32(8,v.value,!0):(A.setUint32(8,l,!0),A=new Uint8Array(v.count*v.type.bytes),v.type===e.ASCII?A.set(new Uint8Array(v.value.split('').map(function(a){return a.charCodeAt(0)}))):
A.set(new Uint8Array(v.value.buffer)),b.set(v.tag,A),l+=A.byteLength);m.set(v.tag,x)}(new DataView(m.get(f.STRIP_OFFSETS))).setUint32(8,l,!0);l=function(a){var b=a.reduce(function(a,b){return a+b.byteLength},0);b=new Uint8Array(b);var c=0;a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())d=d.value,b.set(new Uint8Array(d),c),c+=d.byteLength;return b};k=l([new Uint16Array([k.length])].concat($jscomp.arrayFromIterable(m.values()),[new Uint32Array([0])]));b=l([].concat($jscomp.arrayFromIterable(b.values())));
a=l([c,k,b,a.buffer]);return{width:g,height:d,buffer:a}};a.Tag=f;a.Type=e;a.IFDEntry=h;a.Image=l;a.Reader=c;a.Exporter=k;return a}({});function BinaryHeap(a){this.content=[];this.scoreFunction=a}
BinaryHeap.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.sinkDown(0));return a},remove:function(a){for(var b=this.content.length,c=0;c<b;c++)if(this.content[c]==a){a=this.content.pop();if(c==b-1)break;this.content[c]=a;this.bubbleUp(c);this.sinkDown(c);break}},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a],c=this.scoreFunction(b);0<
a;){var d=Math.floor((a+1)/2)-1,e=this.content[d];if(c>=this.scoreFunction(e))break;this.content[d]=b;this.content[a]=e;a=d}},sinkDown:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=2*(a+1),f=e-1,g=null;if(f<b){var h=this.scoreFunction(this.content[f]);h<d&&(g=f)}e<b&&this.scoreFunction(this.content[e])<(null==g?d:h)&&(g=e);if(null==g)break;this.content[a]=this.content[g];this.content[g]=c;a=g}}};Potree.Object=function(){var a=THREE.Mesh.call(this,new THREE.Geometry,new THREE.MeshBasicMaterial)||this;a.rotation.set(-Math.PI/2,0,0);a.frustumCulled=!1;a.pointclouds=[];a.minNodeSize=30;return a};$jscomp.inherits(Potree.Object,THREE.Mesh);Potree.Object.prototype.setPointBudget=function(a){Potree.pointBudget=a};
Potree.Object.prototype.onBeforeRender=function(a,b,c,d,e,f){Potree.pointLoadLimit=2*Potree.pointBudget;b=$jscomp.makeIterator(this.pointclouds);for(d=b.next();!d.done;d=b.next())d=d.value,d.showBoundingBox=!1,d.generateDEM=!1,d.minimumNodePixelSize=this.minNodeSize;Potree.updatePointClouds(this.pointclouds,c,a)};Potree.Object.prototype.add=function(a){a instanceof Potree.PointCloudTree&&this.pointclouds.push(a);THREE.Object3D.prototype.add.call(this,a)};
Potree.Object.prototype.getBoundingBox=function(){var a=new THREE.Box3;this.updateMatrixWorld(!0);for(var b=$jscomp.makeIterator(this.pointclouds),c=b.next();!c.done;c=b.next())c=c.value,c.updateMatrixWorld(!0),c=Potree.utils.computeTransformedBoundingBox(c.pcoGeometry.tightBoundingBox?c.pcoGeometry.tightBoundingBox:c.boundingBox,c.matrixWorld),a.union(c);return a};Potree.Group=function(){var a=THREE.Mesh.call(this,new THREE.Geometry,new THREE.MeshBasicMaterial)||this;a.rotation.set(-Math.PI/2,0,0);a.frustumCulled=!1;a.pointclouds=[];a.minNodeSize=30;a.buffers=new Map;a.shaders=new Map;a.textures=new Map;a.types=new Map;a.types.set(Float32Array,5126);a.types.set(Uint8Array,5121);a.types.set(Uint16Array,5123);return a};$jscomp.inherits(Potree.Group,THREE.Mesh);Potree.Group.prototype.setPointBudget=function(a){Potree.pointBudget=a};
Potree.Group.prototype.onBeforeRender=function(a,b,c,d,e,f){Potree.pointLoadLimit=2*Potree.pointBudget;b=$jscomp.makeIterator(this.pointclouds);for(d=b.next();!d.done;d=b.next()){d=d.value;if(!d.material._defaultIntensityRangeChanged&&(e=d.pcoGeometry.root,null!=e&&e.loaded&&(e=d.pcoGeometry.root.geometry.attributes,e.intensity))){f=e.intensity.array;e=[];for(var g=0;g<f.length;g++)e.push(f[g]);e.sort();f=parseInt(.75*(e.length-1));e=e[f];d.material.intensityRange=1>=e?[0,1]:256>=e?[0,255]:[0,e]}d.showBoundingBox=
!1;d.generateDEM=!1;d.minimumNodePixelSize=this.minNodeSize}Potree.updatePointClouds(this.pointclouds,c,a);b=this.fetchOctrees();b=$jscomp.makeIterator(b.octrees);for(d=b.next();!d.done;d=b.next())d=d.value,this.renderOctree(a,d,d.visibleNodes,c,{});c=a.context;c.activeTexture(c.TEXTURE1);c.bindTexture(c.TEXTURE_2D,null);a.resetGLState()};Potree.Group.prototype.add=function(a){a instanceof Potree.PointCloudTree&&this.pointclouds.push(a);THREE.Object3D.prototype.add.call(this,a)};
Potree.Group.prototype.getBoundingBox=function(){var a=new THREE.Box3;this.updateMatrixWorld(!0);for(var b=$jscomp.makeIterator(this.pointclouds),c=b.next();!c.done;c=b.next())c=c.value,c.updateMatrixWorld(!0),c=Potree.utils.computeTransformedBoundingBox(c.pcoGeometry.tightBoundingBox?c.pcoGeometry.tightBoundingBox:c.boundingBox,c.matrixWorld),a.union(c);return a};
Potree.Group.prototype.createBuffer=function(a,b){var c=new Potree.WebGLBuffer;c.vao=a.createVertexArray();c.numElements=b.attributes.position.count;a.bindVertexArray(c.vao);for(var d in b.attributes){var e=b.attributes[d],f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);a.bufferData(a.ARRAY_BUFFER,e.array,a.STATIC_DRAW);var g=Potree.attributeLocations[d],h=e.normalized,l=this.types.get(e.array.constructor);a.vertexAttribPointer(g,e.itemSize,l,h,0,0);a.enableVertexAttribArray(g);c.vbos.set(d,{handle:f,
name:d,count:e.count,itemSize:e.itemSize,type:b.attributes.position.array.constructor,version:0})}a.bindBuffer(a.ARRAY_BUFFER,null);a.bindVertexArray(null);return c};
Potree.Group.prototype.updateBuffer=function(a,b){var c=this.buffers.get(b);a.bindVertexArray(c.vao);for(var d in b.attributes){var e=b.attributes[d],f=Potree.attributeLocations[d],g=e.normalized,h=this.types.get(e.array.constructor);if(c.vbos.has(d)){var l=c.vbos.get(d).handle;c.vbos.get(d).version=e.version}else l=a.createBuffer(),c.vbos.set(d,{handle:l,name:d,count:e.count,itemSize:e.itemSize,type:b.attributes.position.array.constructor,version:e.version});a.bindBuffer(a.ARRAY_BUFFER,l);a.bufferData(a.ARRAY_BUFFER,
e.array,a.STATIC_DRAW);a.vertexAttribPointer(f,e.itemSize,h,g,0,0);a.enableVertexAttribArray(f)}a.bindBuffer(a.ARRAY_BUFFER,null);a.bindVertexArray(null)};Potree.Group.prototype.fetchOctrees=function(){for(var a=[],b=[this];0<b.length;){var c=b.pop();c instanceof Potree.PointCloudTree?a.push(c):(c=c.children.filter(function(a){return a.visible}),b.push.apply(b,$jscomp.arrayFromIterable(c)))}return{octrees:a}};
Potree.Group.prototype.renderNodes=function(a,b,c,d,e,f,g){var h=a.context;b=g.material?g.material:b.material;g=null==g.shadowMaps?[]:g.shadowMaps;e=e.matrixWorldInverse;var l=new THREE.Matrix4,k=new Float32Array(16),m=0,p={};c=$jscomp.makeIterator(c);for(var n=c.next();!n.done;p={world:p.world},n=c.next())if(n=n.value,void 0===Potree.debug.allowedNodes||Potree.debug.allowedNodes.includes(n.name)){p.world=n.sceneNode.matrixWorld;l.multiplyMatrices(e,p.world);if(d){var t=d.offsets.get(n);f.setUniform1f('uVNStart',
t)}t=n.getLevel();f.setUniform('uDebug',!0===n.debug);var r=void 0;n instanceof Potree.PointCloudOctreeNode?r=0===Object.keys(n.children).length:n instanceof Potree.PointCloudArena4DNode&&(r=n.geometryNode.isLeaf);f.setUniform('uIsLeafNode',r);if(r=f.uniformLocations.modelMatrix)k.set(p.world.elements),h.uniformMatrix4fv(r,!1,k);r=f.uniformLocations.modelViewMatrix;k.set(l.elements);h.uniformMatrix4fv(r,!1,k);if(b.clipPolygons&&0<b.clipPolygons.length){r=[];for(var q=[],u=$jscomp.makeIterator(b.clipPolygons),
w=u.next();!w.done;w=u.next()){w=w.value;var z=w.viewMatrix;z=w.projMatrix.clone().multiply(z).multiply(p.world);r.push(w.markers.length);q.push(z)}q=[].concat.apply([],$jscomp.arrayFromIterable(q.map(function(a){return a.elements})));u=Array(24*b.clipPolygons.length);for(w=0;w<b.clipPolygons.length;w++){z=b.clipPolygons[w];for(var v=0;v<z.markers.length;v++)u[24*w+3*v]=z.markers[v].position.x,u[24*w+(3*v+1)]=z.markers[v].position.y,u[24*w+(3*v+2)]=z.markers[v].position.z}h.uniform1iv(f.uniformLocations['uClipPolygonVCount[0]'],
r);h.uniformMatrix4fv(f.uniformLocations['uClipPolygonWVP[0]'],!1,q);h.uniform3fv(f.uniformLocations['uClipPolygonVertices[0]'],u)}f.setUniform1f('uLevel',t);f.setUniform1f('uNodeSpacing',n.geometryNode.estimatedSpacing);f.setUniform1f('uPCIndex',m);if(0<g.length){r=f.uniformLocations['uShadowMap[0]'];f.setUniform3f('uShadowColor',b.uniforms.uShadowColor.value);t=Array(g.length).fill(5).map(function(a,b){return a+b});h.uniform1iv(r,t);for(r=0;r<g.length;r++)q=t[r],u=a.properties.get(g[r].target.texture).__webglTexture,
h.activeTexture(h['TEXTURE'+q]),h.bindTexture(h.TEXTURE_2D,u);t=g.map(function(a){return a.camera.matrixWorldInverse}).map(function(a){return function(b){return(new THREE.Matrix4).multiplyMatrices(b,a.world)}}(p));t=[].concat.apply([],$jscomp.arrayFromIterable(t.map(function(a){return a.elements})));h.uniformMatrix4fv(f.uniformLocations['uShadowWorldView[0]'],!1,t);t=[].concat.apply([],$jscomp.arrayFromIterable(g.map(function(a){return a.camera.projectionMatrix.elements})));h.uniformMatrix4fv(f.uniformLocations['uShadowProj[0]'],
!1,t)}n=n.geometryNode.geometry;t=null;if(this.buffers.has(n)){t=this.buffers.get(n);for(var x in n.attributes)n.attributes[x].version>t.vbos.get(x).version&&this.updateBuffer(h,n)}else t=this.createBuffer(n),this.buffers.set(n,t);h.bindVertexArray(t.vao);h.drawArrays(h.POINTS,0,t.numElements);m++}h.bindVertexArray(null)};
Potree.Group.prototype.renderOctree=function(a,b,c,d,e){e=void 0===e?{}:e;var f=a.context,g=e.material?e.material:b.material,h=null==e.shadowMaps?[]:e.shadowMaps,l=d.matrixWorldInverse,k=d.matrixWorld,m=d.projectionMatrix,p=(new THREE.Matrix4).getInverse(m);new THREE.Matrix4;var n=null,t=null,r=0;0<=g.pointSizeType&&(g.pointSizeType===Potree.PointSizeType.ADAPTIVE||g.pointColorType===Potree.PointColorType.LOD)&&(t=b.computeVisibilityTextureData(null!=e.vnTextureNodes?e.vnTextureNodes:c,d),n=g.visibleNodesTexture,
n.image.data.set(t.data),n.needsUpdate=!0);if(!this.shaders.has(g)){var q=$jscomp.makeIterator([g.vertexShader,g.fragmentShader]);n=q.next().value;q=q.next().value;n=new Potree.Shader(f,'pointcloud',n,q);this.shaders.set(g,n)}n=this.shaders.get(g);var u=$jscomp.makeIterator([g.vertexShader,g.fragmentShader]);q=u.next().value;u=u.next().value;h=['#define num_shadowmaps '+h.length,'#define num_snapshots '+(g.snapEnabled?g.numSnapshots:0),'#define num_clipboxes '+(g.clipBoxes&&g.clipBoxes.length?g.clipBoxes.length:
0),'#define num_clipspheres '+(e.clipSpheres&&e.clipSpheres.length?e.clipSpheres.length:0),'#define num_clippolygons '+(g.clipPolygons&&g.clipPolygons.length?g.clipPolygons.length:0)].join('\n');n.update(h+'\n'+q,h+'\n'+u);g.needsUpdate=!1;h=$jscomp.makeIterator(Object.keys(g.uniforms));for(q=h.next();!q.done;q=h.next())if(q=g.uniforms[q.value],'t'==q.type&&(q=q.value))this.textures.has(q)||(u=new Potree.WebGLTexture(f,q),this.textures.set(q,u)),this.textures.get(q).update();f.useProgram(n.program);
h=!1;(h=void 0!==e.transparent?e.transparent&&1>g.opacity:1>g.opacity)?(f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE),f.depthMask(!1),f.disable(f.DEPTH_TEST)):(f.disable(f.BLEND),f.depthMask(!0),f.enable(f.DEPTH_TEST));void 0!==e.blendFunc&&(f.enable(f.BLEND),f.blendFunc.apply(f,$jscomp.arrayFromIterable(e.blendFunc)));void 0!==e.depthTest&&(!0===e.depthTest?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST));void 0!==e.depthWrite&&f.depthMask(!0===e.depthWrite);n.setUniformMatrix4('projectionMatrix',
m);n.setUniformMatrix4('viewMatrix',l);n.setUniformMatrix4('uViewInv',k);n.setUniformMatrix4('uProjInv',p);l=target?target.height:g.screenHeight;n.setUniform1f('uScreenWidth',target?target.width:g.screenWidth);n.setUniform1f('uScreenHeight',l);n.setUniform1f('fov',Math.PI*d.fov/180);n.setUniform1f('near',d.near);n.setUniform1f('far',d.far);d instanceof THREE.OrthographicCamera?(n.setUniform('uUseOrthographicCamera',!0),n.setUniform('uOrthoWidth',d.right-d.left),n.setUniform('uOrthoHeight',d.top-d.bottom)):
n.setUniform('uUseOrthographicCamera',!1);0===g.clipBoxes.length+g.clipPolygons.length?n.setUniform1i('clipTask',Potree.ClipTask.NONE):n.setUniform1i('clipTask',g.clipTask);n.setUniform1i('clipMethod',g.clipMethod);g.clipBoxes&&0<g.clipBoxes.length&&f.uniformMatrix4fv(n.uniformLocations['clipBoxes[0]'],!1,g.uniforms.clipBoxes.value);if(e.clipSpheres&&0<e.clipSpheres.length){l=[];k=$jscomp.makeIterator(e.clipSpheres);for(m=k.next();!m.done;m=k.next())p=m.value.matrixWorld,m=d.matrixWorld,p=(new THREE.Matrix4).getInverse(p),
m=(new THREE.Matrix4).multiplyMatrices(p,m),l.push(m);l=[].concat.apply([],$jscomp.arrayFromIterable(l.map(function(a){return a.elements})));f.uniformMatrix4fv(n.uniformLocations['uClipSpheres[0]'],!1,l)}n.setUniform1f('size',g.size);n.setUniform1f('maxSize',g.uniforms.maxSize.value);n.setUniform1f('minSize',g.uniforms.minSize.value);n.setUniform1f('uOctreeSpacing',g.spacing);n.setUniform('uOctreeSize',g.uniforms.octreeSize.value);n.setUniform3f('uColor',g.color.toArray());n.setUniform1f('uOpacity',
g.opacity);n.setUniform2f('elevationRange',g.elevationRange);n.setUniform2f('intensityRange',g.intensityRange);n.setUniform1f('intensityGamma',g.intensityGamma);n.setUniform1f('intensityContrast',g.intensityContrast);n.setUniform1f('intensityBrightness',g.intensityBrightness);n.setUniform1f('rgbGamma',g.rgbGamma);n.setUniform1f('rgbContrast',g.rgbContrast);n.setUniform1f('rgbBrightness',g.rgbBrightness);n.setUniform1f('uTransition',g.transition);n.setUniform1f('wRGB',g.weightRGB);n.setUniform1f('wIntensity',
g.weightIntensity);n.setUniform1f('wElevation',g.weightElevation);n.setUniform1f('wClassification',g.weightClassification);n.setUniform1f('wReturnNumber',g.weightReturnNumber);n.setUniform1f('wSourceID',g.weightSourceID);l=this.textures.get(g.visibleNodesTexture);n.setUniform1i('visibleNodesTexture',r);f.activeTexture(f.TEXTURE0+r);f.bindTexture(l.target,l.id);r++;l=this.textures.get(g.gradientTexture);n.setUniform1i('gradient',r);f.activeTexture(f.TEXTURE0+r);f.bindTexture(l.target,l.id);r++;l=this.textures.get(g.classificationTexture);
n.setUniform1i('classificationLUT',r);f.activeTexture(f.TEXTURE0+r);f.bindTexture(l.target,l.id);r++;if(!0===g.snapEnabled){m=n.uniformLocations['uSnapshot[0]'];p=n.uniformLocations['uSnapshotDepth[0]'];l=Array(5).fill(r).map(function(a,b){return a+b});k=Array(5).fill(1+Math.max.apply(Math,$jscomp.arrayFromIterable(l))).map(function(a,b){return a+b});r=1+Math.max.apply(Math,$jscomp.arrayFromIterable(k));f.uniform1iv(m,l);f.uniform1iv(p,k);for(r=0;5>r;r++){m=g.uniforms.uSnapshot.value[r];p=g.uniforms.uSnapshotDepth.value[r];
if(!m)break;m=a.properties.get(m).__webglTexture;p=a.properties.get(p).__webglTexture;h=k[r];f.activeTexture(f['TEXTURE'+l[r]]);f.bindTexture(f.TEXTURE_2D,m);f.activeTexture(f['TEXTURE'+h]);f.bindTexture(f.TEXTURE_2D,p)}r=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapView.value.map(function(a){return a.elements})));f.uniformMatrix4fv(n.uniformLocations['uSnapView[0]'],!1,r);r=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapProj.value.map(function(a){return a.elements})));
f.uniformMatrix4fv(n.uniformLocations['uSnapProj[0]'],!1,r);r=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapProjInv.value.map(function(a){return a.elements})));f.uniformMatrix4fv(n.uniformLocations['uSnapProjInv[0]'],!1,r);r=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapViewInv.value.map(function(a){return a.elements})));f.uniformMatrix4fv(n.uniformLocations['uSnapViewInv[0]'],!1,r)}this.renderNodes(a,b,c,t,d,n,e);f.activeTexture(f.TEXTURE2);f.bindTexture(f.TEXTURE_2D,
null);f.activeTexture(f.TEXTURE0)};
Potree.Group.prototype.estimateHeightAt=function(a){for(var b=null,c=Infinity,d=$jscomp.makeIterator(this.pointclouds),e=d.next();!e.done;e=d.next())if(e=e.value,void 0!==e.root.geometryNode){var f=null,g=Infinity,h=a.clone().sub(e.position);h.z=0;h=new THREE.Ray(h,new THREE.Vector3(0,0,1));for(var l=[e.root];0<l.length;){var k=l.pop(),m=k.getBoundingBox();if(h.intersectBox(m)){m=k.geometryNode.mean.z+e.position.z+k.geometryNode.boundingBox.min.z;k.geometryNode.spacing<=g&&(f=m,g=k.geometryNode.spacing);
m=$jscomp.makeIterator(Object.keys(k.children));for(var p=m.next();!p.done;p=m.next())p=p.value,k.children[p].geometryNode&&l.push(k.children[p])}}if(null===b||g<c)b=f,c=g}return b};Potree.XHRFactory={config:{withCredentials:!1,customHeaders:[{header:null,value:null}]},createXMLHttpRequest:function(){var a=new XMLHttpRequest;a.overrideMimeType('text/plain');if(this.config.customHeaders&&Array.isArray(this.config.customHeaders)&&0<this.config.customHeaders.length){var b=a.open,c=this.config.customHeaders;a.open=function(){b.apply(this,[].slice.call(arguments));c.forEach(function(b){b.header&&b.value&&a.setRequestHeader(b.header,b.value)})}}return a}};
